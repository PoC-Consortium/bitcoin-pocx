[โ ุงูุณุงุจู: ุตูุบุฉ ุงูุฑุณู](2-plot-format.md) | [๐ ุฌุฏูู ุงููุญุชููุงุช](index.md) | [ุงูุชุงูู: ุชุนูููุงุช ุงูุตูุงุบุฉ โ](4-forging-assignments.md)

---

# ุงููุตู ุงูุซุงูุซ: ุฅุฌูุงุน ูุนูููุฉ ุชุนุฏูู Bitcoin-PoCX

ุงูููุงุตูุงุช ุงูุชูููุฉ ุงููุงููุฉ ูุขููุฉ ุฅุฌูุงุน PoCX (ุงูุฌูู ุงูุชุงูู ูู ุฅุซุจุงุช ุงูุณุนุฉ) ูุนูููุฉ ุงูุชุนุฏูู ุงููุฏูุฌุฉ ูู Bitcoin Core.

---

## ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุจููุฉ ุงูุฅุฌูุงุน](#ุจููุฉ-ุงูุฅุฌูุงุน)
3. [ุนูููุฉ ุงูุชุนุฏูู](#ุนูููุฉ-ุงูุชุนุฏูู)
4. [ุงูุชุญูู ูู ุงููุชูุฉ](#ุงูุชุญูู-ูู-ุงููุชูุฉ)
5. [ูุธุงู ุงูุชุนููู](#ูุธุงู-ุงูุชุนููู)
6. [ูุดุฑ ุงูุดุจูุฉ](#ูุดุฑ-ุงูุดุจูุฉ)
7. [ุงูุชูุงุตูู ุงูุชูููุฉ](#ุงูุชูุงุตูู-ุงูุชูููุฉ)

---

## ูุธุฑุฉ ุนุงูุฉ

ููููุฐ Bitcoin-PoCX ุขููุฉ ุฅุฌูุงุน ุฅุซุจุงุช ุงูุณุนุฉ ุงูุฎุงูุตุฉ ูุจุฏูู ูุงูู ูุฅุซุจุงุช ุงูุนูู ูู Bitcoin. ูุฐู ุณูุณูุฉ ุฌุฏูุฏุฉ ุจุฏูู ูุชุทูุจุงุช ุชูุงูู ุนูุณู.

**ุงูุฎุตุงุฆุต ุงูุฑุฆูุณูุฉ:**
- **ููุงุกุฉ ุงูุทุงูุฉ:** ุงูุชุนุฏูู ูุณุชุฎุฏู ูููุงุช ุฑุณู ูููููุฏุฉ ูุณุจูุงู ุจุฏูุงู ูู ุงูุชุฌุฒุฆุฉ ุงูุญุณุงุจูุฉ
- **ููุงุนูุฏ ููุงุฆูุฉ ูุซููุฉ ุงูููุช:** ุชุญููู ุงูุชูุฒูุน (ุฃุณูโูุฑุจุน ูุงู) ูููู ุงููุชู ุงูุทูููุฉุ ูุญุณูู ูุชูุณุท ุฃููุงุช ุงููุชู
- **ุฏุนู ุงูุชุนููู:** ูููู ููุงููู ุงูุฑุณู ุชูููุถ ุญููู ุงูุตูุงุบุฉ ูุนูุงููู ุฃุฎุฑู
- **ุชูุงูู C++ ุฃุตูู:** ุฎูุงุฑุฒููุงุช ุงูุชุดููุฑ ูููุฐุฉ ุจู C++ ููุชุญูู ูู ุงูุฅุฌูุงุน

**ุชุฏูู ุงูุชุนุฏูู:**
```
ููุนุฏูู ุฎุงุฑุฌู โ get_mining_info โ ุญุณุงุจ Nonce โ submit_nonce โ
ุทุงุจูุฑ ุงูุตูุงุบุฉ โ ุงูุชุธุงุฑ ุงูููุนุฏ ุงูููุงุฆู โ ุตูุงุบุฉ ุงููุชูุฉ โ ูุดุฑ ุงูุดุจูุฉ โ
ุงูุชุญูู ูู ุงููุชูุฉ โ ุชูุณูุน ุงูุณูุณูุฉ
```

---

## ุจููุฉ ุงูุฅุฌูุงุน

### ูููู ุงููุชูุฉ

ูุชู PoCX ุชูุณูุน ูููู ูุชูุฉ Bitcoin ุจุญููู ุฅุฌูุงุน ุฅุถุงููุฉ:

```cpp
struct PoCXProof {
    std::array<uint8_t, 32> seed;             // ุจุฐุฑุฉ ุงูุฑุณู (32 ุจุงูุช)
    std::array<uint8_t, 20> account_id;       // ุนููุงู ุงูุฑุณู (hash160 20 ุจุงูุช)
    uint32_t compression;                     // ูุณุชูู ุงููููุงุณ (1-255)
    uint64_t nonce;                           // nonce ุงูุชุนุฏูู (64-bit)
    uint64_t quality;                         // ุงูุฌูุฏุฉ ุงูููุฏูุนุงุฉ (ูุฎุฑุฌ ุชุฌุฒุฆุฉ PoC)
};

class CBlockHeader {
    // ุญููู Bitcoin ุงูููุงุณูุฉ
    int32_t nVersion;
    uint256 hashPrevBlock;
    uint256 hashMerkleRoot;
    uint32_t nTime;

    // ุญููู ุฅุฌูุงุน PoCX (ุชุญู ูุญู nBits ู nNonce)
    int nHeight;                              // ุงุฑุชูุงุน ุงููุชูุฉ (ุชุญูู ุจุฏูู ุณูุงู)
    uint256 generationSignature;              // ุชูููุน ุงูุชูููุฏ (ุฅูุชุฑูุจูุง ุงูุชุนุฏูู)
    uint64_t nBaseTarget;                     // ูุนููุฉ ุงูุตุนูุจุฉ (ุตุนูุจุฉ ุนูุณูุฉ)
    PoCXProof pocxProof;                      // ุฅุซุจุงุช ุงูุชุนุฏูู

    // ุญููู ุชูููุน ุงููุชูุฉ
    std::array<uint8_t, 33> vchPubKey;        // ููุชุงุญ ุนุงู ูุถุบูุท (33 ุจุงูุช)
    std::array<uint8_t, 65> vchSignature;     // ุชูููุน ูุถุบูุท (65 ุจุงูุช)
};

class CBlock : public CBlockHeader {
    std::vector<CTransactionRef> vtx;         // ุงููุนุงููุงุช
};
```

**ููุงุญุธุฉ:** ุงูุชูููุน (`vchSignature`) ูุณุชุจุนุฏ ูู ุญุณุงุจ ุชุฌุฒุฆุฉ ุงููุชูุฉ ูููุน ุงููุงุจููุฉ ููุชุบููุฑ.

**ุงูุชูููุฐ:** `src/primitives/block.h`

### ุชูููุน ุงูุชูููุฏ

ุชูููุน ุงูุชูููุฏ ูุฎูู ุฅูุชุฑูุจูุง ุงูุชุนุฏูู ููููุน ูุฌูุงุช ุงูุญุณุงุจ ุงููุณุจู.

**ุงูุญุณุงุจ:**
```
generationSignature = SHA256(prev_generationSignature || prev_miner_pubkey)
```

**ูุชูุฉ ุงูุชูููู:** ุชุณุชุฎุฏู ุชูููุน ุชูููุฏ ุฃููู ููุดููุฑ

**ุงูุชูููุฐ:** `src/pocx/node/node.cpp:GetNewBlockContext()`

### ุงููุฏู ุงูุฃุณุงุณู (ุงูุตุนูุจุฉ)

ุงููุฏู ุงูุฃุณุงุณู ูู ูุนููุณ ุงูุตุนูุจุฉ - ููู ุฃุนูู ุชุนูู ุชุนุฏูู ุฃุณูู.

**ุฎูุงุฑุฒููุฉ ุงูุชุนุฏูู:**
- ูุฏู ููุช ุงููุชูุฉ: 120 ุซุงููุฉ (ุงูุดุจูุฉ ุงูุฑุฆูุณูุฉ)ุ 1 ุซุงููุฉ (regtest)
- ูุชุฑุฉ ุงูุชุนุฏูู: ูู ูุชูุฉ
- ูุณุชุฎุฏู ุงููุชูุณุท ุงููุชุญุฑู ููุฃูุฏุงู ุงูุฃุณุงุณูุฉ ุงูุฃุฎูุฑุฉ
- ูุญุฏูุฏ ูููุน ุชููุจุงุช ุงูุตุนูุจุฉ ุงูุดุฏูุฏุฉ

**ุงูุชูููุฐ:** `src/consensus/params.h`ุ ููุทู ุชุนุฏูู ุงูุตุนูุจุฉ ูู ุฅูุดุงุก ุงููุชูุฉ

### ูุณุชููุงุช ุงููููุงุณ

ูุฏุนู PoCX ุฅุซุจุงุช ุงูุนูู ุงููุงุจู ููุชุทููุฑ ูู ูููุงุช ุงูุฑุณู ูู ุฎูุงู ูุณุชููุงุช ุงููููุงุณ (Xn).

**ุงูุญุฏูุฏ ุงูุฏููุงููููุฉ:**
```cpp
struct CompressionBounds {
    uint8_t nPoCXMinCompression;     // ุงูุญุฏ ุงูุฃุฏูู ุงูููุจูู
    uint8_t nPoCXTargetCompression;  // ุงููุณุชูู ุงูููุตู ุจู
};
```

**ุฌุฏูู ุฒูุงุฏุฉ ุงููููุงุณ:**
- ูุชุฑุงุช ุฃุณูุฉ: ุงูุณููุงุช 4ุ 12ุ 28ุ 60ุ 124 (ุงูุชูุตููุงุช 1ุ 3ุ 7ุ 15ุ 31)
- ุงูุญุฏ ุงูุฃุฏูู ููุณุชูู ุงููููุงุณ ูุฒุฏุงุฏ ุจู 1
- ุงููุณุชูู ุงููุณุชูุฏู ูููููุงุณ ูุฒุฏุงุฏ ุจู 1
- ูุญุงูุธ ุนูู ูุงูุด ุงูุฃูุงู ุจูู ุชูุงููู ุฅูุดุงุก ุงูุฑุณู ูุงูุจุญุซ
- ุฃูุตู ูุณุชูู ูููุงุณ: 255

**ุงูุชูููุฐ:** `src/pocx/algorithms/algorithms.h:GetPoCXCompressionBounds()`

---

## ุนูููุฉ ุงูุชุนุฏูู

### 1. ุงุณุชุฑุฌุงุน ูุนูููุงุช ุงูุชุนุฏูู

**ุฃูุฑ RPC:** `get_mining_info`

**ุงูุนูููุฉ:**
1. ุงุณุชุฏุนุงุก `GetNewBlockContext(chainman)` ูุฌูุจ ุญุงูุฉ ุณูุณูุฉ ุงููุชู ุงูุญุงููุฉ
2. ุญุณุงุจ ุญุฏูุฏ ุงูุถุบุท ุงูุฏููุงููููุฉ ููุงุฑุชูุงุน ุงูุญุงูู
3. ุฅุฑุฌุงุน ูุนููุงุช ุงูุชุนุฏูู

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "generation_signature": "abc123...",
  "base_target": 18325193796,
  "height": 12345,
  "block_hash": "def456...",
  "target_quality": 18446744073709551615,
  "minimum_compression_level": 0,
  "target_compression_level": 0
}
```

**ุงูุชูููุฐ:** `src/pocx/rpc/mining.cpp:get_mining_info()`

**ููุงุญุธุงุช:**
- ูุง ุฃููุงู ูุญุชุฌุฒุฉ ุฃุซูุงุก ุชูููุฏ ุงูุงุณุชุฌุงุจุฉ
- ุงุณุชุญูุงุฐ ุงูุณูุงู ูุชุนุงูู ูุน `cs_main` ุฏุงุฎููุงู
- `block_hash` ูุถููู ูููุฑุฌุน ููู ูุง ููุณุชุฎุฏู ูู ุงูุชุญูู

### 2. ุงูุชุนุฏูู ุงูุฎุงุฑุฌู

**ูุณุคูููุงุช ุงูููุนุฏูู ุงูุฎุงุฑุฌู:**
1. ูุฑุงุกุฉ ูููุงุช ุงูุฑุณู ูู ุงููุฑุต
2. ุญุณุงุจ scoop ุจูุงุกู ุนูู ุชูููุน ุงูุชูููุฏ ูุงูุงุฑุชูุงุน
3. ุฅูุฌุงุฏ nonce ุจุฃูุถู ููุนุฏ ููุงุฆู
4. ุงูุฅุฑุณุงู ููุนูุฏุฉ ุนุจุฑ `submit_nonce`

**ุตูุบุฉ ููู ุงูุฑุณู:**
- ูุจููุฉ ุนูู ุตูุบุฉ POC2 (Burstcoin)
- ูุนุฒุฒุฉ ุจุฅุตูุงุญุงุช ุฃูููุฉ ูุชุญุณููุงุช ูุงุจููุฉ ุงูุชูุณุน
- ุฑุงุฌุน ุงูุฅุณูุงุฏ ูู `CLAUDE.md`

**ุชูููุฐ ุงูููุนุฏูู:** ุฎุงุฑุฌู (ูุซูุงูุ ูุจูู ุนูู Scavenger)

### 3. ุฅุฑุณุงู ูุงูุชุญูู ูู Nonce

**ุฃูุฑ RPC:** `submit_nonce`

**ุงููุนููุงุช:**
```
height, generation_signature, account_id, seed, nonce, quality (ุงุฎุชูุงุฑู)
```

**ุชุฏูู ุงูุชุญูู (ุชุฑุชูุจ ูุญุณูู):**

#### ุงูุฎุทูุฉ 1: ุงูุชุญูู ุงูุณุฑูุน ูู ุงูุตูุบุฉ
```cpp
// Account ID: 40 ุญุฑู hex = 20 ุจุงูุช
if (account_id.length() != 40 || !IsHex(account_id)) reject;

// Seed: 64 ุญุฑู hex = 32 ุจุงูุช
if (seed.length() != 64 || !IsHex(seed)) reject;
```

#### ุงูุฎุทูุฉ 2: ุงุณุชุญูุงุฐ ุงูุณูุงู
```cpp
auto context = pocx::consensus::GetNewBlockContext(chainman);
// ููุฑุฌุน: height, generation_signature, base_target, block_hash
```

**ุงูููู:** `cs_main` ููุนุงูุฌ ุฏุงุฎููุงูุ ูุง ุฃููุงู ูุญุชุฌุฒุฉ ูู ุฎูุท RPC

#### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุณูุงู
```cpp
// ูุญุต ุงูุงุฑุชูุงุน
if (height != context.height) reject;

// ูุญุต ุชูููุน ุงูุชูููุฏ
if (submitted_gen_sig != context.generation_signature) reject;
```

#### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุญูุธุฉ
```cpp
// ุชุญุฏูุฏ ุงููููููุน ุงููุนุงู (ูุน ูุฑุงุนุงุฉ ุงูุชุนูููุงุช)
effective_signer = GetEffectiveSigner(plot_address, height, view);

// ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุนูุฏุฉ ุชููู ุงูููุชุงุญ ุงูุฎุงุต ูููููููุน ุงููุนุงู
if (!HaveAccountKey(effective_signer, wallet)) reject;
```

**ุฏุนู ุงูุชุนููู:** ูุฏ ููุนููู ูุงูู ุงูุฑุณู ุญููู ุงูุตูุงุบุฉ ูุนููุงู ุขุฎุฑ. ูุฌุจ ุฃู ุชููู ุงููุญูุธุฉ ููุชุงุญ ุงููููููุน ุงููุนุงูุ ููุณ ุจุงูุถุฑูุฑุฉ ูุงูู ุงูุฑุณู.

#### ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ุงูุฅุซุจุงุช
```cpp
bool success = pocx_validate_block(
    generation_signature_hex,
    base_target,
    account_payload,     // 20 ุจุงูุช
    block_height,
    nonce,
    seed,                // 32 ุจุงูุช
    min_compression,
    max_compression,
    &result             // ุงููุฎุฑุฌ: quality, deadline
);
```

**ุงูุฎูุงุฑุฒููุฉ:**
1. ูู ุชุดููุฑ ุชูููุน ุงูุชูููุฏ ูู hex
2. ุญุณุงุจ ุฃูุถู ุฌูุฏุฉ ูู ูุทุงู ุงูุถุบุท ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ูุญุณููุฉ ูู SIMD
3. ุงูุชุญูู ูู ุฃู ุงูุฌูุฏุฉ ุชุณุชููู ูุชุทูุจุงุช ุงูุตุนูุจุฉ
4. ุฅุฑุฌุงุน ูููุฉ ุงูุฌูุฏุฉ ุงูุฎุงู

**ุงูุชูููุฐ:** `src/pocx/consensus/validation.cpp:pocx_validate_block()`

#### ุงูุฎุทูุฉ 6: ุญุณุงุจ ุซูู ุงูููุช
```cpp
// ุงูููุนุฏ ุงูููุงุฆู ุงูุฎุงู ุงูููุนุฏูู ููุตุนูุจุฉ (ุจุงูุซูุงูู)
uint64_t deadline_seconds = quality / base_target;

// ููุช ุงูุตูุงุบุฉ ุงููุซูู (ุจุงูุซูุงูู)
uint64_t forge_time = CalculateTimeBendedDeadline(
    quality, base_target, block_time
);
```

**ุตูุบุฉ ุซูู ุงูููุช:**
```
Y = scale * (X^(1/3))
ุญูุซ:
  X = quality / base_target
  scale = block_time / (cbrt(block_time) * Gamma(4/3))
  Gamma(4/3) โ 0.892979511
```

**ุงูุบุฑุถ:** ูุญููู ุงูุชูุฒูุน ุงูุฃุณู ุฅูู ูุฑุจุน ูุงู. ุงูุญููู ุงูุฌูุฏุฉ ุฌุฏุงู ุชูุตุงุบ ูุงุญูุงู (ููุดุจูุฉ ููุช ููุณุญ ุงูุฃูุฑุงุต)ุ ุงูุญููู ุงูุถุนููุฉ ุชุชุญุณู. ูููู ุงููุชู ุงูุทูููุฉุ ูุญุงูุธ ุนูู ูุชูุณุท 120 ุซุงููุฉ.

**ุงูุชูููุฐ:** `src/pocx/algorithms/time_bending.cpp:CalculateTimeBendedDeadline()`

#### ุงูุฎุทูุฉ 7: ุฅุฑุณุงู ููุตุงุฆุบ
```cpp
g_pocx_scheduler->SubmitNonce(
    account_id,
    seed,
    nonce,
    raw_quality,      // ููุณ ุงูููุนุฏ ุงูููุงุฆู - ููุนุงุฏ ุญุณุงุจู ูู ุงูุตุงุฆุบ
    height,
    generation_signature
);
```

**ุชุตููู ูุงุฆู ุนูู ุงูุทุงุจูุฑ:**
- ุงูุฅุฑุณุงู ููุฌุญ ุฏุงุฆูุงู (ููุถุงู ููุทุงุจูุฑ)
- RPC ูุนูุฏ ููุฑุงู
- ุฎูุท ุงูุนุงูู ูุนุงูุฌ ุจุดูู ุบูุฑ ูุชุฒุงูู

**ุงูุชูููุฐ:** `src/pocx/rpc/mining.cpp:submit_nonce()`

### 4. ูุนุงูุฌุฉ ุทุงุจูุฑ ุงูุตุงุฆุบ

**ุงูุจููุฉ:**
- ุฎูุท ุนุงูู ูุงุญุฏ ูุณุชูุฑ
- ุทุงุจูุฑ ุฅุฑุณุงู FIFO
- ุญุงูุฉ ุตูุงุบุฉ ุจุฏูู ููู (ุฎูุท ุงูุนุงูู ููุท)
- ูุง ุฃููุงู ูุชุฏุงุฎูุฉ (ููุน ุงูุฌููุฏ)

**ุงูุญููุฉ ุงูุฑุฆูุณูุฉ ูุฎูุท ุงูุนุงูู:**
```cpp
while (!shutdown) {
    // 1. ุงูุชุญูู ูู ุงูุฅุฑุณุงูุงุช ุงูููุทุงุจูุฑุฉ
    if (has_submission) {
        ProcessSubmission(submission);
        continue;
    }

    // 2. ุงูุชุธุงุฑ ุงูููุนุฏ ุงูููุงุฆู ุฃู ุฅุฑุณุงู ุฌุฏูุฏ
    if (has_forging_state) {
        WaitForDeadlineOrNewSubmission();
    } else {
        WaitForNewSubmission();
    }
}
```

**ููุทู ProcessSubmission:**
```cpp
1. ุงูุญุตูู ุนูู ุณูุงู ุฌุฏูุฏ: GetNewBlockContext(*chainman)

2. ูุญูุตุงุช ุงูููุฏู (ุชุฌุงูู ุตุงูุช):
   - ุนุฏู ุชุทุงุจู ุงูุงุฑุชูุงุน โ ุชุฌุงูู
   - ุนุฏู ุชุทุงุจู ุชูููุน ุงูุชูููุฏ โ ุชุฌุงูู
   - ุชุบูุฑ ุชุฌุฒุฆุฉ ูุชูุฉ ุงูุฑุฃุณ (ุฅุนุงุฏุฉ ุชูุธูู) โ ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุตูุงุบุฉ

3. ููุงุฑูุฉ ุงูุฌูุฏุฉ:
   - ุฅุฐุง ูุงูุช ุงูุฌูุฏุฉ >= ุงูุฃูุถู ุงูุญุงูู โ ุชุฌุงูู

4. ุญุณุงุจ ุงูููุนุฏ ุงูููุงุฆู ุงููุซูู ููููุช:
   deadline = CalculateTimeBendedDeadline(quality, base_target, block_time)

5. ุชุญุฏูุซ ุญุงูุฉ ุงูุตูุงุบุฉ:
   - ุฅูุบุงุก ุงูุตูุงุบุฉ ุงูููุฌูุฏุฉ (ุฅุฐุง ููุฌุฏ ุฃูุถู)
   - ุชุฎุฒูู: account_id, seed, nonce, quality, deadline
   - ุญุณุงุจ: forge_time = block_time + deadline_seconds
   - ุชุฎุฒูู ุชุฌุฒุฆุฉ ุงูุฑุฃุณ ููุดู ุฅุนุงุฏุฉ ุงูุชูุธูู
```

**ุงูุชูููุฐ:** `src/pocx/mining/scheduler.cpp:ProcessSubmission()`

### 5. ุงูุชุธุงุฑ ุงูููุนุฏ ุงูููุงุฆู ูุตูุงุบุฉ ุงููุชูุฉ

**WaitForDeadlineOrNewSubmission:**

**ุดุฑูุท ุงูุงูุชุธุงุฑ:**
```cpp
condition_variable.wait_until(forge_time, [&] {
    return shutdown ||
           !submission_queue.empty() ||
           forging_cancelled;
});
```

**ุนูุฏ ุงููุตูู ููููุนุฏ ุงูููุงุฆู - ุงูุชุญูู ูู ุงูุณูุงู ุงูุฌุฏูุฏ:**
```cpp
1. ุงูุญุตูู ุนูู ุงูุณูุงู ุงูุญุงูู: GetNewBlockContext(*chainman)

2. ุงูุชุญูู ูู ุงูุงุฑุชูุงุน:
   if (forging_height != current_height) {
       reset_forging_state();
       return;
   }

3. ุงูุชุญูู ูู ุชูููุน ุงูุชูููุฏ:
   if (forging_gen_sig != current_gen_sig) {
       reset_forging_state();
       return;
   }

4. ุญุงูุฉ ุญุงูุฉ ุงููุฏู ุงูุฃุณุงุณู:
   if (forging_base_target != current_base_target) {
       // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูููุนุฏ ุงูููุงุฆู ูุน ุงููุฏู ุงูุฃุณุงุณู ุงูุฌุฏูุฏ
       new_deadline = CalculateTimeBendedDeadline(quality, new_base_target, block_time);
       update_forge_time(new_deadline);
       return; // ุงูุชุธุงุฑ ูุฑุฉ ุฃุฎุฑู
   }

5. ูู ุดูุก ุตุงูุญ โ ForgeBlock()
```

**ุนูููุฉ ForgeBlock:**

```cpp
1. ุชุญุฏูุฏ ุงููููููุน ุงููุนุงู (ุฏุนู ุงูุชุนููู):
   effective_signer = GetEffectiveSigner(plot_address, height, view);

2. ุฅูุดุงุก ุณูุฑูุจุช coinbase:
   coinbase_script = P2WPKH(effective_signer);  // ูุฏูุน ูููููููุน ุงููุนุงู

3. ุฅูุดุงุก ูุงูุจ ุงููุชูุฉ:
   options.coinbase_output_script = coinbase_script;
   options.use_mempool = true;
   template = mining->createNewBlock(options);

4. ุฅุถุงูุฉ ุฅุซุจุงุช PoCX:
   block.pocxProof.account_id = plot_address;    // ุนููุงู ุงูุฑุณู ุงูุฃุตูู
   block.pocxProof.seed = seed;
   block.pocxProof.nonce = nonce;

5. ุฅุนุงุฏุฉ ุญุณุงุจ ุฌุฐุฑ ููุฑูู:
   block.hashMerkleRoot = BlockMerkleRoot(block);

6. ุชูููุน ุงููุชูุฉ:
   // ุงุณุชุฎุฏุงู ููุชุงุญ ุงููููููุน ุงููุนุงู (ูุฏ ูุฎุชูู ุนู ูุงูู ุงูุฑุณู)
   hash = PoCXBlockSignatureHash(block.GetHash());
   key.SignCompact(hash, signature);
   block.vchSignature = signature;
   block.vchPubKey = effective_signer_pubkey;

7. ุงูุฅุฑุณุงู ููุณูุณูุฉ:
   chainman->ProcessNewBlock(block, force=true, min_pow_checked=true);

8. ูุนุงูุฌุฉ ุงููุชูุฌุฉ:
   if (accepted) {
       log_success();
       reset_forging_state();  // ุฌุงูุฒ ูููุชูุฉ ุงูุชุงููุฉ
   } else {
       log_failure();
       reset_forging_state();
   }
```

**ุงูุชูููุฐ:** `src/pocx/mining/scheduler.cpp:ForgeBlock()`

**ูุฑุงุฑุงุช ุงูุชุตููู ุงูุฑุฆูุณูุฉ:**
- Coinbase ูุฏูุน ูููููููุน ุงููุนุงู (ูุญุชุฑู ุงูุชุนูููุงุช)
- ุงูุฅุซุจุงุช ูุญุชูู ุนููุงู ุงูุฑุณู ุงูุฃุตูู (ููุชุญูู)
- ุงูุชูููุน ูู ููุชุงุญ ุงููููููุน ุงููุนุงู (ุฅุซุจุงุช ุงูููููุฉ)
- ุฅูุดุงุก ุงููุงูุจ ูุชุถูู ูุนุงููุงุช mempool ุชููุงุฆูุงู

---

## ุงูุชุญูู ูู ุงููุชูุฉ

### ุชุฏูู ุงูุชุญูู ูู ุงููุชู ุงููุงุฑุฏุฉ

ุนูุฏ ุงุณุชูุงู ูุชูุฉ ูู ุงูุดุจูุฉ ุฃู ุฅุฑุณุงููุง ูุญููุงูุ ุชุฎุถุน ููุชุญูู ูู ูุฑุงุญู ูุชุนุฏุฏุฉ:

### ุงููุฑุญูุฉ 1: ุงูุชุญูู ูู ุงูุฑุฃุณ (CheckBlockHeader)

**ุงูุชุญูู ุจุฏูู ุณูุงู:**

```cpp
static bool CheckBlockHeader(
    const CBlockHeader& block,
    BlockValidationState& state,
    const Consensus::Params& consensusParams,
    bool fCheckPOW = true
)
```

**ุชุญูู PoCX (ุนูุฏ ุชุนุฑูู ENABLE_POCX):**
```cpp
if (block.nHeight > 0 && fCheckPOW) {
    // ุงูุชุญูู ุงูุฃุณุงุณู ูู ุงูุชูููุน (ูุง ุฏุนู ุชุนููู ุจุนุฏ)
    if (!VerifyPoCXBlockCompactSignature(block)) {
        return state.Invalid(BLOCK_INVALID_HEADER, "bad-pocx-sig");
    }
}
```

**ุงูุชุญูู ุงูุฃุณุงุณู ูู ุงูุชูููุน:**
1. ุงูุชุญูู ูู ูุฌูุฏ ุญููู pubkey ูุงูุชูููุน
2. ุงูุชุญูู ูู ุญุฌู pubkey (33 ุจุงูุช ูุถุบูุท)
3. ุงูุชุญูู ูู ุญุฌู ุงูุชูููุน (65 ุจุงูุช ูุถุบูุท)
4. ุงุณุชุฑุฏุงุฏ pubkey ูู ุงูุชูููุน: `pubkey.RecoverCompact(hash, signature)`
5. ุงูุชุญูู ูู ุชุทุงุจู pubkey ุงููุณุชุฑุฏ ูุน pubkey ุงูููุฎุฒูู

**ุงูุชูููุฐ:** `src/validation.cpp:CheckBlockHeader()`
**ููุทู ุงูุชูููุน:** `src/pocx/consensus/pocx.cpp:VerifyPoCXBlockCompactSignature()`

### ุงููุฑุญูุฉ 2: ุงูุชุญูู ูู ุงููุชูุฉ (CheckBlock)

**ูุชุญูู ูู:**
- ุตุญุฉ ุฌุฐุฑ ููุฑูู
- ุตูุงุญูุฉ ุงููุนุงููุงุช
- ูุชุทูุจุงุช Coinbase
- ุญุฏูุฏ ุญุฌู ุงููุชูุฉ
- ููุงุนุฏ ุฅุฌูุงุน Bitcoin ุงูููุงุณูุฉ

**ุงูุชูููุฐ:** `src/consensus/validation.cpp:CheckBlock()`

### ุงููุฑุญูุฉ 3: ุงูุชุญูู ุงูุณูุงูู ูู ุงูุฑุฃุณ (ContextualCheckBlockHeader)

**ุงูุชุญูู ุงูุฎุงุต ุจู PoCX:**

```cpp
#ifdef ENABLE_POCX
    // ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู ุชูููุน ุงูุชูููุฏ
    uint256 expected_gen_sig = CalculateGenerationSignature(pindexPrev);
    if (block.generationSignature != expected_gen_sig) {
        return state.Invalid(BLOCK_INVALID_HEADER, "bad-gen-sig");
    }

    // ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงููุฏู ุงูุฃุณุงุณู
    uint64_t expected_base_target = CalculateNextBaseTarget(pindexPrev, block.nTime);
    if (block.nBaseTarget != expected_base_target) {
        return state.Invalid(BLOCK_INVALID_HEADER, "bad-diff");
    }

    // ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุฅุซุจุงุช ุงูุณุนุฉ
    auto compression_bounds = GetPoCXCompressionBounds(block.nHeight, halving_interval);
    auto result = ValidateProofOfCapacity(
        block.generationSignature,
        block.pocxProof,
        block.nBaseTarget,
        block.nHeight,
        compression_bounds.nPoCXMinCompression,
        compression_bounds.nPoCXTargetCompression,
        block_time
    );

    if (!result.is_valid) {
        return state.Invalid(BLOCK_INVALID_HEADER, "bad-pocx-proof");
    }

    // ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุชูููุช ุงูููุนุฏ ุงูููุงุฆู
    uint32_t elapsed_time = block.nTime - pindexPrev->nTime;
    if (result.deadline > elapsed_time) {
        return state.Invalid(BLOCK_INVALID_HEADER, "pocx-deadline-not-met");
    }
#endif
```

**ุฎุทูุงุช ุงูุชุญูู:**
1. **ุชูููุน ุงูุชูููุฏ:** ูุฌุจ ุฃู ูุทุงุจู ุงููููุฉ ุงููุญุณูุจุฉ ูู ุงููุชูุฉ ุงูุณุงุจูุฉ
2. **ุงููุฏู ุงูุฃุณุงุณู:** ูุฌุจ ุฃู ูุทุงุจู ุญุณุงุจ ุชุนุฏูู ุงูุตุนูุจุฉ
3. **ูุณุชูู ุงููููุงุณ:** ูุฌุจ ุฃู ูุณุชููู ุงูุญุฏ ุงูุฃุฏูู ููุดุจูุฉ (`compression >= min_compression`)
4. **ุงุฏุนุงุก ุงูุฌูุฏุฉ:** ุงูุฌูุฏุฉ ุงูููุฑุณูุฉ ูุฌุจ ุฃู ุชุทุงุจู ุงูุฌูุฏุฉ ุงููุญุณูุจุฉ ูู ุงูุฅุซุจุงุช
5. **ุฅุซุจุงุช ุงูุณุนุฉ:** ุงูุชุญูู ูู ุงูุฅุซุจุงุช ุงูุชุดููุฑู (ูุญุณูู ูู SIMD)
6. **ุชูููุช ุงูููุนุฏ ุงูููุงุฆู:** ุงูููุนุฏ ุงูููุงุฆู ุงููุซูู ููููุช (`poc_time`) ูุฌุจ ุฃู ูููู โค ุงูููุช ุงููููุถู

**ุงูุชูููุฐ:** `src/validation.cpp:ContextualCheckBlockHeader()`

### ุงููุฑุญูุฉ 4: ุงุชุตุงู ุงููุชูุฉ (ConnectBlock)

**ุงูุชุญูู ุงูุณูุงูู ุงููุงูู:**

```cpp
#ifdef ENABLE_POCX
    // ุงูุชุญูู ุงูููุณุน ูู ุงูุชูููุน ูุน ุฏุนู ุงูุชุนููู
    if (pindex->nHeight > 0 && !fJustCheck) {
        if (!VerifyPoCXBlockCompactSignature(block, view, pindex->nHeight)) {
            return state.Invalid(BLOCK_CONSENSUS, "bad-pocx-assignment-sig");
        }
    }
#endif
```

**ุงูุชุญูู ุงูููุณุน ูู ุงูุชูููุน:**
1. ุชูููุฐ ุงูุชุญูู ุงูุฃุณุงุณู ูู ุงูุชูููุน
2. ุงุณุชุฎุฑุงุฌ account ID ูู pubkey ุงููุณุชุฑุฏ
3. ุงูุญุตูู ุนูู ุงููููููุน ุงููุนุงู ูุนููุงู ุงูุฑุณู: `GetEffectiveSigner(plot_address, height, view)`
4. ุงูุชุญูู ูู ุชุทุงุจู ุญุณุงุจ pubkey ูุน ุงููููููุน ุงููุนุงู

**ููุทู ุงูุชุนููู:**
```cpp
std::array<uint8_t, 20> GetEffectiveSigner(
    const std::array<uint8_t, 20>& plotAddress,
    int nHeight,
    const CCoinsViewCache& view
) {
    auto assignment = view.GetForgingAssignment(plotAddress, nHeight);

    if (assignment.has_value() && assignment->IsActiveAtHeight(nHeight)) {
        return assignment->forgingAddress;  // ุฅุฑุฌุงุน ุงููููููุน ุงูููุนููู
    }

    return plotAddress;  // ูุง ุชุนููู - ูุงูู ุงูุฑุณู ูููููุน
}
```

**ุงูุชูููุฐ:**
- ุงูุงุชุตุงู: `src/validation.cpp:ConnectBlock()`
- ุงูุชุญูู ุงูููุณุน: `src/pocx/consensus/pocx.cpp:VerifyPoCXBlockCompactSignature()`
- ููุทู ุงูุชุนููู: `src/pocx/consensus/validation.cpp:GetEffectiveSigner()`

### ุงููุฑุญูุฉ 5: ุชูุนูู ุงูุณูุณูุฉ

**ุชุฏูู ProcessNewBlock:**
```cpp
bool ProcessNewBlock(const std::shared_ptr<const CBlock>& block,
                    bool force_processing,
                    bool min_pow_checked,
                    bool* new_block)
{
    1. AcceptBlock โ ุงูุชุญูู ูุงูุชุฎุฒูู ุนูู ุงููุฑุต
    2. ActivateBestChain โ ุชุญุฏูุซ ุฑุฃุณ ุงูุณูุณูุฉ ุฅุฐุง ูุงูุช ูุฐู ุฃูุถู ุณูุณูุฉ
    3. ุฅุฎุทุงุฑ ุงูุดุจูุฉ ุจุงููุชูุฉ ุงูุฌุฏูุฏุฉ
}
```

**ุงูุชูููุฐ:** `src/validation.cpp:ProcessNewBlock()`

### ููุฎุต ุงูุชุญูู

**ูุณุงุฑ ุงูุชุญูู ุงููุงูู:**
```
ุงุณุชูุงู ุงููุชูุฉ
    โ
CheckBlockHeader (ุงูุชูููุน ุงูุฃุณุงุณู)
    โ
CheckBlock (ุงููุนุงููุงุชุ ููุฑูู)
    โ
ContextualCheckBlockHeader (ุชูููุน ุงูุชูููุฏุ ุงููุฏู ุงูุฃุณุงุณูุ ุฅุซุจุงุช PoCุ ุงูููุนุฏ ุงูููุงุฆู)
    โ
ConnectBlock (ุงูุชูููุน ุงูููุณุน ูุน ุงูุชุนูููุงุชุ ุงูุชูุงูุงุช ุงูุญุงูุฉ)
    โ
ActivateBestChain (ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุงูุชูุธููุ ุชูุณูุน ุงูุณูุณูุฉ)
    โ
ูุดุฑ ุงูุดุจูุฉ
```

---

## ูุธุงู ุงูุชุนููู

### ูุธุฑุฉ ุนุงูุฉ

ุชุณูุญ ุงูุชุนูููุงุช ููุงููู ุงูุฑุณู ุจุชูููุถ ุญููู ุงูุตูุงุบุฉ ูุนูุงููู ุฃุฎุฑู ูุน ุงูุญูุงุธ ุนูู ููููุฉ ุงูุฑุณู.

**ุญุงูุงุช ุงูุงุณุชุฎุฏุงู:**
- ุชุนุฏูู ุงููุฌูุนุงุช (ุงูุฑุณููุงุช ุชูุนููู ูุนููุงู ุงููุฌูุน)
- ุงูุชุฎุฒูู ุงูุจุงุฑุฏ (ููุชุงุญ ุงูุชุนุฏูู ูููุตู ุนู ููููุฉ ุงูุฑุณู)
- ุงูุชุนุฏูู ูุชุนุฏุฏ ุงูุฃุทุฑุงู (ุจููุฉ ุชุญุชูุฉ ูุดุชุฑูุฉ)

### ุจููุฉ ุงูุชุนููู

**ุชุตููู OP_RETURN ููุท:**
- ุงูุชุนูููุงุช ููุฎุฒููุฉ ูู ูุฎุฑุฌุงุช OP_RETURN (ูุง UTXO)
- ูุง ูุชุทูุจุงุช ุฅููุงู (ูุง ุบุจุงุฑุ ูุง ุฑุณูู ููุงุญุชูุงุธ)
- ููุชุชุจูุนุฉ ูู ุญุงูุฉ CCoinsViewCache ุงูููุณุนุฉ
- ูููุนููุฉ ุจุนุฏ ูุชุฑุฉ ุชุฃุฎูุฑ (ุงูุชุฑุงุถู: 4 ูุชู)

**ุญุงูุงุช ุงูุชุนููู:**
```cpp
enum class ForgingState : uint8_t {
    UNASSIGNED = 0,  // ูุง ุชุนููู ููุฌูุฏ
    ASSIGNING = 1,   // ุงูุชุนููู ูู ุงูุชุธุงุฑ ุงูุชูุนูู (ูุชุฑุฉ ุงูุชุฃุฎูุฑ)
    ASSIGNED = 2,    // ุงูุชุนููู ูุดุทุ ุงูุตูุงุบุฉ ูุณููุญุฉ
    REVOKING = 3,    // ุงูุฅูุบุงุก ูู ุงูุงูุชุธุงุฑ (ูุชุฑุฉ ุงูุชุฃุฎูุฑุ ูุง ูุฒุงู ูุดุทุงู)
    REVOKED = 4      // ุงูุฅูุบุงุก ููุชููุ ุงูุชุนููู ูู ูุนุฏ ูุดุทุงู
};
```

### ุฅูุดุงุก ุงูุชุนูููุงุช

**ุตูุบุฉ ุงููุนุงููุฉ:**
```cpp
Transaction {
    inputs: [any]  // ูุซุจุช ููููุฉ ุนููุงู ุงูุฑุณู
    outputs: [
        OP_RETURN <ASSIGN_MAGIC> <plot_address> <forging_address>
    ]
}
```

**ููุงุนุฏ ุงูุชุญูู:**
1. ูุฌุจ ุฃู ูููู ุงููุฏุฎู ููููุนุงู ูู ูุงูู ุงูุฑุณู (ูุซุจุช ุงูููููุฉ)
2. OP_RETURN ูุญุชูู ุจูุงูุงุช ุชุนููู ุตุงูุญุฉ
3. ูุฌุจ ุฃู ูููู ุงูุฑุณู UNASSIGNED ุฃู REVOKED
4. ูุง ุชุนูููุงุช ูุนููุฉ ููุฑุฑุฉ ูู mempool
5. ุฑุณูู ูุนุงููุฉ ุฏููุง ูุฏููุนุฉ

**ุงูุชูุนูู:**
- ูุตุจุญ ุงูุชุนููู ASSIGNING ุนูุฏ ุงุฑุชูุงุน ุงูุชุฃููุฏ
- ูุตุจุญ ASSIGNED ุจุนุฏ ูุชุฑุฉ ุงูุชุฃุฎูุฑ (4 ูุชู regtestุ 30 ูุชูุฉ mainnet)
- ุงูุชุฃุฎูุฑ ูููุน ุฅุนุงุฏุฉ ุงูุชุนููู ุงูุณุฑูุนุฉ ุฃุซูุงุก ุณุจุงูุงุช ุงููุชู

**ุงูุชูููุฐ:** `src/script/forging_assignment.h`ุ ุงูุชุญูู ูู ConnectBlock

### ุฅูุบุงุก ุงูุชุนูููุงุช

**ุตูุบุฉ ุงููุนุงููุฉ:**
```cpp
Transaction {
    inputs: [any]  // ูุซุจุช ููููุฉ ุนููุงู ุงูุฑุณู
    outputs: [
        OP_RETURN <REVOKE_MAGIC> <plot_address>
    ]
}
```

**ุงูุชุฃุซูุฑ:**
- ุงูุชูุงู ููุฑู ููุญุงูุฉ ุฅูู REVOKED
- ูุงูู ุงูุฑุณู ููููู ุงูุตูุงุบุฉ ููุฑุงู
- ูููู ุฅูุดุงุก ุชุนููู ุฌุฏูุฏ ุจุนุฏ ุฐูู

### ุงูุชุญูู ูู ุงูุชุนููู ุฃุซูุงุก ุงูุชุนุฏูู

**ุชุญุฏูุฏ ุงููููููุน ุงููุนุงู:**
```cpp
// ูู ุงูุชุญูู ูู submit_nonce
effective_signer = GetEffectiveSigner(plot_address, height, view);
if (!HaveAccountKey(effective_signer, wallet)) reject;

// ูู ุตูุงุบุฉ ุงููุชูุฉ
coinbase_script = P2WPKH(effective_signer);  // ุงูููุงูุฃุฉ ุชุฐูุจ ููุง

// ูู ุชูููุน ุงููุชูุฉ
signature = effective_signer_key.SignCompact(hash);  // ูุฌุจ ุงูุชูููุน ุจุงููููููุน ุงููุนุงู
```

**ุงูุชุญูู ูู ุงููุชูุฉ:**
```cpp
// ูู VerifyPoCXBlockCompactSignature (ููุณุน)
effective_signer = GetEffectiveSigner(proof.account_id, height, view);
pubkey_account = ExtractAccountIDFromPubKey(block.vchPubKey);
if (pubkey_account != effective_signer) reject;
```

**ุงูุฎุตุงุฆุต ุงูุฑุฆูุณูุฉ:**
- ุงูุฅุซุจุงุช ูุญุชูู ุฏุงุฆูุงู ุนููุงู ุงูุฑุณู ุงูุฃุตูู
- ูุฌุจ ุฃู ูููู ุงูุชูููุน ูู ุงููููููุน ุงููุนุงู
- Coinbase ูุฏูุน ูููููููุน ุงููุนุงู
- ุงูุชุญูู ูุณุชุฎุฏู ุญุงูุฉ ุงูุชุนููู ุนูุฏ ุงุฑุชูุงุน ุงููุชูุฉ

---

## ูุดุฑ ุงูุดุจูุฉ

### ุฅุนูุงู ุงููุชูุฉ

**ุจุฑูุชูููู P2P ุงูููุงุณู ูู Bitcoin:**
1. ุงููุชูุฉ ุงูููุตุงุบุฉ ุชูุฑุณู ุนุจุฑ `ProcessNewBlock()`
2. ุงููุชูุฉ ุชูุญูู ูุชูุถุงู ููุณูุณูุฉ
3. ุฅุฎุทุงุฑ ุงูุดุจูุฉ: `GetMainSignals().BlockConnected()`
4. ุทุจูุฉ P2P ุชุจุซ ุงููุชูุฉ ููุฃูุฑุงู

**ุงูุชูููุฐ:** ูุนุงูุฌุฉ ุงูุดุจูุฉ ุงูููุงุณูุฉ ูู Bitcoin Core

### ุชุฑุญูู ุงููุชูุฉ

**ุงููุชู ุงููุถุบูุทุฉ (BIP 152):**
- ุชูุณุชุฎุฏู ููุดุฑ ุงููุชู ุงููุนุงู
- ูุนุฑูุงุช ุงููุนุงููุงุช ููุท ุชูุฑุณู ูุจุฏุฆูุงู
- ุงูุฃูุฑุงู ูุทูุจูู ุงููุนุงููุงุช ุงูููููุฏุฉ

**ุชุฑุญูู ุงููุชูุฉ ุงููุงูู:**
- ุงุญุชูุงุทู ุนูุฏูุง ุชูุดู ุงููุชู ุงููุถุบูุทุฉ
- ุจูุงูุงุช ุงููุชูุฉ ุงููุงููุฉ ุชูููู

### ุฅุนุงุฏุฉ ุชูุธูู ุงูุณูุณูุฉ

**ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุงูุชูุธูู:**
```cpp
// ูู ุฎูุท ุนุงูู ุงูุตุงุฆุบ
if (current_tip_hash != stored_tip_hash) {
    // ููุดูุช ุฅุนุงุฏุฉ ุชูุธูู ุงูุณูุณูุฉ
    reset_forging_state();
    log("Chain tip changed, resetting forging");
}
```

**ูุณุชูู ุณูุณูุฉ ุงููุชู:**
- ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุงูุชูุธูู ุงูููุงุณูุฉ ูู Bitcoin Core
- ุฃูุถู ุณูุณูุฉ ุชูุญุฏุฏ ุจู chainwork
- ุงููุชู ุงููููุตูุฉ ุชูุนุงุฏ ูู mempool

---

## ุงูุชูุงุตูู ุงูุชูููุฉ

### ููุน ุงูุฌููุฏ

**ููุท ุฌููุฏ ABBA (ููููุน):**
```
ุงูุฎูุท A: cs_main โ cs_wallet
ุงูุฎูุท B: cs_wallet โ cs_main
```

**ุงูุญู:**
1. **submit_nonce:** ุตูุฑ ุงุณุชุฎุฏุงู ูู cs_main
   - `GetNewBlockContext()` ูุชุนุงูู ูุน ุงูููู ุฏุงุฎููุงู
   - ูู ุงูุชุญูู ูุจู ุฅุฑุณุงู ุงูุตุงุฆุบ

2. **ุงูุตุงุฆุบ:** ุจููุฉ ูุงุฆูุฉ ุนูู ุงูุทุงุจูุฑ
   - ุฎูุท ุนุงูู ูุงุญุฏ (ูุง ุงูุถูุงู ุฎููุท)
   - ุณูุงู ุฌุฏูุฏ ุนูุฏ ูู ูุตูู
   - ูุง ุฃููุงู ูุชุฏุงุฎูุฉ

3. **ูุญูุตุงุช ุงููุญูุธุฉ:** ุชูููุฐ ูุจู ุงูุนูููุงุช ุงูููููุฉ
   - ุฑูุถ ูุจูุฑ ุฅุฐุง ูู ูุชููุฑ ููุชุงุญ
   - ูููุตูุฉ ุนู ูุตูู ุญุงูุฉ ุณูุณูุฉ ุงููุชู

### ุชุญุณููุงุช ุงูุฃุฏุงุก

**ุงูุชุญูู ุจุงููุดู ุงูุณุฑูุน:**
```cpp
1. ูุญูุตุงุช ุงูุตูุบุฉ (ููุฑูุฉ)
2. ุงูุชุญูู ูู ุงูุณูุงู (ุฎููู)
3. ุงูุชุญูู ูู ุงููุญูุธุฉ (ูุญูู)
4. ุงูุชุญูู ูู ุงูุฅุซุจุงุช (SIMD ูููู)
```

**ุฌูุจ ุณูุงู ูุงุญุฏ:**
- ุงุณุชุฏุนุงุก `GetNewBlockContext()` ูุงุญุฏ ููู ุฅุฑุณุงู
- ุชุฎุฒูู ุงููุชุงุฆุฌ ูุคูุชุงู ููุญูุตุงุช ูุชุนุฏุฏุฉ
- ูุง ุงุณุชุญูุงุฐุงุช ูุชูุฑุฑุฉ ุนูู cs_main

**ููุงุกุฉ ุงูุทุงุจูุฑ:**
- ูููู ุฅุฑุณุงู ุฎููู
- ูุง base_target/deadline ูู ุงูุทุงุจูุฑ (ููุนุงุฏ ุญุณุงุจูุง ุญุฏูุซุงู)
- ุจุตูุฉ ุฐุงูุฑุฉ ุฏููุง

### ูุนุงูุฌุฉ ุงูููุฏู

**ุชุตููู ุตุงุฆุบ "ุจุณูุท":**
- ูุง ุงุดุชุฑุงูุงุช ูู ุฃุญุฏุงุซ ุณูุณูุฉ ุงููุชู
- ุชุญูู ูุณูู ุนูุฏ ุงูุญุงุฌุฉ
- ุชุฌุงูู ุตุงูุช ููุฅุฑุณุงูุงุช ุงููุฏููุฉ

**ุงูููุงุฆุฏ:**
- ุจููุฉ ุจุณูุทุฉ
- ูุง ูุฒุงููุฉ ูุนูุฏุฉ
- ูุชูู ุถุฏ ุงูุญุงูุงุช ุงูุญุงูุฉ

**ุงูุญุงูุงุช ุงูุญุงูุฉ ุงูููุนุงูุฌุฉ:**
- ุชุบููุฑุงุช ุงูุงุฑุชูุงุน โ ุชุฌุงูู
- ุชุบููุฑุงุช ุชูููุน ุงูุชูููุฏ โ ุชุฌุงูู
- ุชุบููุฑุงุช ุงููุฏู ุงูุฃุณุงุณู โ ุฅุนุงุฏุฉ ุญุณุงุจ ุงูููุนุฏ ุงูููุงุฆู
- ุฅุนุงุฏุฉ ุงูุชูุธูู โ ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุตูุงุบุฉ

### ุงูุชูุงุตูู ุงูุชุดููุฑูุฉ

**ุชูููุน ุงูุชูููุฏ:**
```cpp
SHA256(prev_generation_signature || prev_miner_pubkey_33bytes)
```

**ุชุฌุฒุฆุฉ ุชูููุน ุงููุชูุฉ:**
```cpp
hash = SHA256(SHA256("POCX Signed Block:\n" || block_hash_hex))
```

**ุตูุบุฉ ุงูุชูููุน ุงููุถุบูุท:**
- 65 ุจุงูุช: [recovery_id][r][s]
- ูุณูุญ ุจุงุณุชุฑุฏุงุฏ ุงูููุชุงุญ ุงูุนุงู
- ููุณุชุฎุฏู ูููุงุกุฉ ุงููุณุงุญุฉ

**ูุนุฑู ุงูุญุณุงุจ:**
- HASH160 20 ุจุงูุช ููููุชุงุญ ุงูุนุงู ุงููุถุบูุท
- ูุทุงุจู ุตูุบ ุนูุงููู Bitcoin (P2PKHุ P2WPKH)

### ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

**ุงููููุฏ ุงูููุซูุฉ:**
1. ูุง ููุงููุณ ุฃุฏุงุก (ูุนุฏูุงุช ุงูุฅุฑุณุงูุ ุชูุฒูุนุงุช ุงูููุงุนูุฏ ุงูููุงุฆูุฉ)
2. ูุง ุชุตููู ููุตู ููุฃุฎุทุงุก ููููุนุฏูููู
3. ุงุณุชุนูุงู ูุญุฏูุฏ ูุญุงูุฉ ุงูุตุงุฆุบ (ุงูููุนุฏ ุงูููุงุฆู ุงูุญุงููุ ุนูู ุงูุทุงุจูุฑ)

**ุงูุชุญุณููุงุช ุงููุญุชููุฉ:**
- RPC ูุญุงูุฉ ุงูุตุงุฆุบ
- ููุงููุณ ููุงุกุฉ ุงูุชุนุฏูู
- ุชุณุฌูู ูุนุฒุฒ ููุชุตุญูุญ
- ุฏุนู ุจุฑูุชูููู ุงููุฌูุน

---

## ูุฑุงุฌุน ุงูููุฏ

**ุงูุชูููุฐุงุช ุงูุฃุณุงุณูุฉ:**
- ูุงุฌูุฉ RPC: `src/pocx/rpc/mining.cpp`
- ุทุงุจูุฑ ุงูุตุงุฆุบ: `src/pocx/mining/scheduler.cpp`
- ุงูุชุญูู ูู ุงูุฅุฌูุงุน: `src/pocx/consensus/validation.cpp`
- ุงูุชุญูู ูู ุงูุฅุซุจุงุช: `src/pocx/consensus/pocx.cpp`
- ุซูู ุงูููุช: `src/pocx/algorithms/time_bending.cpp`
- ุงูุชุญูู ูู ุงููุชูุฉ: `src/validation.cpp` (CheckBlockHeaderุ ConnectBlock)
- ููุทู ุงูุชุนููู: `src/pocx/consensus/validation.cpp:GetEffectiveSigner()`
- ุฅุฏุงุฑุฉ ุงูุณูุงู: `src/pocx/node/node.cpp:GetNewBlockContext()`

**ููุงูู ุงูุจูุงูุงุช:**
- ุตูุบุฉ ุงููุชูุฉ: `src/primitives/block.h`
- ูุนููุงุช ุงูุฅุฌูุงุน: `src/consensus/params.h`
- ุชุชุจุน ุงูุชุนููู: `src/coins.h` (ููุญูุงุช CCoinsViewCache)

---

## ุงูููุญู: ููุงุตูุงุช ุงูุฎูุงุฑุฒููุงุช

### ุตูุบุฉ ุซูู ุงูููุช

**ุงูุชุนุฑูู ุงูุฑูุงุถู:**
```
deadline_seconds = quality / base_target  (ุฎุงู)

time_bended_deadline = scale * (deadline_seconds)^(1/3)

ุญูุซ:
  scale = block_time / (cbrt(block_time) * Gamma(4/3))
  Gamma(4/3) โ 0.892979511
```

**ุงูุชูููุฐ:**
- ุญุณุงุจ ููุทุฉ ุซุงุจุชุฉ (ุตูุบุฉ Q42)
- ุญุณุงุจ ุงูุฌุฐุฑ ุงูุชูุนูุจู ุจุฃุนุฏุงุฏ ุตุญูุญุฉ ููุท
- ูุญุณูู ูุญุณุงุจ 256-bit

### ุญุณุงุจ ุงูุฌูุฏุฉ

**ุงูุนูููุฉ:**
1. ุชูููุฏ scoop ูู ุชูููุน ุงูุชูููุฏ ูุงูุงุฑุชูุงุน
2. ูุฑุงุกุฉ ุจูุงูุงุช ุงูุฑุณู ูู scoop ุงููุญุณูุจ
3. ุงูุชุฌุฒุฆุฉ: `SHABAL256(generation_signature || scoop_data)`
4. ุงุฎุชุจุงุฑ ูุณุชููุงุช ุงููููุงุณ ูู ุงูุญุฏ ุงูุฃุฏูู ููุฃูุตู
5. ุฅุฑุฌุงุน ุฃูุถู ุฌูุฏุฉ ููุฌูุฏุฉ

**ุงููููุงุณ:**
- ุงููุณุชูู X0: ุฎุท ุฃุณุงุณ POC2 (ูุธุฑู)
- ุงููุณุชูู X1: ุฎุท ุฃุณุงุณ XOR-transpose
- ุงููุณุชูู Xn: 2^(n-1) ร ุนูู X1 ูุถููู
- ูููุงุณ ุฃุนูู = ุนูู ุชูููุฏ ุฑุณู ุฃูุซุฑ

### ุชุนุฏูู ุงููุฏู ุงูุฃุณุงุณู

**ุชุนุฏูู ูู ูุชูุฉ:**
1. ุญุณุงุจ ุงููุชูุณุท ุงููุชุญุฑู ููุฃูุฏุงู ุงูุฃุณุงุณูุฉ ุงูุฃุฎูุฑุฉ
2. ุญุณุงุจ ุงููุชุฑุฉ ุงููุนููุฉ ููุงุจู ุงููุชุฑุฉ ุงููุณุชูุฏูุฉ ููุงูุฐุฉ ูุชุฏุญุฑุฌุฉ
3. ุชุนุฏูู ุงููุฏู ุงูุฃุณุงุณู ุจุงูุชูุงุณุจ
4. ุงูุชุญุฏูุฏ ูููุน ุงูุชููุจุงุช ุงูุดุฏูุฏุฉ

**ุงูุตูุบุฉ:**
```
avg_base_target = moving_average(ุงูุฃูุฏุงู ุงูุฃุณุงุณูุฉ ุงูุฃุฎูุฑุฉ)
adjustment_factor = actual_timespan / target_timespan
new_base_target = avg_base_target * adjustment_factor
new_base_target = clamp(new_base_target, min, max)
```

---

*ูุนูุณ ูุฐุง ุงูุชูุซูู ุงูุชูููุฐ ุงููุงูู ูุฅุฌูุงุน PoCX ุงุนุชุจุงุฑุงู ูู ุฃูุชูุจุฑ 2025.*

---

[โ ุงูุณุงุจู: ุตูุบุฉ ุงูุฑุณู](2-plot-format.md) | [๐ ุฌุฏูู ุงููุญุชููุงุช](index.md) | [ุงูุชุงูู: ุชุนูููุงุช ุงูุตูุงุบุฉ โ](4-forging-assignments.md)
