# Bitcoin-PoCX: Энергоэффективный консенсус для Bitcoin Core

**Версия**: 2.0 Черновик
**Дата**: Декабрь 2025
**Организация**: Proof of Capacity Consortium

---

## Аннотация

Консенсус Proof-of-Work (PoW) в Bitcoin обеспечивает надёжную безопасность, но потребляет значительную энергию из-за непрерывных вычислений хешей в реальном времени. Мы представляем Bitcoin-PoCX — форк Bitcoin, заменяющий PoW на Proof of Capacity (PoC), где майнеры предварительно вычисляют и хранят большие наборы хешей на дисках во время построения графиков, а затем майнят, выполняя легковесные операции поиска вместо постоянного хеширования. Перенося вычисления с фазы майнинга на однократную фазу построения графиков, Bitcoin-PoCX радикально снижает потребление энергии, обеспечивая при этом майнинг на обычном оборудовании, снижая барьер входа и смягчая давление централизации, присущее PoW с доминированием ASIC, при сохранении предположений о безопасности и экономического поведения Bitcoin.

Наша реализация вводит несколько ключевых инноваций:
(1) Укреплённый формат графиков, устраняющий все известные атаки компромисса время-память в существующих системах PoC, гарантируя строгую пропорциональность эффективной мощности майнинга выделенной ёмкости хранения;
(2) Алгоритм искривления времени (Time-Bending), преобразующий распределение дедлайнов из экспоненциального в хи-квадрат, уменьшая дисперсию времени блоков без изменения среднего;
(3) Механизм делегирования форджинга на основе OP_RETURN, обеспечивающий некастодиальный пул-майнинг; и
(4) Динамическое масштабирование сжатия, увеличивающее сложность генерации графиков в соответствии с графиком халвингов для поддержания долгосрочных запасов безопасности по мере совершенствования оборудования.

Bitcoin-PoCX сохраняет архитектуру Bitcoin Core через минимальные, флагированные модификации, изолируя логику PoC от существующего кода консенсуса. Система сохраняет монетарную политику Bitcoin, устанавливая целевой интервал блоков в 120 секунд и корректируя субсидию блока до 10 BTC. Уменьшенная субсидия компенсирует пятикратное увеличение частоты блоков, сохраняя долгосрочную скорость эмиссии в соответствии с оригинальным графиком Bitcoin и поддерживая максимальное предложение около 21 миллиона.

---

## 1. Введение

### 1.1 Мотивация

Консенсус Proof-of-Work (PoW) в Bitcoin доказал свою безопасность более чем за десятилетие, но со значительными издержками: майнеры должны постоянно расходовать вычислительные ресурсы, что приводит к высокому потреблению энергии. Помимо вопросов эффективности, есть более широкая мотивация: исследование альтернативных механизмов консенсуса, которые поддерживают безопасность при снижении барьера участия. PoC позволяет практически любому человеку с обычным оборудованием для хранения эффективно майнить, снижая давление централизации, наблюдаемое в майнинге PoW с доминированием ASIC.

Proof of Capacity (PoC) достигает этого, выводя мощность майнинга из обязательства по хранению, а не из постоянных вычислений. Майнеры предварительно вычисляют большие наборы хешей, хранимых на диске — графики — во время однократной фазы построения. Затем майнинг состоит из легковесных операций поиска, радикально снижая потребление энергии при сохранении предположений о безопасности консенсуса на основе ресурсов.

### 1.2 Интеграция с Bitcoin Core

Bitcoin-PoCX интегрирует консенсус PoC в Bitcoin Core, а не создаёт новый блокчейн. Этот подход использует проверенную безопасность Bitcoin Core, зрелый сетевой стек и широко принятые инструменты, сохраняя при этом модификации минимальными и флагированными. Логика PoC изолирована от существующего кода консенсуса, обеспечивая сохранение основной функциональности — валидации блоков, операций кошелька, форматов транзакций — практически без изменений.

### 1.3 Цели проектирования

**Безопасность**: Сохранение устойчивости, эквивалентной Bitcoin; атаки требуют большинства ёмкости хранения.

**Эффективность**: Снижение постоянной вычислительной нагрузки до уровня дискового ввода-вывода.

**Доступность**: Обеспечение майнинга на обычном оборудовании, снижение барьеров входа.

**Минимальная интеграция**: Введение консенсуса PoC с минимальным следом модификаций.

---

## 2. Предыстория: Proof of Capacity

### 2.1 История

Proof of Capacity (PoC) был представлен Burstcoin в 2014 году как энергоэффективная альтернатива Proof-of-Work (PoW). Burstcoin продемонстрировал, что мощность майнинга может быть выведена из выделенного хранилища, а не из непрерывного хеширования в реальном времени: майнеры предварительно вычисляли большие наборы данных («графики») один раз, а затем майнили, читая малые, фиксированные их части.

Ранние реализации PoC доказали жизнеспособность концепции, но также выявили, что формат графика и криптографическая структура критичны для безопасности. Несколько компромиссов время-память позволяли злоумышленникам эффективно майнить с меньшим хранилищем, чем честные участники. Это подчеркнуло, что безопасность PoC зависит от дизайна графика — а не просто от использования хранилища как ресурса.

Наследие Burstcoin утвердило PoC как практический механизм консенсуса и обеспечило основу, на которой строится PoCX.

### 2.2 Основные концепции

Майнинг PoC основан на больших предварительно вычисленных файлах графиков, хранимых на диске. Эти графики содержат «замороженные вычисления»: дорогое хеширование выполняется один раз при построении графика, а майнинг затем состоит из легковесного чтения с диска и простой верификации. Основные элементы включают:

**Нонс:**
Базовая единица данных графика. Каждый нонс содержит 4096 скупов (256 КиБ всего), сгенерированных через Shabal256 из адреса майнера и индекса нонса.

**Скуп:**
64-байтный сегмент внутри нонса. Для каждого блока сеть детерминированно выбирает индекс скупа (0-4095) на основе сигнатуры генерации предыдущего блока. Необходимо прочитать только этот скуп из каждого нонса.

**Сигнатура генерации:**
256-битное значение, выводимое из предыдущего блока. Обеспечивает энтропию для выбора скупа и предотвращает предсказание майнерами будущих индексов скупов.

**Варп:**
Структурная группа из 4096 нонсов (1 ГиБ). Варпы — релевантная единица для устойчивых к сжатию форматов графиков.

### 2.3 Процесс майнинга и конвейер качества

Майнинг PoC состоит из однократного этапа построения графика и легковесной процедуры для каждого блока:

**Однократная настройка:**
- Генерация графика: Вычисление нонсов через Shabal256 и запись их на диск.

**Майнинг для каждого блока:**
- Выбор скупа: Определение индекса скупа из сигнатуры генерации.
- Сканирование графика: Чтение этого скупа из всех нонсов в графиках майнера.

**Конвейер качества:**
- Сырое качество: Хеширование каждого скупа с сигнатурой генерации через Shabal256Lite для получения 64-битного значения качества (меньше — лучше).
- Дедлайн: Преобразование качества в дедлайн с использованием базовой цели (параметр, скорректированный по сложности, обеспечивающий достижение сетью целевого интервала блоков): `дедлайн = качество / базовая_цель`
- Искривлённый дедлайн: Применение преобразования искривления времени для уменьшения дисперсии при сохранении ожидаемого времени блока.

**Форджинг блока:**
Майнер с кратчайшим (искривлённым) дедлайном форджит следующий блок как только это время истечёт.

В отличие от PoW, практически все вычисления происходят при построении графика; активный майнинг преимущественно ограничен диском и очень маломощен.

### 2.4 Известные уязвимости предыдущих систем

**Дефект распределения POC1:**
Оригинальный формат Burstcoin POC1 демонстрировал структурную предвзятость: скупы с низкими индексами было значительно дешевле пересчитывать на лету, чем скупы с высокими индексами. Это ввело неравномерный компромисс время-память, позволяя злоумышленникам снижать требуемое хранилище для этих скупов и нарушая предположение о равной стоимости всех предварительно вычисленных данных.

**Атака XOR-сжатия (POC2):**
В POC2 злоумышленник может взять любой набор из 8192 нонсов и разделить их на два блока по 4096 нонсов (A и B). Вместо хранения обоих блоков злоумышленник хранит только производную структуру: `A XOR transpose(B)`, где транспонирование меняет местами индексы скупа и нонса — скуп S нонса N в блоке B становится скупом N нонса S.

Во время майнинга, когда нужен скуп S нонса N, злоумышленник восстанавливает его:
1. Читая сохранённое XOR-значение в позиции (S, N)
2. Вычисляя нонс N из блока A для получения скупа S
3. Вычисляя нонс S из блока B для получения транспонированного скупа N
4. Применяя XOR ко всем трём значениям для восстановления оригинального 64-байтного скупа

Это снижает хранилище на 50%, требуя всего двух вычислений нонса на поиск — стоимость намного ниже порога, необходимого для обеспечения полного предварительного вычисления. Атака жизнеспособна потому, что вычисление строки (одного нонса, 4096 скупов) недорого, тогда как вычисление столбца (одного скупа по 4096 нонсам) потребовало бы регенерации всех нонсов. Структура транспонирования обнажает этот дисбаланс.

Это продемонстрировало необходимость формата графика, предотвращающего такую структурированную рекомбинацию и устраняющего лежащий в основе компромисс время-память. Раздел 3.3 описывает, как PoCX решает и устраняет эту слабость.

### 2.5 Переход к PoCX

Ограничения более ранних систем PoC ясно показали, что безопасный, справедливый и децентрализованный майнинг на хранилищах зависит от тщательно спроектированных структур графиков. Bitcoin-PoCX решает эти проблемы с помощью укреплённого формата графика, улучшенного распределения дедлайнов и механизмов для децентрализованного пул-майнинга — описанных в следующем разделе.

---

## 3. Формат графиков PoCX

### 3.1 Построение базового нонса

Нонс — это структура данных размером 256 КиБ, детерминированно выводимая из трёх параметров: 20-байтной полезной нагрузки адреса, 32-байтного seed и 64-битного индекса нонса.

Построение начинается с комбинирования этих входных данных и их хеширования через Shabal256 для получения начального хеша. Этот хеш служит отправной точкой для итеративного процесса расширения: Shabal256 применяется повторно, причём каждый шаг зависит от ранее сгенерированных данных, пока весь 256 КиБ буфер не будет заполнен. Этот цепной процесс представляет вычислительную работу, выполняемую при построении графика.

Финальный шаг диффузии хеширует завершённый буфер и применяет XOR результата ко всем байтам. Это гарантирует, что весь буфер был вычислен, и что майнеры не могут сократить вычисление. Затем применяется перетасовка POC2, меняющая местами нижнюю и верхнюю половины каждого скупа, чтобы гарантировать равную вычислительную стоимость всех скупов.

Финальный нонс состоит из 4096 скупов по 64 байта каждый и формирует фундаментальную единицу, используемую в майнинге.

### 3.2 SIMD-выровненная компоновка графика

Для максимизации пропускной способности на современном оборудовании PoCX организует данные нонсов на диске для облегчения векторизованной обработки. Вместо последовательного хранения каждого нонса PoCX выравнивает соответствующие 4-байтные слова по множеству последовательных нонсов смежно. Это позволяет одной операции выборки из памяти предоставить данные для всех линий SIMD, минимизируя промахи кеша и устраняя накладные расходы scatter-gather.

```
Традиционная компоновка:
Нонс0: [W0][W1][W2][W3]...
Нонс1: [W0][W1][W2][W3]...
Нонс2: [W0][W1][W2][W3]...

Компоновка SIMD PoCX:
Слово0: [N0][N1][N2]...[N15]
Слово1: [N0][N1][N2]...[N15]
Слово2: [N0][N1][N2]...[N15]
```

Эта компоновка выгодна как CPU, так и GPU-майнерам, обеспечивая высокопроизводительную параллелизованную оценку скупов при сохранении простого скалярного паттерна доступа для верификации консенсуса. Она гарантирует, что майнинг ограничен пропускной способностью хранилища, а не вычислениями CPU, поддерживая маломощную природу Proof of Capacity.

### 3.3 Структура варпа и кодирование XOR-транспонированием

Варп — фундаментальная единица хранения в PoCX, состоящая из 4096 нонсов (1 ГиБ). Несжатый формат, называемый X0, содержит базовые нонсы точно так, как они произведены конструкцией в разделе 3.1.

**Кодирование XOR-транспонированием (X1)**

Для устранения структурных компромиссов время-память, присутствующих в более ранних системах PoC, PoCX выводит укреплённый формат майнинга X1, применяя кодирование XOR-транспонированием к парам варпов X0.

Для построения скупа S нонса N в варпе X1:

1. Взять скуп S нонса N из первого варпа X0 (прямая позиция)
2. Взять скуп N нонса S из второго варпа X0 (транспонированная позиция)
3. Применить XOR к двум 64-байтным значениям для получения скупа X1

Шаг транспонирования меняет местами индексы скупа и нонса. В терминах матрицы — где строки представляют скупы, а столбцы представляют нонсы — он объединяет элемент в позиции (S, N) в первом варпе с элементом в (N, S) во втором.

**Почему это устраняет поверхность атаки сжатия**

XOR-транспонирование связывает каждый скуп с целой строкой и целым столбцом базовых данных X0. Восстановление одного скупа X1 поэтому требует доступа к данным, охватывающим все 4096 индексов скупов. Любая попытка вычислить недостающие данные потребует регенерации 4096 полных нонсов, а не одного нонса — устраняя асимметричную структуру затрат, эксплуатируемую XOR-атакой для POC2 (раздел 2.4).

В результате хранение полного варпа X1 становится единственной вычислительно жизнеспособной стратегией для майнеров, закрывая компромисс время-память, эксплуатируемый в предыдущих дизайнах.

### 3.4 Дисковая компоновка

Файлы графиков PoCX состоят из множества последовательных варпов X1. Для максимизации операционной эффективности при майнинге данные внутри каждого файла организованы по скупам: все данные скупа 0 из каждого варпа хранятся последовательно, затем все данные скупа 1, и так далее до скупа 4095.

Это **скуп-последовательное упорядочение** позволяет майнерам читать полные данные, требуемые для выбранного скупа, в одном последовательном обращении к диску, минимизируя время поиска и максимизируя пропускную способность на обычных устройствах хранения.

В сочетании с кодированием XOR-транспонированием раздела 3.3 эта компоновка гарантирует, что файл одновременно **структурно укреплён** и **операционно эффективен**: последовательное упорядочение скупов поддерживает оптимальный дисковый ввод-вывод, тогда как SIMD-выровненные компоновки памяти (см. раздел 3.2) позволяют высокопроизводительную параллелизованную оценку скупов.

### 3.5 Масштабирование доказательства работы (Xn)

PoCX реализует масштабируемое предварительное вычисление через концепцию уровней масштабирования, обозначаемых Xn, для адаптации к эволюции производительности оборудования. Базовый формат X1 представляет первую укреплённую XOR-транспонированием структуру варпа.

Каждый уровень масштабирования Xn экспоненциально увеличивает доказательство работы, встроенное в каждый варп, относительно X1: работа, требуемая на уровне Xn, составляет 2^(n-1) раз от X1. Переход от Xn к Xn+1 операционно эквивалентен применению XOR к парам смежных варпов, постепенно встраивая больше доказательства работы без изменения размера базового графика.

Существующие файлы графиков, созданные на более низких уровнях масштабирования, всё ещё могут использоваться для майнинга, но они вносят пропорционально меньше работы в генерацию блоков, отражая их более низкое встроенное доказательство работы. Этот механизм гарантирует, что графики PoCX остаются безопасными, гибкими и экономически сбалансированными со временем.

### 3.6 Функциональность Seed

Параметр seed позволяет создавать множество непересекающихся графиков на один адрес без ручной координации.

**Проблема (POC2)**: Майнеры должны были вручную отслеживать диапазоны нонсов по файлам графиков, чтобы избежать пересечения. Пересекающиеся нонсы тратят хранилище без увеличения мощности майнинга.

**Решение**: Каждая пара `(адрес, seed)` определяет независимое пространство ключей. Графики с разными seed никогда не пересекаются, независимо от диапазонов нонсов. Майнеры могут свободно создавать графики без координации.

---

## 4. Консенсус Proof of Capacity

PoCX расширяет консенсус Накамото в Bitcoin механизмом доказательства, связанного с хранением. Вместо расходования энергии на повторное хеширование майнеры выделяют большие объёмы предварительно вычисленных данных — графиков — на диск. Во время генерации блока они должны найти малую непредсказуемую часть этих данных и преобразовать её в доказательство. Майнер, предоставляющий лучшее доказательство в ожидаемом временном окне, получает право форджить следующий блок.

Эта глава описывает, как PoCX структурирует метаданные блока, выводит непредсказуемость и преобразует статическое хранение в безопасный механизм консенсуса с низкой дисперсией.

### 4.1 Структура блока

PoCX сохраняет знакомый заголовок блока в стиле Bitcoin, но вводит дополнительные поля консенсуса, требуемые для майнинга на основе ёмкости. Эти поля коллективно связывают блок с хранимым графиком майнера, сложностью сети и криптографической энтропией, определяющей каждую задачу майнинга.

На высоком уровне блок PoCX содержит: высоту блока, записанную явно для упрощения контекстной валидации; сигнатуру генерации — источник свежей энтропии, связывающей каждый блок с предшественником; базовую цель, представляющую сложность сети в обратной форме (более высокие значения соответствуют более лёгкому майнингу); доказательство PoCX, идентифицирующее графику майнера, используемый уровень сжатия, выбранный нонс и выведенное из него качество; и ключ подписи с подписью, доказывающие контроль над ёмкостью, использованной для форджинга блока (или делегированного ключа форджинга).

Доказательство встраивает всю релевантную для консенсуса информацию, необходимую валидаторам для пересчёта задачи, верификации выбранного скупа и подтверждения результирующего качества. Расширяя, а не перепроектируя структуру блока, PoCX остаётся концептуально согласованным с Bitcoin, обеспечивая при этом фундаментально иной источник работы майнинга.

### 4.2 Цепочка сигнатур генерации

Сигнатура генерации обеспечивает непредсказуемость, требуемую для безопасного майнинга Proof of Capacity. Каждый блок выводит свою сигнатуру генерации из сигнатуры предыдущего блока и подписанта, гарантируя, что майнеры не могут предвидеть будущие задачи или предварительно вычислить выгодные области графика:

`generationSignature[n] = SHA256(generationSignature[n-1] || miner_pubkey[n-1])`

Это производит последовательность криптографически сильных, зависящих от майнера значений энтропии. Поскольку публичный ключ майнера неизвестен до публикации предыдущего блока, ни один участник не может предсказать будущий выбор скупов. Это предотвращает выборочное предварительное вычисление или стратегическое построение графиков и гарантирует, что каждый блок вносит подлинно свежую работу майнинга.

### 4.3 Процесс форджинга

Майнинг в PoCX состоит из преобразования хранимых данных в доказательство, полностью управляемое сигнатурой генерации. Хотя процесс детерминирован, непредсказуемость сигнатуры гарантирует, что майнеры не могут подготовиться заранее и должны повторно обращаться к своим хранимым графикам.

**Вывод задачи (выбор скупа):** Майнер хеширует текущую сигнатуру генерации с высотой блока для получения индекса скупа в диапазоне 0-4095. Этот индекс определяет, какой 64-байтный сегмент каждого хранимого нонса участвует в доказательстве. Поскольку сигнатура генерации зависит от подписанта предыдущего блока, выбор скупа становится известен только в момент публикации блока.

**Оценка доказательства (вычисление качества):** Для каждого нонса в графике майнер получает выбранный скуп и хеширует его вместе с сигнатурой генерации для получения качества — 64-битного значения, величина которого определяет конкурентоспособность майнера. Более низкое качество соответствует лучшему доказательству.

**Формирование дедлайна (искривление времени):** Сырой дедлайн пропорционален качеству и обратно пропорционален базовой цели. В устаревших дизайнах PoC эти дедлайны следовали сильно скошенному экспоненциальному распределению, производя длинные хвосты задержек, не обеспечивающих дополнительной безопасности. PoCX преобразует сырой дедлайн с помощью искривления времени (раздел 4.4), уменьшая дисперсию и обеспечивая предсказуемые интервалы блоков. Как только искривлённый дедлайн истекает, майнер форджит блок, встраивая доказательство и подписывая его эффективным ключом форджинга.

### 4.4 Искривление времени

Proof of Capacity производит экспоненциально распределённые дедлайны. После короткого периода — обычно несколько десятков секунд — каждый майнер уже определил своё лучшее доказательство, и любое дополнительное время ожидания вносит только задержку, а не безопасность.

Искривление времени изменяет форму распределения, применяя преобразование кубического корня:

`deadline_bended = scale * (quality / base_target)^(1/3)`

Масштабный коэффициент сохраняет ожидаемое время блока (120 секунд), драматически уменьшая при этом дисперсию. Короткие дедлайны расширяются, улучшая распространение блоков и безопасность сети. Длинные дедлайны сжимаются, предотвращая задержку цепочки выбросами.

![Распределения времени блоков](blocktime_distributions.svg)

Искривление времени сохраняет информационное содержание базового доказательства. Оно не изменяет конкурентоспособность между майнерами; оно только перераспределяет время ожидания для производства более гладких, более предсказуемых интервалов блоков. Реализация использует арифметику с фиксированной точкой (формат Q42) и 256-битные целые числа для обеспечения детерминированных результатов на всех платформах.

### 4.5 Корректировка сложности

PoCX регулирует производство блоков с помощью базовой цели — обратной меры сложности. Ожидаемое время блока пропорционально отношению `качество / базовая_цель`, поэтому увеличение базовой цели ускоряет создание блоков, а уменьшение замедляет цепочку.

Сложность корректируется каждый блок, используя измеренное время между недавними блоками по сравнению с целевым интервалом. Эта частая корректировка необходима, потому что ёмкость хранения может быть добавлена или удалена быстро — в отличие от хешрейта Bitcoin, который меняется медленнее.

Корректировка следует двум направляющим ограничениям: **Постепенность** — поблочные изменения ограничены (максимум +-20%), чтобы избежать колебаний или манипуляций; **Укрепление** — базовая цель не может превышать своё значение в генезисе, предотвращая снижение сложности сети ниже исходных предположений о безопасности.

### 4.6 Валидность блока

Блок в PoCX валиден, когда он представляет верифицируемое доказательство, выведенное из хранилища, согласованное с состоянием консенсуса. Валидаторы независимо пересчитывают выбор скупа, выводят ожидаемое качество из отправленного нонса и метаданных графика, применяют преобразование искривления времени и подтверждают, что майнер имел право форджить блок в заявленное время.

В частности, валидный блок требует: дедлайн истёк с момента родительского блока; отправленное качество совпадает с вычисленным качеством для доказательства; уровень масштабирования соответствует минимуму сети; сигнатура генерации совпадает с ожидаемым значением; базовая цель совпадает с ожидаемым значением; подпись блока от эффективного подписанта; и coinbase платит на адрес эффективного подписанта.

---

## 5. Делегирование форджинга

### 5.1 Мотивация

Делегирование форджинга позволяет владельцам графиков делегировать полномочия на форджинг блоков без передачи владения графиками. Этот механизм обеспечивает пул-майнинг и настройки холодного хранения, сохраняя при этом гарантии безопасности PoCX.

При пул-майнинге владельцы графиков могут авторизовать пул на форджинг блоков от их имени. Пул собирает блоки и распределяет награды, но никогда не получает контроль над самими графиками. Делегирование отзываемо в любое время, и владельцы графиков свободны покинуть пул или изменить конфигурации без перестроения графиков.

Делегирование также поддерживает чёткое разделение между холодными и горячими ключами. Приватный ключ, контролирующий графику, может оставаться офлайн, тогда как отдельный ключ форджинга — хранимый на онлайн-машине — производит блоки. Компрометация ключа форджинга поэтому компрометирует только полномочия на форджинг, а не владение. Графику остаётся в безопасности, и делегирование может быть отозвано, немедленно закрывая брешь в безопасности.

Делегирование форджинга таким образом обеспечивает операционную гибкость, поддерживая принцип, что контроль над хранимой ёмкостью никогда не должен передаваться посредникам.

### 5.2 Протокол делегирования

Делегирования объявляются через транзакции OP_RETURN, чтобы избежать ненужного роста набора UTXO. Транзакция делегирования указывает адрес графика и адрес форджинга, авторизованный для производства блоков с использованием ёмкости этого графика. Транзакция отзыва содержит только адрес графика. В обоих случаях владелец графика подтверждает контроль, подписывая расходуемый вход транзакции.

Каждое делегирование проходит через последовательность чётко определённых состояний (UNASSIGNED, ASSIGNING, ASSIGNED, REVOKING, REVOKED). После подтверждения транзакции делегирования система входит в короткую фазу активации. Эта задержка — 30 блоков, примерно один час — обеспечивает стабильность во время гонок блоков и предотвращает враждебное быстрое переключение идентичностей форджинга. Как только этот период активации истекает, делегирование становится активным и остаётся таковым до выпуска владельцем графика отзыва.

Отзывы переходят в более длительный период задержки в 720 блоков, примерно один день. В течение этого времени предыдущий адрес форджинга остаётся активным. Эта более длительная задержка обеспечивает операционную стабильность для пулов, предотвращая стратегическое «прыгание по делегированиям» и давая провайдерам инфраструктуры достаточную уверенность для эффективной работы. После истечения задержки отзыва отзыв завершается, и владелец графика свободен назначить новый ключ форджинга.

Состояние делегирования поддерживается в структуре уровня консенсуса, параллельной набору UTXO, и поддерживает данные отмены для безопасной обработки реорганизаций цепочки.

### 5.3 Правила валидации

Для каждого блока валидаторы определяют эффективного подписанта — адрес, который должен подписать блок и получить награду coinbase. Этот подписант зависит исключительно от состояния делегирования на высоте блока.

Если делегирование не существует или делегирование ещё не завершило фазу активации, владелец графика остаётся эффективным подписантом. Когда делегирование становится активным, делегированный адрес форджинга должен подписывать. Во время отзыва адрес форджинга продолжает подписывать до истечения задержки отзыва. Только тогда полномочия возвращаются владельцу графика.

Валидаторы обеспечивают, что подпись блока произведена эффективным подписантом, что coinbase платит на тот же адрес, и что все переходы следуют предписанным задержкам активации и отзыва. Только владелец графика может создавать или отзывать делегирования; ключи форджинга не могут изменять или расширять свои собственные разрешения.

Делегирование форджинга, таким образом, вводит гибкое делегирование без введения доверия. Владение базовой ёмкостью всегда остаётся криптографически привязанным к владельцу графика, тогда как полномочия на форджинг могут быть делегированы, ротированы или отозваны по мере развития операционных потребностей.

---

## 6. Динамическое масштабирование

По мере эволюции оборудования стоимость вычисления графиков снижается относительно чтения предварительно вычисленной работы с диска. Без контрмер злоумышленники в конечном итоге могли бы генерировать доказательства на лету быстрее, чем майнеры читают хранимую работу, подрывая модель безопасности Proof of Capacity.

Для сохранения предполагаемого запаса безопасности PoCX реализует график масштабирования: минимальный требуемый уровень масштабирования для графиков увеличивается со временем. Каждый уровень масштабирования Xn, как описано в разделе 3.5, встраивает экспоненциально больше доказательства работы в структуру графика, гарантируя, что майнеры продолжают выделять существенные ресурсы хранения даже по мере удешевления вычислений.

График согласован с экономическими стимулами сети, особенно с халвингами вознаграждений за блок. По мере уменьшения награды за блок минимальный уровень постепенно увеличивается, сохраняя баланс между усилиями по построению графиков и потенциалом майнинга:

| Период | Годы | Халвинги | Мин. масштабирование | Множитель работы графика |
|--------|------|----------|---------------------|--------------------------|
| Эпоха 0 | 0-4 | 0 | X1 | 2x базовая линия |
| Эпоха 1 | 4-12 | 1-2 | X2 | 4x базовая линия |
| Эпоха 2 | 12-28 | 3-6 | X3 | 8x базовая линия |
| Эпоха 3 | 28-60 | 7-14 | X4 | 16x базовая линия |
| Эпоха 4 | 60-124 | 15-30 | X5 | 32x базовая линия |
| Эпоха 5 | 124+ | 31+ | X6 | 64x базовая линия |

Майнеры могут опционально готовить графики, превышающие текущий минимум на один уровень, позволяя им планировать заранее и избегать немедленных обновлений при переходе сети к следующей эпохе. Этот опциональный шаг не даёт дополнительного преимущества в терминах вероятности блока — он лишь позволяет более плавный операционный переход.

Блоки, содержащие доказательства ниже минимального уровня масштабирования для их высоты, считаются невалидными. Валидаторы проверяют заявленный уровень масштабирования в доказательстве на соответствие текущим требованиям сети во время валидации консенсуса, гарантируя, что все участвующие майнеры соответствуют развивающимся ожиданиям безопасности.

---

## 7. Архитектура майнинга

PoCX разделяет критичные для консенсуса операции от ресурсоёмких задач майнинга, обеспечивая как безопасность, так и эффективность. Узел поддерживает блокчейн, валидирует блоки, управляет мемпулом и предоставляет RPC-интерфейс. Внешние майнеры обрабатывают хранение графиков, чтение скупов, вычисление качества и управление дедлайнами. Это разделение сохраняет логику консенсуса простой и поддающейся аудиту, позволяя майнерам оптимизировать пропускную способность диска.

### 7.1 RPC-интерфейс майнинга

Майнеры взаимодействуют с узлом через минимальный набор RPC-вызовов. RPC get_mining_info предоставляет текущую высоту блока, сигнатуру генерации, базовую цель, целевой дедлайн и приемлемый диапазон уровней масштабирования графиков. Используя эту информацию, майнеры вычисляют кандидатные нонсы. RPC submit_nonce позволяет майнерам отправлять предложенное решение, включая идентификатор графика, индекс нонса, уровень масштабирования и аккаунт майнера. Узел оценивает отправку и отвечает вычисленным дедлайном, если доказательство валидно.

### 7.2 Планировщик форджинга

Узел поддерживает планировщик форджинга, который отслеживает входящие отправки и сохраняет только лучшее решение для каждой высоты блока. Отправленные нонсы ставятся в очередь со встроенной защитой от затопления отправками или атак отказа в обслуживании. Планировщик ждёт, пока истечёт вычисленный дедлайн или прибудет лучшее решение, после чего собирает блок, подписывает его эффективным ключом форджинга и публикует в сеть.

### 7.3 Защитный форджинг

Для предотвращения атак на время или стимулов к манипуляции часами PoCX реализует защитный форджинг. Если конкурирующий блок прибывает для той же высоты, планировщик сравнивает локальное решение с новым блоком. Если локальное качество лучше, узел форджит немедленно, а не ждёт оригинального дедлайна. Это гарантирует, что майнеры не могут получить преимущество просто корректировкой локальных часов; лучшее решение всегда побеждает, сохраняя справедливость и безопасность сети.

---

## 8. Анализ безопасности

### 8.1 Модель угроз

PoCX моделирует противников со значительными, но ограниченными возможностями. Злоумышленники могут пытаться перегрузить сеть невалидными транзакциями, неправильно сформированными блоками или сфабрикованными доказательствами для стресс-тестирования путей валидации. Они могут свободно манипулировать своими локальными часами и могут пытаться эксплуатировать краевые случаи в поведении консенсуса, такие как обработка временных меток, динамика корректировки сложности или правила реорганизации. Также ожидается, что противники будут искать возможности для переписывания истории через целевые форки цепочки.

Модель предполагает, что ни одна сторона не контролирует большинство общей ёмкости хранения сети. Как и в любом механизме консенсуса на основе ресурсов, злоумышленник с 51% ёмкости может в одностороннем порядке реорганизовать цепочку; это фундаментальное ограничение не специфично для PoCX. PoCX также предполагает, что злоумышленники не могут вычислять данные графиков быстрее, чем честные майнеры могут читать их с диска. График масштабирования (раздел 6) гарантирует, что вычислительный разрыв, требуемый для безопасности, растёт со временем по мере совершенствования оборудования.

Следующие разделы подробно рассматривают каждый основной класс атак и описывают контрмеры, встроенные в PoCX.

### 8.2 Атаки на ёмкость

Как и в PoW, злоумышленник с большинством ёмкости может переписать историю (атака 51%). Достижение этого требует приобретения физического объёма хранения, превышающего честную сеть — дорогое и логистически сложное предприятие. После приобретения оборудования операционные расходы низки, но начальная инвестиция создаёт сильный экономический стимул вести себя честно: подрыв цепочки нанёс бы ущерб стоимости собственной базы активов злоумышленника.

PoC также избегает проблемы ничего-на-кону, связанной с PoS. Хотя майнеры могут сканировать графики против нескольких конкурирующих форков, каждое сканирование потребляет реальное время — обычно порядка десятков секунд на цепочку. С 120-секундным интервалом блоков это по своей сути ограничивает многофорковый майнинг, и попытка майнить много форков одновременно снижает производительность на всех них. Форковый майнинг, таким образом, не бесплатен; он фундаментально ограничен пропускной способностью ввода-вывода.

Даже если будущее оборудование позволит почти мгновенное сканирование графиков (например, высокоскоростные SSD), злоумышленник всё равно будет сталкиваться со значительными требованиями к физическим ресурсам для контроля большинства ёмкости сети, делая атаку в стиле 51% дорогой и логистически сложной.

Наконец, атаки на ёмкость гораздо сложнее арендовать, чем атаки на хешрейт. GPU-вычисления могут быть приобретены по требованию и мгновенно перенаправлены на любую PoW-цепочку. Напротив, PoC требует физического оборудования, времязатратного построения графиков и постоянных операций ввода-вывода. Эти ограничения делают краткосрочные оппортунистические атаки гораздо менее осуществимыми.

### 8.3 Атаки на время

Время играет более критичную роль в Proof of Capacity, чем в Proof of Work. В PoW временные метки преимущественно влияют на корректировку сложности; в PoC они определяют, истёк ли дедлайн майнера и, следовательно, имеет ли блок право на форджинг. Дедлайны измеряются относительно временной метки родительского блока, но локальные часы узла используются для оценки того, находится ли входящий блок слишком далеко в будущем. По этой причине PoCX обеспечивает строгий допуск временных меток: блоки не могут отклоняться более чем на 15 секунд от локальных часов узла (по сравнению с 2-часовым окном Bitcoin). Этот предел работает в обоих направлениях — блоки слишком далеко в будущем отклоняются, и узлы с медленными часами могут некорректно отклонять валидные входящие блоки.

Узлы поэтому должны синхронизировать свои часы с использованием NTP или эквивалентного источника времени. PoCX намеренно избегает полагаться на внутрисетевые источники времени, чтобы предотвратить манипуляции злоумышленниками воспринимаемым сетевым временем. Узлы мониторят собственное отклонение и выдают предупреждения, если локальные часы начинают расходиться с недавними временными метками блоков.

Ускорение часов — запуск быстрых локальных часов для форджинга немного раньше — обеспечивает лишь маргинальную выгоду. В пределах допустимого допуска защитный форджинг (раздел 7.3) гарантирует, что майнер с лучшим решением немедленно опубликует его, увидев худший ранний блок. Быстрые часы помогают майнеру опубликовать уже выигрывающее решение на несколько секунд раньше; они не могут превратить худшее доказательство в выигрывающее.

Попытки манипулировать сложностью через временные метки ограничены верхней границей корректировки +-20% на блок и 24-блочным скользящим окном, предотвращая значительное влияние майнеров на сложность через краткосрочные игры со временем.

### 8.4 Атаки компромисса время-память

Компромиссы время-память пытаются снизить требования к хранилищу путём пересчёта частей графика по требованию. Предыдущие системы Proof of Capacity были уязвимы к таким атакам, наиболее примечательно — дефект дисбаланса скупов POC1 и атака XOR-транспонирования со сжатием POC2 (раздел 2.4). Обе эксплуатировали асимметрии в том, насколько дорого было регенерировать определённые части данных графика, позволяя противникам сокращать хранилище, платя лишь небольшой вычислительный штраф. Также альтернативные форматы графиков по сравнению с PoC2 страдают от похожих слабостей TMTO; яркий пример — Chia, формат графиков которой может быть произвольно сокращён более чем в 4 раза.

PoCX полностью устраняет эти поверхности атак через конструкцию нонса и формат варпа. Внутри каждого нонса финальный шаг диффузии хеширует полностью вычисленный буфер и применяет XOR результата ко всем байтам, гарантируя, что каждая часть буфера зависит от каждой другой части и не может быть сокращена. После этого перетасовка POC2 меняет местами нижнюю и верхнюю половины каждого скупа, уравнивая вычислительную стоимость восстановления любого скупа.

PoCX далее устраняет атаку XOR-транспонирования со сжатием POC2, выводя укреплённый формат X1, где каждый скуп является XOR прямой и транспонированной позиции по спаренным варпам; это связывает каждый скуп с целой строкой и целым столбцом базовых данных X0, делая восстановление требующим тысяч полных нонсов и тем самым полностью устраняя асимметричный компромисс время-память.

В результате хранение полного графика — единственная вычислительно жизнеспособная стратегия для майнеров. Никакое известное сокращение — будь то частичное построение графиков, выборочная регенерация, структурированное сжатие или гибридные подходы вычисление-хранение — не обеспечивает значимого преимущества. PoCX гарантирует, что майнинг остаётся строго связанным с хранением и что ёмкость отражает реальное физическое обязательство.

### 8.5 Атаки на делегирование

PoCX использует детерминированный конечный автомат для управления всеми делегированиями график-к-форджеру. Каждое делегирование проходит через чётко определённые состояния — UNASSIGNED -> ASSIGNING -> ASSIGNED -> REVOKING -> REVOKED — с принудительными задержками активации и отзыва. Это гарантирует, что майнер не может мгновенно изменить делегирования для обмана системы или быстрого переключения полномочий на форджинг.

Поскольку все переходы требуют криптографических доказательств — в частности, подписей владельцем графика, которые верифицируемы по входному UTXO — сеть может доверять легитимности каждого делегирования. Попытки обойти конечный автомат или подделать делегирования автоматически отклоняются во время валидации консенсуса. Атаки воспроизведения также предотвращаются стандартной защитой от воспроизведения транзакций в стиле Bitcoin, гарантируя уникальную привязку каждого действия делегирования к валидному нерасходованному входу.

Комбинация управления конечным автоматом, принудительных задержек и криптографического доказательства делает мошенничество на основе делегирования практически невозможным: майнеры не могут захватить делегирования, выполнить быстрое переназначение во время гонок блоков или обойти графики отзыва.

### 8.6 Безопасность подписей

Подписи блоков в PoCX служат критической связью между доказательством и эффективным ключом форджинга, гарантируя, что только авторизованные майнеры могут производить валидные блоки.

Для предотвращения атак податливости подписи исключены из вычисления хеша блока. Это устраняет риски податливых подписей, которые могли бы подорвать валидацию или позволить атаки замены блоков.

Для смягчения векторов отказа в обслуживании размеры подписей и публичных ключей фиксированы — 65 байт для компактных подписей и 33 байта для сжатых публичных ключей — предотвращая раздувание блоков злоумышленниками для провоцирования исчерпания ресурсов или замедления распространения по сети.

---

## 9. Реализация

PoCX реализован как модульное расширение Bitcoin Core, весь релевантный код содержится в собственном выделенном подкаталоге и активируется через флаг функции. Этот дизайн сохраняет целостность оригинального кода, позволяя PoCX чисто включаться или отключаться, что упрощает тестирование, аудит и синхронизацию с апстрим-изменениями.

Интеграция затрагивает только существенные точки, необходимые для поддержки Proof of Capacity. Заголовок блока расширен для включения специфичных для PoCX полей, и валидация консенсуса адаптирована для обработки доказательств на основе хранения наряду со стандартными проверками Bitcoin. Система форджинга, ответственная за управление дедлайнами, планирование и отправки майнеров, полностью содержится в модулях PoCX, тогда как расширения RPC предоставляют функциональность майнинга и делегирования внешним клиентам. Для пользователей интерфейс кошелька расширен для управления делегированиями через транзакции OP_RETURN, обеспечивая бесшовное взаимодействие с новыми функциями консенсуса.

Все критичные для консенсуса операции реализованы на детерминированном C++ без внешних зависимостей, обеспечивая кроссплатформенную согласованность. Shabal256 используется для хеширования, тогда как искривление времени и вычисление качества полагаются на арифметику с фиксированной точкой и 256-битные операции. Криптографические операции, такие как верификация подписей, используют существующую библиотеку secp256k1 Bitcoin Core.

Изолируя функциональность PoCX таким образом, реализация остаётся поддающейся аудиту, сопровождаемой и полностью совместимой с продолжающейся разработкой Bitcoin Core, демонстрируя, что фундаментально новый механизм консенсуса, связанный с хранением, может сосуществовать со зрелой кодовой базой proof-of-work без нарушения её целостности или удобства использования.

---

## 10. Сетевые параметры

PoCX строится на сетевой инфраструктуре Bitcoin и переиспользует её фреймворк параметров цепочки. Для поддержки майнинга на основе ёмкости, обработки делегирований и масштабирования графиков несколько параметров были расширены или переопределены. Это включает целевое время блока, начальную субсидию, график халвинга, задержки активации и отзыва делегирования, а также сетевые идентификаторы, такие как magic bytes, порты и префиксы Bech32. Среды testnet и regtest дополнительно корректируют эти параметры для обеспечения быстрой итерации и тестирования с малой ёмкостью.

Таблицы ниже суммируют результирующие настройки mainnet, testnet и regtest, показывая, как PoCX адаптирует основные параметры Bitcoin к модели консенсуса, связанной с хранением.

### 10.1 Mainnet

| Параметр | Значение |
|----------|----------|
| Magic bytes | `0xa7 0x3c 0x91 0x5e` |
| Порт по умолчанию | 8888 |
| Bech32 HRP | `pocx` |
| Целевое время блока | 120 секунд |
| Начальная субсидия | 10 BTC |
| Интервал халвинга | 1050000 блоков (~4 года) |
| Общее предложение | ~21 миллион BTC |
| Активация делегирования | 30 блоков |
| Отзыв делегирования | 720 блоков |
| Скользящее окно | 24 блока |

### 10.2 Testnet

| Параметр | Значение |
|----------|----------|
| Magic bytes | `0x6d 0xf2 0x48 0xb3` |
| Порт по умолчанию | 18888 |
| Bech32 HRP | `tpocx` |
| Целевое время блока | 120 секунд |
| Остальные параметры | Как у mainnet |

### 10.3 Regtest

| Параметр | Значение |
|----------|----------|
| Magic bytes | `0xfa 0xbf 0xb5 0xda` |
| Порт по умолчанию | 18444 |
| Bech32 HRP | `rpocx` |
| Целевое время блока | 1 секунда |
| Интервал халвинга | 500 блоков |
| Активация делегирования | 4 блока |
| Отзыв делегирования | 8 блоков |
| Режим малой ёмкости | Включён (~4 МБ графики) |

---

## 11. Связанные работы

На протяжении многих лет несколько блокчейн- и консенсус-проектов исследовали модели майнинга на основе хранения или гибридные модели. PoCX строится на этом наследии, вводя улучшения в безопасности, эффективности и совместимости.

**Burstcoin / Signum.** Burstcoin представил первую практическую систему Proof-of-Capacity (PoC) в 2014 году, определив основные концепции, такие как графики, нонсы, скупы и майнинг на основе дедлайнов. Его преемники, в частности Signum (бывший Burstcoin), расширили экосистему и в конечном итоге эволюционировали в то, что известно как Proof-of-Commitment (PoC+), комбинируя обязательство по хранению с опциональным стейкингом для влияния на эффективную ёмкость. PoCX наследует основу майнинга на основе хранения от этих проектов, но значительно расходится через укреплённый формат графиков (кодирование XOR-транспонированием), динамическое масштабирование работы графиков, сглаживание дедлайнов («искривление времени») и гибкую систему делегирования — всё при закреплении в кодовой базе Bitcoin Core, а не поддержании отдельного форка сети.

**Chia.** Chia реализует Proof of Space and Time, комбинируя доказательства на основе диска с временным компонентом, обеспечиваемым через верифицируемые функции задержки (VDF). Её дизайн решает определённые проблемы повторного использования доказательств и генерации свежих задач, отличные от классического PoC. PoCX не принимает эту модель доказательств, привязанных ко времени; вместо этого она поддерживает консенсус, связанный с хранением, с предсказуемыми интервалами, оптимизированный для долгосрочной совместимости с экономикой UTXO и инструментами, производными от Bitcoin.

**Spacemesh.** Spacemesh предлагает схему Proof-of-Space-Time (PoST), использующую сетевую топологию на основе DAG (mesh). В этой модели участники должны периодически доказывать, что выделенное хранилище остаётся нетронутым со временем, а не полагаться на единый предварительно вычисленный набор данных. PoCX, напротив, верифицирует обязательство по хранению только во время блока — с укреплёнными форматами графиков и строгой валидацией доказательств — избегая накладных расходов на непрерывные доказательства хранения при сохранении эффективности и децентрализации.

---

## 12. Заключение

Bitcoin-PoCX демонстрирует, что энергоэффективный консенсус может быть интегрирован в Bitcoin Core с сохранением свойств безопасности и экономической модели. Ключевые вклады включают кодирование XOR-транспонированием (принуждает злоумышленников вычислять 4096 нонсов на поиск, устраняя атаку сжатия), алгоритм искривления времени (преобразование распределения уменьшает дисперсию времени блоков), систему делегирования форджинга (делегирование на основе OP_RETURN обеспечивает некастодиальный пул-майнинг), динамическое масштабирование (согласованное с халвингами для поддержания запасов безопасности) и минимальную интеграцию (флагированный код, изолированный в выделенном каталоге).

Система в настоящее время находится в фазе тестовой сети. Мощность майнинга выводится из ёмкости хранения, а не из хешрейта, снижая потребление энергии на порядки при сохранении проверенной экономической модели Bitcoin.

---

## Литература

Bitcoin Core. *Репозиторий Bitcoin Core.* https://github.com/bitcoin/bitcoin

Burstcoin. *Техническая документация Proof of Capacity.* 2014.

NIST. *Конкурс SHA-3: Shabal.* 2008.

Cohen, B., Pietrzak, K. *The Chia Network Blockchain.* 2019.

Spacemesh. *Документация протокола Spacemesh.* 2021.

PoC Consortium. *Фреймворк PoCX.* https://github.com/PoC-Consortium/pocx

PoC Consortium. *Интеграция Bitcoin-PoCX.* https://github.com/PoC-Consortium/bitcoin-pocx

---

**Лицензия**: MIT
**Организация**: Proof of Capacity Consortium
**Статус**: Фаза тестовой сети
