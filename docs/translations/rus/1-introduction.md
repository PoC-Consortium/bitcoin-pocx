[Содержание](index.md) | [Далее: Формат графиков ->](2-plot-format.md)

---

# Глава 1: Введение и обзор

## Что такое Bitcoin-PoCX?

Bitcoin-PoCX — это интеграция Bitcoin Core с поддержкой консенсуса **Proof of Capacity нового поколения (PoCX)**. Система сохраняет существующую архитектуру Bitcoin Core, обеспечивая при этом энергоэффективную альтернативу майнинга на основе Proof of Capacity в качестве полной замены Proof of Work.

**Ключевое отличие**: Это **новая цепочка** без обратной совместимости с Bitcoin PoW. Блоки PoCX намеренно несовместимы с узлами PoW.

---

## Идентификация проекта

- **Организация**: Proof of Capacity Consortium
- **Название проекта**: Bitcoin-PoCX
- **Полное название**: Bitcoin Core с интеграцией PoCX
- **Статус**: Фаза тестовой сети

---

## Что такое Proof of Capacity?

Proof of Capacity (PoC) — это механизм консенсуса, в котором мощность майнинга пропорциональна **дисковому пространству**, а не вычислительной мощности. Майнеры предварительно генерируют большие файлы графиков, содержащие криптографические хеши, а затем используют эти графики для поиска валидных решений блоков.

**Энергоэффективность**: Файлы графиков генерируются один раз и используются многократно. Майнинг потребляет минимальную мощность процессора — преимущественно дисковый ввод-вывод.

**Улучшения PoCX**:
- Исправлена атака XOR-транспонирования со сжатием (50% компромисс время-память в POC2)
- Выравнивание по 16 нонсам для современного оборудования
- Масштабируемое доказательство работы при генерации графиков (уровни масштабирования Xn)
- Нативная интеграция C++ непосредственно в Bitcoin Core
- Алгоритм искривления времени для улучшенного распределения времени блоков

---

## Обзор архитектуры

### Структура репозитория

```
bitcoin-pocx/
├── bitcoin/             # Bitcoin Core v30.0 + интеграция PoCX
│   └── src/pocx/        # Реализация PoCX
├── pocx/                # Фреймворк PoCX core (подмодуль, только чтение)
└── docs/                # Эта документация
```

### Философия интеграции

**Минимальная поверхность интеграции**: Изменения изолированы в каталоге `/src/pocx/` с чистыми хуками в слои валидации, майнинга и RPC Bitcoin Core.

**Флаги функций**: Все модификации под препроцессорными флагами `#ifdef ENABLE_POCX`. Bitcoin Core собирается нормально при отключении.

**Совместимость с апстримом**: Регулярная синхронизация с обновлениями Bitcoin Core поддерживается через изолированные точки интеграции.

**Нативная реализация на C++**: Скалярные криптографические алгоритмы (Shabal256, вычисление скупов, сжатие) интегрированы непосредственно в Bitcoin Core для валидации консенсуса.

---

## Ключевые особенности

### 1. Полная замена консенсуса

- **Структура блока**: Специфичные для PoCX поля заменяют нонс PoW и биты сложности
  - Сигнатура генерации (детерминированная энтропия майнинга)
  - Базовая цель (обратная величина сложности)
  - Доказательство PoCX (ID аккаунта, seed, нонс)
  - Подпись блока (подтверждает владение графиком)

- **Валидация**: 5-этапный конвейер валидации от проверки заголовка до подключения блока

- **Корректировка сложности**: Корректировка каждый блок с использованием скользящего среднего недавних базовых целей

### 2. Алгоритм искривления времени

**Проблема**: Традиционные времена блоков PoC следуют экспоненциальному распределению, что приводит к длинным блокам, когда ни один майнер не находит хорошего решения.

**Решение**: Преобразование распределения из экспоненциального в хи-квадрат с использованием кубического корня: `Y = масштаб × (X^(1/3))`.

**Эффект**: Очень хорошие решения форджатся позже (сеть успевает просканировать все диски, уменьшает количество быстрых блоков), плохие решения улучшаются. Среднее время блока поддерживается на уровне 120 секунд, длинные блоки сокращаются.

**Подробности**: [Глава 3: Консенсус и майнинг](3-consensus-and-mining.md)

### 3. Система делегирования форджинга

**Возможность**: Владельцы графиков могут делегировать права форджинга другим адресам, сохраняя при этом владение графиком.

**Варианты использования**:
- Пул-майнинг (графики делегируются адресу пула)
- Холодное хранение (ключ майнинга отделён от владения графиком)
- Многосторонний майнинг (общая инфраструктура)

**Архитектура**: Дизайн только на основе OP_RETURN — без специальных UTXO, делегирования отслеживаются отдельно в базе данных chainstate.

**Подробности**: [Глава 4: Делегирование форджинга](4-forging-assignments.md)

### 4. Защитный форджинг

**Проблема**: Быстрые часы могут давать временное преимущество в пределах 15-секундного допуска на будущее.

**Решение**: При получении конкурирующего блока на той же высоте автоматически проверяется локальное качество. Если оно лучше — форджинг происходит немедленно.

**Эффект**: Устраняет стимул для манипуляции часами — быстрые часы помогают только если у вас уже есть лучшее решение.

**Подробности**: [Глава 5: Синхронизация времени и безопасность](5-timing-security.md)

### 5. Динамическое масштабирование сжатия

**Экономическое согласование**: Требования к уровню масштабирования увеличиваются по экспоненциальному графику (годы 4, 12, 28, 60, 124 = халвинги 1, 3, 7, 15, 31).

**Эффект**: По мере уменьшения вознаграждений за блок сложность генерации графиков увеличивается. Поддерживается запас безопасности между стоимостью создания и поиска в графиках.

**Предотвращает**: Инфляцию ёмкости из-за более быстрого оборудования со временем.

**Подробности**: [Глава 6: Сетевые параметры](6-network-parameters.md)

---

## Философия проектирования

### Безопасность кода

- Практики защитного программирования повсеместно
- Комплексная обработка ошибок в путях валидации
- Отсутствие вложенных блокировок (предотвращение дедлоков)
- Атомарные операции с базой данных (UTXO + делегирования вместе)

### Модульная архитектура

- Чёткое разделение между инфраструктурой Bitcoin Core и консенсусом PoCX
- Фреймворк PoCX core предоставляет криптографические примитивы
- Bitcoin Core предоставляет фреймворк валидации, базу данных, сетевое взаимодействие

### Оптимизации производительности

- Порядок валидации с быстрым отказом (дешёвые проверки первыми)
- Единственная выборка контекста на отправку (без повторных захватов cs_main)
- Атомарные операции с базой данных для согласованности

### Безопасность при реорганизациях

- Полные данные отмены для изменений состояния делегирования
- Сброс состояния форджинга при изменении вершины цепочки
- Обнаружение устаревания во всех точках валидации

---

## Чем PoCX отличается от Proof of Work

| Аспект | Bitcoin (PoW) | Bitcoin-PoCX |
|--------|---------------|--------------|
| **Ресурс майнинга** | Вычислительная мощность (хешрейт) | Дисковое пространство (ёмкость) |
| **Потребление энергии** | Высокое (непрерывное хеширование) | Низкое (только дисковый ввод-вывод) |
| **Процесс майнинга** | Найти нонс с хешем < цель | Найти нонс с дедлайном < прошедшее время |
| **Сложность** | Поле `bits`, корректируется каждые 2016 блоков | Поле `base_target`, корректируется каждый блок |
| **Время блока** | ~10 минут (экспоненциальное распределение) | 120 секунд (с искривлением времени, уменьшенная дисперсия) |
| **Субсидия** | 50 BTC -> 25 -> 12.5 -> ... | 10 BTC -> 5 -> 2.5 -> ... |
| **Оборудование** | ASIC (специализированное) | HDD (обычное оборудование) |
| **Идентификация майнера** | Анонимная | Владелец графика или делегат |

---

## Системные требования

### Работа узла

**Такие же, как у Bitcoin Core**:
- **CPU**: Современный процессор x86_64
- **Память**: 4-8 ГБ ОЗУ
- **Хранилище**: Новая цепочка, в настоящее время пуста (может расти примерно в 4 раза быстрее Bitcoin из-за 2-минутных блоков и базы данных делегирования)
- **Сеть**: Стабильное интернет-соединение
- **Часы**: Рекомендуется синхронизация NTP для оптимальной работы

**Примечание**: Файлы графиков НЕ требуются для работы узла.

### Требования для майнинга

**Дополнительные требования для майнинга**:
- **Файлы графиков**: Предварительно сгенерированные с помощью `pocx_plotter` (референсная реализация)
- **Программное обеспечение майнера**: `pocx_miner` (референсная реализация) подключается через RPC
- **Кошелёк**: `bitcoind` или `bitcoin-qt` с приватными ключами для адреса майнинга. Пул-майнинг не требует локального кошелька.

---

## Начало работы

### 1. Сборка Bitcoin-PoCX

```bash
# Клонирование с подмодулями
git clone --recursive https://github.com/PoC-Consortium/bitcoin-pocx.git
cd bitcoin-pocx/bitcoin

# Сборка с включённым PoCX
cmake -B build -DENABLE_POCX=ON
cmake --build build
```

**Подробности**: См. `CLAUDE.md` в корне репозитория

### 2. Запуск узла

**Только узел**:
```bash
./build/bin/bitcoind
# или
./build/bin/bitcoin-qt
```

**Для майнинга** (включает RPC-доступ для внешних майнеров):
```bash
./build/bin/bitcoind -miningserver
# или
./build/bin/bitcoin-qt -server -miningserver
```

**Подробности**: [Глава 6: Сетевые параметры](6-network-parameters.md)

### 3. Генерация файлов графиков

Используйте `pocx_plotter` (референсная реализация) для генерации файлов графиков формата PoCX.

**Подробности**: [Глава 2: Формат графиков](2-plot-format.md)

### 4. Настройка майнинга

Используйте `pocx_miner` (референсная реализация) для подключения к RPC-интерфейсу вашего узла.

**Подробности**: [Глава 7: Справочник по RPC](7-rpc-reference.md) и [Глава 8: Руководство по кошельку](8-wallet-guide.md)

---

## Атрибуция

### Формат графиков

Основан на формате POC2 (Burstcoin) с улучшениями:
- Исправлена уязвимость безопасности (атака XOR-транспонирования со сжатием)
- Масштабируемое доказательство работы
- SIMD-оптимизированная компоновка
- Функциональность seed

### Исходные проекты

- **pocx_miner**: Референсная реализация на основе [scavenger](https://github.com/PoC-Consortium/scavenger)
- **pocx_plotter**: Референсная реализация на основе [engraver](https://github.com/PoC-Consortium/engraver)

**Полная атрибуция**: [Глава 2: Формат графиков](2-plot-format.md)

---

## Краткое изложение технических спецификаций

- **Время блока**: 120 секунд (mainnet), 1 секунда (regtest)
- **Субсидия блока**: 10 BTC изначально, халвинг каждые 1050000 блоков (~4 года)
- **Общее предложение**: ~21 миллион BTC (как у Bitcoin)
- **Допуск на будущее**: 15 секунд (блоки до 15с в будущем принимаются)
- **Предупреждение о часах**: 10 секунд (предупреждает операторов об отклонении времени)
- **Задержка делегирования**: 30 блоков (~1 час)
- **Задержка отзыва**: 720 блоков (~24 часа)
- **Формат адреса**: Только P2WPKH (bech32, pocx1q...) для операций майнинга PoCX и делегирования форджинга

---

## Организация кода

**Модификации Bitcoin Core**: Минимальные изменения в основных файлах, помеченные флагом `#ifdef ENABLE_POCX`

**Новая реализация PoCX**: Изолирована в каталоге `src/pocx/`

---

## Вопросы безопасности

### Безопасность синхронизации времени

- 15-секундный допуск на будущее предотвращает фрагментацию сети
- 10-секундный порог предупреждения оповещает операторов об отклонении часов
- Защитный форджинг устраняет стимул для манипуляции часами
- Искривление времени уменьшает влияние временной дисперсии

**Подробности**: [Глава 5: Синхронизация времени и безопасность](5-timing-security.md)

### Безопасность делегирования

- Дизайн только на основе OP_RETURN (без манипуляций с UTXO)
- Подпись транзакции подтверждает владение графиком
- Задержки активации предотвращают быструю манипуляцию состоянием
- Данные отмены, безопасные при реорганизациях, для всех изменений состояния

**Подробности**: [Глава 4: Делегирование форджинга](4-forging-assignments.md)

### Безопасность консенсуса

- Подпись исключена из хеша блока (предотвращает податливость)
- Ограниченные размеры подписей (предотвращает DoS)
- Валидация границ сжатия (предотвращает слабые доказательства)
- Корректировка сложности каждый блок (реагирует на изменения ёмкости)

**Подробности**: [Глава 3: Консенсус и майнинг](3-consensus-and-mining.md)

---

## Статус сети

**Mainnet**: Ещё не запущен
**Testnet**: Доступен для тестирования
**Regtest**: Полностью функционален для разработки

**Параметры генезис-блока**: [Глава 6: Сетевые параметры](6-network-parameters.md)

---

## Следующие шаги

**Для понимания PoCX**: Переходите к [Глава 2: Формат графиков](2-plot-format.md), чтобы узнать о структуре файлов графиков и эволюции формата.

**Для настройки майнинга**: Перейдите к [Глава 7: Справочник по RPC](7-rpc-reference.md) для деталей интеграции.

**Для запуска узла**: Изучите [Глава 6: Сетевые параметры](6-network-parameters.md) для параметров конфигурации.

---

[Содержание](index.md) | [Далее: Формат графиков ->](2-plot-format.md)
