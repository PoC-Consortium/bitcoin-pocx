# Bitcoin-PoCX：Bitcoin Core 的节能共识机制

**版本**：2.0 草案
**日期**：2025年12月
**组织**：容量证明联盟（Proof of Capacity Consortium）

---

## 摘要

Bitcoin 的工作量证明（PoW）共识提供了强大的安全性，但由于持续的实时哈希计算，消耗大量能源。我们提出 Bitcoin-PoCX，这是一个 Bitcoin 分叉，用容量证明（PoC）取代 PoW。在容量证明中，矿工在绘图阶段预先计算并存储大量磁盘存储的哈希值，随后通过执行轻量级查找而非持续哈希来进行挖矿。通过将计算从挖矿阶段转移到一次性的绘图阶段，Bitcoin-PoCX 大幅降低了能源消耗，同时使挖矿可以在通用硬件上进行，降低了参与门槛，并缓解了 ASIC 主导的 PoW 中固有的中心化压力，同时保留了 Bitcoin 的安全假设和经济行为。

我们的实现引入了几项关键创新：
(1) 一种加固的绘图格式，消除了现有 PoC 系统中所有已知的时间-内存权衡攻击，确保有效挖矿能力严格与承诺的存储容量成正比；
(2) 时间弯曲算法，将截止时间分布从指数分布转换为卡方分布，在不改变均值的情况下减少区块时间方差；
(3) 基于 OP_RETURN 的锻造委派机制，实现非托管矿池挖矿；以及
(4) 动态压缩扩展，根据减半计划增加绘图生成难度，以随着硬件改进保持长期安全边际。

Bitcoin-PoCX 通过最小化、特性标记的修改保持 Bitcoin Core 的架构，将 PoC 逻辑与现有共识代码隔离。该系统通过目标 120 秒区块间隔和将区块奖励调整为 10 BTC 来保持 Bitcoin 的货币政策。减少的奖励抵消了五倍的区块频率增加，使长期发行率与 Bitcoin 的原始计划保持一致，并保持约 2100 万的最大供应量。

---

## 1. 简介

### 1.1 动机

Bitcoin 的工作量证明（PoW）共识在十多年来证明了其安全性，但代价巨大：矿工必须持续消耗计算资源，导致高能耗。除了效率问题，还有更广泛的动机：探索在保持安全性的同时降低参与门槛的替代共识机制。PoC 使几乎任何拥有通用存储硬件的人都能有效挖矿，减少了 ASIC 主导的 PoW 挖矿中出现的中心化压力。

容量证明（PoC）通过从存储承诺而非持续计算中获得挖矿能力来实现这一点。矿工在一次性绘图阶段预先计算大量磁盘存储的哈希值——绘图。然后挖矿由轻量级查找组成，大幅降低能源使用，同时保留基于资源的共识的安全假设。

### 1.2 与 Bitcoin Core 集成

Bitcoin-PoCX 将 PoC 共识集成到 Bitcoin Core 中，而非创建新的区块链。这种方法利用了 Bitcoin Core 经过验证的安全性、成熟的网络堆栈和广泛采用的工具，同时保持最小化和特性标记的修改。PoC 逻辑与现有共识代码隔离，确保核心功能——区块验证、钱包操作、交易格式——基本保持不变。

### 1.3 设计目标

**安全性**：保持与 Bitcoin 同等的健壮性；攻击需要多数存储容量。

**效率**：将持续计算负载降低到磁盘 I/O 水平。

**可访问性**：使通用硬件能够挖矿，降低进入门槛。

**最小集成**：以最小的修改足迹引入 PoC 共识。

---

## 2. 背景：容量证明

### 2.1 历史

容量证明（PoC）于 2014 年由 Burstcoin 引入，作为工作量证明（PoW）的节能替代方案。Burstcoin 证明了挖矿能力可以从承诺的存储而非持续实时哈希中获得：矿工预先计算大型数据集（"绘图"）一次，然后通过读取其中的小的固定部分来挖矿。

早期 PoC 实现证明了概念的可行性，但也揭示了绘图格式和加密结构对安全性至关重要。一些时间-内存权衡允许攻击者用比诚实参与者更少的存储进行有效挖矿。这突显了 PoC 安全性取决于绘图设计——不仅仅是将存储用作资源。

Burstcoin 的遗产确立了 PoC 作为一种实用的共识机制，并为 PoCX 的构建提供了基础。

### 2.2 核心概念

PoC 挖矿基于存储在磁盘上的大型预计算绘图文件。这些绘图包含"冻结的计算"：昂贵的哈希在绘图期间执行一次，然后挖矿由轻量级磁盘读取和简单验证组成。核心元素包括：

**Nonce：**
绘图数据的基本单位。每个 nonce 包含 4096 个 scoop（总共 256 KiB），通过 Shabal256 从矿工地址和 nonce 索引生成。

**Scoop：**
nonce 内的 64 字节段。对于每个区块，网络根据前一个区块的生成签名确定性地选择一个 scoop 索引（0-4095）。每个 nonce 只需读取这个 scoop。

**生成签名：**
从前一个区块派生的 256 位值。它为 scoop 选择提供熵，防止矿工预测未来的 scoop 索引。

**Warp：**
4096 个 nonce 的结构组（1 GiB）。Warp 是压缩抗性绘图格式的相关单位。

### 2.3 挖矿流程和质量管道

PoC 挖矿由一次性绘图步骤和轻量级的逐块例程组成：

**一次性设置：**
- 绘图生成：通过 Shabal256 计算 nonce 并写入磁盘。

**逐块挖矿：**
- Scoop 选择：从生成签名确定 scoop 索引。
- 绘图扫描：从矿工绘图中的所有 nonce 读取该 scoop。

**质量管道：**
- 原始质量：使用 Shabal256Lite 将每个 scoop 与生成签名哈希，得到 64 位质量值（越低越好）。
- 截止时间：使用基础目标值（确保网络达到目标区块间隔的难度调整参数）将质量转换为截止时间：`deadline = quality / base_target`
- 弯曲截止时间：应用时间弯曲转换以减少方差，同时保持预期区块时间。

**区块锻造：**
拥有最短（弯曲后）截止时间的矿工在该时间过去后锻造下一个区块。

与 PoW 不同，几乎所有计算都发生在绘图期间；活跃挖矿主要受磁盘限制且功耗极低。

### 2.4 先前系统中的已知漏洞

**POC1 分布缺陷：**
原始 Burstcoin POC1 格式表现出结构性偏差：低索引 scoop 比高索引 scoop 的即时重新计算成本显著更低。这引入了非均匀时间-内存权衡，允许攻击者减少这些 scoop 所需的存储，打破了所有预计算数据成本相等的假设。

**XOR 压缩攻击（POC2）：**
在 POC2 中，攻击者可以取任意 8192 个 nonce 的集合，将它们分成两个 4096 个 nonce 的块（A 和 B）。攻击者不存储两个块，而是只存储一个派生结构：`A ⊕ transpose(B)`，其中转置交换 scoop 和 nonce 索引——块 B 中 nonce N 的 scoop S 变成 nonce S 的 scoop N。

挖矿时，当需要 nonce N 的 scoop S 时，攻击者通过以下方式重建它：
1. 读取位置 (S, N) 的存储 XOR 值
2. 从块 A 计算 nonce N 以获得 scoop S
3. 从块 B 计算 nonce S 以获得转置的 scoop N
4. XOR 所有三个值以恢复原始的 64 字节 scoop

这减少了 50% 的存储，同时每次查找只需要两次 nonce 计算——远低于强制完整预计算所需的阈值。该攻击可行是因为计算一行（一个 nonce，4096 个 scoop）成本低廉，而计算一列（跨 4096 个 nonce 的单个 scoop）需要重新生成所有 nonce。转置结构暴露了这种不平衡。

这表明需要一种防止此类结构重组并消除底层时间-内存权衡的绘图格式。第 3.3 节描述了 PoCX 如何解决这一弱点。

### 2.5 过渡到 PoCX

早期 PoC 系统的局限性清楚地表明，安全、公平和去中心化的存储挖矿取决于精心设计的绘图结构。Bitcoin-PoCX 通过加固的绘图格式、改进的截止时间分布和去中心化矿池挖矿机制来解决这些问题——将在下一节描述。

---

## 3. PoCX 绘图格式

### 3.1 基础 Nonce 构建

nonce 是一个 256 KiB 数据结构，由三个参数确定性派生：20 字节地址载荷、32 字节种子和 64 位 nonce 索引。

构建从组合这些输入并使用 Shabal256 哈希它们以产生初始哈希开始。这个哈希作为迭代扩展过程的起点：Shabal256 反复应用，每一步都依赖于之前生成的数据，直到整个 256 KiB 缓冲区被填满。这个链式过程代表了绘图期间执行的计算工作。

最后的扩散步骤哈希完成的缓冲区并将结果 XOR 到所有字节上。这确保了整个缓冲区已被计算，矿工无法走捷径。然后应用 PoC2 洗牌，交换每个 scoop 的上下半部分，以保证所有 scoop 需要相等的计算工作。

最终的 nonce 由 4096 个各 64 字节的 scoop 组成，构成挖矿中使用的基本单位。

### 3.2 SIMD 对齐的绘图布局

为了在现代硬件上最大化吞吐量，PoCX 将磁盘上的 nonce 数据组织起来以便于向量化处理。PoCX 不是顺序存储每个 nonce，而是将多个连续 nonce 中对应的 4 字节字连续对齐。这允许单次内存获取为所有 SIMD 通道提供数据，最小化缓存未命中并消除分散-聚集开销。

```
传统布局：
Nonce0: [W0][W1][W2][W3]...
Nonce1: [W0][W1][W2][W3]...
Nonce2: [W0][W1][W2][W3]...

PoCX SIMD 布局：
Word0: [N0][N1][N2]...[N15]
Word1: [N0][N1][N2]...[N15]
Word2: [N0][N1][N2]...[N15]
```

这种布局对 CPU 和 GPU 矿工都有益，实现高吞吐量、并行化的 scoop 评估，同时为共识验证保留简单的标量访问模式。它确保挖矿受存储带宽而非 CPU 计算限制，保持容量证明的低功耗特性。

### 3.3 Warp 结构和 XOR 转置编码

warp 是 PoCX 中的基本存储单位，由 4096 个 nonce（1 GiB）组成。未压缩格式称为 X0，包含第 3.1 节构建中精确产生的基础 nonce。

**XOR 转置编码（X1）**

为了消除早期 PoC 系统中存在的结构性时间-内存权衡，PoCX 通过对 X0 warp 对应用 XOR 转置编码派生加固的挖矿格式 X1。

构建 X1 warp 中 nonce N 的 scoop S：

1. 从第一个 X0 warp 中取 nonce N 的 scoop S（直接位置）
2. 从第二个 X0 warp 中取 nonce S 的 scoop N（转置位置）
3. XOR 两个 64 字节值得到 X1 scoop

转置步骤交换 scoop 和 nonce 索引。用矩阵术语来说——其中行表示 scoop，列表示 nonce——它将第一个 warp 中位置 (S, N) 的元素与第二个 warp 中位置 (N, S) 的元素组合。

**为什么这消除了压缩攻击面**

XOR 转置将每个 scoop 与底层 X0 数据的整行和整列相互关联。因此恢复单个 X1 scoop 需要访问跨越所有 4096 个 scoop 索引的数据。任何试图计算缺失数据的尝试都需要重新生成 4096 个完整的 nonce，而不是单个 nonce——消除了 POC2 的 XOR 攻击所利用的非对称成本结构（第 2.4 节）。

因此，存储完整的 X1 warp 成为矿工唯一计算可行的策略，关闭了先前设计中利用的时间-内存权衡。

### 3.4 磁盘布局

PoCX 绘图文件由许多连续的 X1 warp 组成。为了在挖矿期间最大化操作效率，每个文件中的数据按 scoop 组织：所有 warp 的 scoop 0 数据顺序存储，接着是所有 scoop 1 数据，依此类推，直到 scoop 4095。

这种**scoop 顺序排序**允许矿工通过单次顺序磁盘访问读取所选 scoop 所需的完整数据，最小化寻道时间并最大化通用存储设备上的吞吐量。

结合第 3.3 节的 XOR 转置编码，这种布局确保文件既**结构加固**又**操作高效**：顺序 scoop 排序支持最优磁盘 I/O，而 SIMD 对齐的内存布局（见第 3.2 节）允许高吞吐量、并行化的 scoop 评估。

### 3.5 工作量证明扩展（Xn）

PoCX 通过扩展级别的概念实现可扩展的预计算，表示为 Xn，以适应不断发展的硬件性能。基线 X1 格式代表第一个 XOR 转置加固的 warp 结构。

每个扩展级别 Xn 相对于 X1 呈指数增加每个 warp 中嵌入的工作量证明：级别 Xn 所需的工作量是 X1 的 2^(n-1) 倍。从 Xn 过渡到 Xn+1 在操作上等同于对相邻 warp 对应用 XOR，逐步嵌入更多工作量证明而不改变底层绘图大小。

在较低扩展级别创建的现有绘图文件仍可用于挖矿，但它们对区块生成的贡献按比例减少，反映其较低的嵌入工作量证明。这种机制确保 PoCX 绘图随时间保持安全、灵活和经济平衡。

### 3.6 种子功能

种子参数使每个地址可以拥有多个不重叠的绘图，无需手动协调。

**问题（POC2）**：矿工必须手动跟踪绘图文件之间的 nonce 范围以避免重叠。重叠的 nonce 浪费存储而不增加挖矿能力。

**解决方案**：每个 `(address, seed)` 对定义一个独立的密钥空间。具有不同种子的绘图永远不会重叠，无论 nonce 范围如何。矿工可以自由创建绘图而无需协调。

---

## 4. 容量证明共识

PoCX 用基于存储的证明机制扩展了 Bitcoin 的中本聪共识。矿工不是花费能源进行重复哈希，而是将大量预计算数据——绘图——提交到磁盘。在区块生成期间，他们必须定位这些数据的一小部分不可预测的部分并将其转换为证明。在预期时间窗口内提供最佳证明的矿工获得锻造下一个区块的权利。

本章描述 PoCX 如何构建区块元数据、派生不可预测性，以及将静态存储转换为安全、低方差的共识机制。

### 4.1 区块结构

PoCX 保留了熟悉的 Bitcoin 风格区块头，但引入了基于容量挖矿所需的额外共识字段。这些字段共同将区块绑定到矿工存储的绘图、网络难度以及定义每个挖矿挑战的加密熵。

在高层次上，PoCX 区块包含：区块高度，明确记录以简化上下文验证；生成签名，将每个区块与其前任链接的新鲜熵源；基础目标值，以逆形式表示网络难度（更高的值对应更容易的挖矿）；PoCX 证明，标识矿工的绘图、绘图期间使用的压缩级别、选定的 nonce 和从中派生的质量；以及签名密钥和签名，证明对用于锻造区块的容量的控制（或委派的锻造密钥）。

证明嵌入了验证者重新计算挑战、验证选定的 scoop 和确认结果质量所需的所有共识相关信息。通过扩展而非重新设计区块结构，PoCX 在概念上与 Bitcoin 保持一致，同时实现了根本不同的挖矿工作来源。

### 4.2 生成签名链

生成签名提供了安全容量证明挖矿所需的不可预测性。每个区块从前一个区块的签名和签名者派生其生成签名，确保矿工无法预测未来的挑战或预计算有利的绘图区域：

`generationSignature[n] = SHA256(generationSignature[n-1] || miner_pubkey[n-1])`

这产生了一系列加密强度高、依赖矿工的熵值。因为矿工的公钥在前一个区块发布之前是未知的，没有参与者可以预测未来的 scoop 选择。这防止了选择性预计算或策略性绘图，并确保每个区块都引入真正新鲜的挖矿工作。

### 4.3 锻造流程

PoCX 中的挖矿包括将存储的数据转换为完全由生成签名驱动的证明。虽然过程是确定性的，但签名的不可预测性确保矿工无法提前准备，必须反复访问其存储的绘图。

**挑战派生（Scoop 选择）：** 矿工将当前生成签名与区块高度哈希以获得 0-4095 范围内的 scoop 索引。这个索引确定每个存储 nonce 的哪个 64 字节段参与证明。因为生成签名依赖于前一个区块的签名者，scoop 选择只在区块发布时才知道。

**证明评估（质量计算）：** 对于绘图中的每个 nonce，矿工检索选定的 scoop 并将其与生成签名一起哈希以获得质量——一个 64 位值，其大小决定矿工的竞争力。较低的质量对应更好的证明。

**截止时间形成（时间弯曲）：** 原始截止时间与质量成正比，与基础目标值成反比。在传统 PoC 设计中，这些截止时间遵循高度偏斜的指数分布，产生不提供额外安全性的长尾延迟。PoCX 使用时间弯曲（第 4.4 节）转换原始截止时间，减少方差并确保可预测的区块间隔。一旦弯曲截止时间过去，矿工通过嵌入证明并用有效锻造密钥签名来锻造区块。

### 4.4 时间弯曲

容量证明产生指数分布的截止时间。在短暂的时间——通常几十秒——之后，每个矿工都已经识别出他们的最佳证明，任何额外的等待时间只贡献延迟，而非安全性。

时间弯曲通过应用立方根转换来重塑分布：

`deadline_bended = scale × (quality / base_target)^(1/3)`

比例因子保持预期区块时间（120 秒），同时显著降低方差。短截止时间被扩展，改善区块传播和网络安全。长截止时间被压缩，防止异常值延迟链。

![区块时间分布](blocktime_distributions.svg)

时间弯曲保持底层证明的信息内容。它不修改矿工之间的竞争力；它只是重新分配等待时间以产生更平滑、更可预测的区块间隔。实现使用定点算术（Q42 格式）和 256 位整数以确保跨所有平台的确定性结果。

### 4.5 难度调整

PoCX 使用基础目标值（一种逆难度度量）来调节区块生产。预期区块时间与比率 `quality / base_target` 成正比，因此增加基础目标值加速区块创建，而减少它减慢链速度。

难度使用最近区块之间的测量时间与目标间隔的比较进行逐块调整。这种频繁调整是必要的，因为存储容量可以快速添加或移除——不像 Bitcoin 的哈希算力变化更慢。

调整遵循两个指导约束：**渐进性**——每块变化有界（最大 ±20%）以避免振荡或操纵；**强化**——基础目标值不能超过其创世值，防止网络难度低于原始安全假设。

### 4.6 区块有效性

当 PoCX 中的区块呈现与共识状态一致的可验证存储派生证明时，它是有效的。验证者独立重新计算 scoop 选择，从提交的 nonce 和绘图元数据派生预期质量，应用时间弯曲转换，并确认矿工有资格在声明的时间锻造区块。

具体来说，有效区块要求：自父区块以来截止时间已过；提交的质量与证明的计算质量匹配；扩展级别满足网络最低要求；生成签名与预期值匹配；基础目标值与预期值匹配；区块签名来自有效签名者；coinbase 支付给有效签名者的地址。

---

## 5. 锻造委派

### 5.1 动机

锻造委派允许绘图所有者委派区块锻造权限而永远不放弃其绘图的所有权。这种机制支持矿池挖矿和冷存储设置，同时保持 PoCX 的安全保证。

在矿池挖矿中，绘图所有者可以授权矿池代表他们锻造区块。矿池组装区块并分配奖励，但它永远不会获得绘图本身的托管权。委派可以随时撤销，绘图所有者可以自由离开矿池或更改配置而无需重新绘图。

委派还支持冷热密钥之间的清晰分离。控制绘图的私钥可以保持离线，而单独的锻造密钥——存储在在线机器上——生产区块。因此锻造密钥的泄露只会危及锻造权限，而非所有权。绘图保持安全，委派可以被撤销，立即关闭安全缺口。

因此锻造委派提供了操作灵活性，同时保持存储容量控制权永远不得转移给中介的原则。

### 5.2 委派协议

委派通过 OP_RETURN 交易声明，以避免 UTXO 集的不必要增长。委派交易指定绘图地址和被授权使用该绘图容量生产区块的锻造地址。撤销交易只包含绘图地址。在两种情况下，绘图所有者通过签名交易的支出输入来证明控制权。

每个委派经过一系列明确定义的状态（UNASSIGNED、ASSIGNING、ASSIGNED、REVOKING、REVOKED）。委派交易确认后，系统进入短暂的激活阶段。这个延迟——30 个区块，大约一小时——确保区块竞争期间的稳定性，防止对手快速切换锻造身份。一旦这个激活期过期，委派变为活跃并保持到绘图所有者发出撤销。

撤销转换为更长的延迟期，720 个区块，大约一天。在此期间，之前的锻造地址保持活跃。这个更长的延迟为矿池提供操作稳定性，防止策略性的"委派跳跃"并给基础设施提供者足够的确定性以高效运营。撤销延迟过期后，撤销完成，绘图所有者可以自由指定新的锻造密钥。

委派状态在与 UTXO 集平行的共识层结构中维护，并支持撤销数据以安全处理链重组。

### 5.3 验证规则

对于每个区块，验证者确定有效签名者——必须签名区块并接收 coinbase 奖励的地址。这个签名者完全取决于区块高度的委派状态。

如果不存在委派或委派尚未完成激活阶段，绘图所有者保持为有效签名者。一旦委派变为活跃，指定的锻造地址必须签名。在撤销期间，锻造地址继续签名直到撤销延迟过期。只有那时权限才返回给绘图所有者。

验证者强制执行区块签名由有效签名者产生，coinbase 支付给同一地址，所有转换遵循规定的激活和撤销延迟。只有绘图所有者可以创建或撤销委派；锻造密钥不能修改或扩展自己的权限。

因此锻造委派在不引入信任的情况下引入了灵活的委派。底层容量的所有权始终加密锚定到绘图所有者，而锻造权限可以随着操作需求的演变而委派、轮换或撤销。

---

## 6. 动态扩展

随着硬件发展，计算绘图的成本相对于从磁盘读取预计算工作的成本下降。如果没有对策，攻击者最终可能比矿工读取存储工作更快地即时生成证明，破坏容量证明的安全模型。

为了保持预期的安全边际，PoCX 实施了扩展计划：绘图所需的最低扩展级别随时间增加。每个扩展级别 Xn，如第 3.5 节所述，在绘图结构中嵌入指数级更多的工作量证明，确保矿工即使在计算变得更便宜时也继续承诺大量存储资源。

该计划与网络的经济激励对齐，特别是区块奖励减半。随着每区块奖励减少，最低级别逐渐增加，保持绘图努力和挖矿潜力之间的平衡：

| 时期   | 年份   | 减半次数 | 最低扩展 | 绘图工作倍数 |
|--------|--------|----------|----------|--------------|
| 时期 0 | 0-4    | 0        | X1       | 2 倍基线     |
| 时期 1 | 4-12   | 1-2      | X2       | 4 倍基线     |
| 时期 2 | 12-28  | 3-6      | X3       | 8 倍基线     |
| 时期 3 | 28-60  | 7-14     | X4       | 16 倍基线    |
| 时期 4 | 60-124 | 15-30    | X5       | 32 倍基线    |
| 时期 5 | 124+   | 31+      | X6       | 64 倍基线    |

矿工可以选择准备超过当前最低一级的绘图，允许他们提前计划并避免网络过渡到下一个时期时的即时升级。这个可选步骤在区块概率方面不提供额外优势——它只是允许更平滑的操作过渡。

包含低于其高度最低扩展级别证明的区块被视为无效。验证者在共识验证期间检查证明中声明的扩展级别与当前网络要求，确保所有参与矿工满足不断发展的安全期望。

---

## 7. 挖矿架构

PoCX 将共识关键操作与挖矿的资源密集型任务分离，实现安全性和效率兼顾。节点维护区块链、验证区块、管理内存池并公开 RPC 接口。外部矿工处理绘图存储、scoop 读取、质量计算和截止时间管理。这种分离保持共识逻辑简单可审计，同时允许矿工针对磁盘吞吐量进行优化。

### 7.1 挖矿 RPC 接口

矿工通过最小的 RPC 调用集与节点交互。get_mining_info RPC 提供当前区块高度、生成签名、基础目标值、目标截止时间和可接受的绘图扩展级别范围。使用这些信息，矿工计算候选 nonce。submit_nonce RPC 允许矿工提交建议的解决方案，包括绘图标识符、nonce 索引、扩展级别和矿工账户。节点评估提交并在证明有效时响应计算的截止时间。

### 7.2 锻造调度器

节点维护一个锻造调度器，跟踪传入的提交并只保留每个区块高度的最佳解决方案。提交的 nonce 带有内置保护排队，防止提交泛滥或拒绝服务攻击。调度器等待直到计算的截止时间过期或更好的解决方案到达，届时它组装区块，用有效锻造密钥签名，并发布到网络。

### 7.3 防御性锻造

为了防止时间攻击或时钟操纵的激励，PoCX 实现了防御性锻造。如果同一高度的竞争区块到达，调度器将本地解决方案与新区块进行比较。如果本地质量更优，节点立即锻造而不是等待原始截止时间。这确保矿工不能仅仅通过调整本地时钟获得优势；最佳解决方案总是获胜，保持公平性和网络安全。

---

## 8. 安全分析

### 8.1 威胁模型

PoCX 模拟具有大量但有限能力的对手。攻击者可能试图通过无效交易、畸形区块或伪造证明来使网络超载，以压力测试验证路径。他们可以自由操纵本地时钟，并可能尝试利用共识行为中的边缘情况，如时间戳处理、难度调整动态或重组规则。对手还被期望探索通过目标链分叉重写历史的机会。

该模型假设没有单一方控制总网络存储容量的多数。与任何基于资源的共识机制一样，51% 容量攻击者可以单方面重组链；这一基本限制并非 PoCX 特有。PoCX 还假设攻击者无法比诚实矿工从磁盘读取更快地计算绘图数据。扩展计划（第 6 节）确保随着硬件改进，安全性所需的计算差距会随时间增长。

以下各节详细检查每个主要攻击类别并描述 PoCX 中内置的对策。

### 8.2 容量攻击

与 PoW 一样，拥有多数容量的攻击者可以重写历史（51% 攻击）。实现这需要获取比诚实网络更大的物理存储占用——这是昂贵且后勤要求高的事业。一旦获得硬件，运营成本低，但初始投资创造了诚实行为的强经济激励：破坏链将损害攻击者自身资产基础的价值。

PoC 还避免了与 PoS 相关的无利害关系问题。虽然矿工可以针对多个竞争分叉扫描绘图，但每次扫描消耗真实时间——通常每条链几十秒。在 120 秒区块间隔下，这固有地限制了多分叉挖矿，同时尝试挖掘多个分叉会降低所有分叉的性能。因此分叉挖矿不是无成本的；它从根本上受 I/O 吞吐量限制。

即使未来硬件允许近乎即时的绘图扫描（例如高速 SSD），攻击者仍将面临控制网络容量多数的大量物理资源需求，使 51% 式攻击昂贵且后勤上具有挑战性。

最后，容量攻击比哈希算力攻击更难租用。GPU 计算可以按需获取并立即重定向到任何 PoW 链。相比之下，PoC 需要物理硬件、耗时的绘图和持续的 I/O 操作。这些约束使短期、机会主义攻击的可行性大大降低。

### 8.3 时间攻击

时间在容量证明中比工作量证明扮演更关键的角色。在 PoW 中，时间戳主要影响难度调整；在 PoC 中，它们决定矿工的截止时间是否已过，因此决定区块是否有资格锻造。截止时间相对于父区块的时间戳测量，但节点的本地时钟用于判断传入区块是否太远在未来。因此 PoCX 强制执行严格的时间戳容差：区块不得偏离节点本地时钟超过 15 秒（相比 Bitcoin 的 2 小时窗口）。这个限制双向有效——太远在未来的区块被拒绝，时钟慢的节点可能错误地拒绝有效的传入区块。

因此节点应该使用 NTP 或等效时间源同步其时钟。PoCX 故意避免依赖网络内部时间源，以防止攻击者操纵感知的网络时间。节点监控自己的漂移，如果本地时钟开始偏离最近区块时间戳则发出警告。

时钟加速——运行快速本地时钟以稍早锻造——只提供边际收益。在允许的容差内，防御性锻造（第 7.3 节）确保拥有更好解决方案的矿工在看到较差的早期区块时会立即发布。快速时钟只帮助矿工提前几秒发布已经获胜的解决方案；它不能将较差的证明转换为获胜的证明。

通过时间戳操纵难度的尝试受到每块 ±20% 调整上限和 24 块滚动窗口的限制，防止矿工通过短期时间博弈有意义地影响难度。

### 8.4 时间-内存权衡攻击

时间-内存权衡试图通过按需重新计算部分绘图来减少存储需求。先前的容量证明系统容易受到此类攻击，最显著的是 POC1 scoop 不平衡缺陷和 POC2 XOR 转置压缩攻击（第 2.4 节）。两者都利用了重新生成绘图数据某些部分的成本不对称性，允许对手减少存储同时只支付小的计算代价。此外，PoC2 的替代绘图格式也存在类似的 TMTO 弱点；一个突出的例子是 Chia，其绘图格式可以任意减少超过 4 倍。

PoCX 通过其 nonce 构建和 warp 格式完全消除了这些攻击面。在每个 nonce 内，最后的扩散步骤哈希完全计算的缓冲区并将结果 XOR 到所有字节上，确保缓冲区的每个部分都依赖于其他每个部分且无法走捷径。之后，PoC2 洗牌交换每个 scoop 的上下半部分，均衡恢复任何 scoop 的计算成本。

PoCX 通过派生其加固的 X1 格式进一步消除了 POC2 XOR 转置压缩攻击，其中每个 scoop 是跨配对 warp 的直接和转置位置的 XOR；这将每个 scoop 与底层 X0 数据的整行和整列相互关联，使重建需要数千个完整 nonce，从而完全消除不对称时间-内存权衡。

因此，存储完整绘图是矿工唯一计算可行的策略。没有已知的捷径——无论是部分绘图、选择性重新生成、结构化压缩还是混合计算-存储方法——能提供有意义的优势。PoCX 确保挖矿保持严格受存储限制，容量反映真实的物理承诺。

### 8.5 委派攻击

PoCX 使用确定性状态机来治理所有绘图到锻造者的委派。每个委派经过明确定义的状态——UNASSIGNED → ASSIGNING → ASSIGNED → REVOKING → REVOKED——具有强制的激活和撤销延迟。这确保矿工无法即时更改委派以欺骗系统或快速切换锻造权限。

因为所有转换都需要加密证明——具体来说，是绘图所有者的签名，可针对输入 UTXO 进行验证——网络可以信任每个委派的合法性。试图绕过状态机或伪造委派的尝试在共识验证期间自动被拒绝。重放攻击同样被标准 Bitcoin 风格的交易重放保护阻止，确保每个委派操作都唯一绑定到有效的未花费输入。

状态机治理、强制延迟和加密证明的结合使基于委派的作弊实际上不可能：矿工无法劫持委派、在区块竞争期间执行快速重新分配或规避撤销计划。

### 8.6 签名安全

PoCX 中的区块签名作为证明和有效锻造密钥之间的关键链接，确保只有授权矿工可以产生有效区块。

为了防止可延展性攻击，签名从区块哈希计算中排除。这消除了可能破坏验证或允许区块替换攻击的可延展签名风险。

为了缓解拒绝服务向量，签名和公钥大小是固定的——紧凑签名 65 字节，压缩公钥 33 字节——防止攻击者膨胀区块以触发资源耗尽或减慢网络传播。

---

## 9. 实现

PoCX 作为 Bitcoin Core 的模块化扩展实现，所有相关代码包含在其专用子目录中，并通过特性标志激活。这种设计保持了原始代码的完整性，允许 PoCX 被干净地启用或禁用，简化了测试、审计和与上游变更保持同步。

集成只触及支持容量证明所必需的关键点。区块头已扩展以包含 PoCX 特定字段，共识验证已调整以处理存储基础的证明以及传统 Bitcoin 检查。锻造系统负责管理截止时间、调度和矿工提交，完全包含在 PoCX 模块中，而 RPC 扩展向外部客户端公开挖矿和委派功能。对于用户，钱包界面已增强以通过 OP_RETURN 交易管理委派，实现与新共识功能的无缝交互。

所有共识关键操作都在没有外部依赖的确定性 C++ 中实现，确保跨平台一致性。Shabal256 用于哈希，而时间弯曲和质量计算依赖于定点算术和 256 位操作。签名验证等加密操作利用 Bitcoin Core 现有的 secp256k1 库。

通过以这种方式隔离 PoCX 功能，实现保持可审计、可维护，并与正在进行的 Bitcoin Core 开发完全兼容，证明了根本新的存储限制共识机制可以与成熟的工作量证明代码库共存而不破坏其完整性或可用性。

---

## 10. 网络参数

PoCX 建立在 Bitcoin 的网络基础设施上，重用其链参数框架。为了支持基于容量的挖矿、区块间隔、委派处理和绘图扩展，几个参数已被扩展或覆盖。这包括区块时间目标、初始奖励、减半计划、委派激活和撤销延迟，以及网络标识符如魔术字节、端口和 Bech32 前缀。测试网和 regtest 环境进一步调整这些参数以实现快速迭代和低容量测试。

以下表格总结了主网、测试网和 regtest 设置，突出了 PoCX 如何将 Bitcoin 的核心参数适配到存储限制的共识模型。

### 10.1 主网

| 参数         | 值                        |
|--------------|---------------------------|
| 魔术字节     | `0xa7 0x3c 0x91 0x5e`     |
| 默认端口     | 8888                      |
| Bech32 HRP   | `pocx`                    |
| 区块时间目标 | 120 秒                    |
| 初始奖励     | 10 BTC                    |
| 减半间隔     | 1050000 个区块（约 4 年） |
| 总供应量     | 约 2100 万 BTC            |
| 委派激活     | 30 个区块                 |
| 委派撤销     | 720 个区块                |
| 滚动窗口     | 24 个区块                 |

### 10.2 测试网

| 参数         | 值                    |
|--------------|-----------------------|
| 魔术字节     | `0x6d 0xf2 0x48 0xb3` |
| 默认端口     | 18888                 |
| Bech32 HRP   | `tpocx`               |
| 区块时间目标 | 120 秒                |
| 其他参数     | 与主网相同            |

### 10.3 Regtest

| 参数         | 值                     |
|--------------|------------------------|
| 魔术字节     | `0xfa 0xbf 0xb5 0xda`  |
| 默认端口     | 18444                  |
| Bech32 HRP   | `rpocx`                |
| 区块时间目标 | 1 秒                   |
| 减半间隔     | 500 个区块             |
| 委派激活     | 4 个区块               |
| 委派撤销     | 8 个区块               |
| 低容量模式   | 已启用（约 4 MB 绘图） |

---

## 11. 相关工作

多年来，几个区块链和共识项目探索了基于存储或混合挖矿模型。PoCX 建立在这一血统上，同时在安全性、效率和兼容性方面引入了增强。

**Burstcoin / Signum。** Burstcoin 于 2014 年引入了第一个实用的容量证明（PoC）系统，定义了绘图、nonce、scoop 和基于截止时间挖矿等核心概念。它的后继者，特别是 Signum（前身 Burstcoin），扩展了生态系统，最终演变为所谓的承诺证明（PoC+），将存储承诺与可选质押相结合以影响有效容量。PoCX 继承了这些项目的基于存储挖矿基础，但通过加固绘图格式（XOR 转置编码）、动态绘图工作扩展、截止时间平滑（"时间弯曲"）和灵活的委派系统显著不同——同时锚定在 Bitcoin Core 代码库而非维护独立的网络分叉。

**Chia。** Chia 实现了空间和时间证明，将基于磁盘的存储证明与通过可验证延迟函数（VDF）强制的时间组件相结合。它的设计解决了关于证明重用和新鲜挑战生成的某些问题，与经典 PoC 不同。PoCX 不采用那种时间锚定证明模型；相反，它维护具有可预测间隔的存储限制共识，针对与 UTXO 经济学和 Bitcoin 派生工具的长期兼容性进行了优化。

**Spacemesh。** Spacemesh 提出了一种空间时间证明（PoST）方案，使用基于 DAG（网格）的网络拓扑。在这个模型中，参与者必须定期证明分配的存储随时间保持完整，而不是依赖于单个预计算数据集。相比之下，PoCX 仅在区块时间验证存储承诺——使用加固绘图格式和严格的证明验证——避免持续存储证明的开销，同时保持效率和去中心化。

---

## 12. 结论

Bitcoin-PoCX 证明了节能共识可以集成到 Bitcoin Core 中，同时保持安全属性和经济模型。关键贡献包括 XOR 转置编码（迫使攻击者每次查找计算 4096 个 nonce，消除压缩攻击）、时间弯曲算法（分布转换减少区块时间方差）、锻造委派系统（基于 OP_RETURN 的委派实现非托管矿池挖矿）、动态扩展（与减半对齐以保持安全边际），以及最小集成（特性标记代码隔离在专用目录中）。

该系统目前处于测试网阶段。挖矿能力来自存储容量而非哈希率，将能源消耗降低数个数量级，同时保持 Bitcoin 经过验证的经济模型。

---

## 参考文献

Bitcoin Core. *Bitcoin Core Repository.* https://github.com/bitcoin/bitcoin

Burstcoin. *Proof of Capacity Technical Documentation.* 2014.

NIST. *SHA-3 Competition: Shabal.* 2008.

Cohen, B., Pietrzak, K. *The Chia Network Blockchain.* 2019.

Spacemesh. *Spacemesh Protocol Documentation.* 2021.

PoC Consortium. *PoCX Framework.* https://github.com/PoC-Consortium/pocx

PoC Consortium. *Bitcoin-PoCX Integration.* https://github.com/PoC-Consortium/bitcoin-pocx

---

**许可证**：MIT
**组织**：容量证明联盟（Proof of Capacity Consortium）
**状态**：测试网阶段
