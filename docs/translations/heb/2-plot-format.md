[← הקודם: מבוא](1-introduction.md) | [📘 תוכן העניינים](index.md) | [הבא: קונצנזוס וכרייה →](3-consensus-and-mining.md)

---

# פרק 2: מפרט פורמט Plot של PoCX

מסמך זה מתאר את פורמט ה-plot של PoCX, גרסה משופרת של פורמט POC2 עם אבטחה משופרת, אופטימיזציות SIMD, ו-proof-of-work מדורג.

## סקירת פורמט

קובצי plot של PoCX מכילים ערכי hash של Shabal256 מחושבים מראש המאורגנים לפעולות כרייה יעילות. בהמשך למסורת PoC מאז POC1, **כל המטא-נתונים מוטמעים בשם הקובץ** - אין כותרת קובץ.

### סיומת קובץ
- **סטנדרטית**: `.pocx` (plots שהושלמו)
- **בתהליך**: `.tmp` (במהלך plotting, משנה שם ל-`.pocx` כשמסתיים)

## הקשר היסטורי והתפתחות פגיעויות

### פורמט POC1 (מדור קודם)
**שתי פגיעויות עיקריות (פשרות זמן-זיכרון):**

1. **פגם התפלגות PoW**
   - התפלגות לא-אחידה של proof-of-work בין scoops
   - מספרי scoop נמוכים ניתנים לחישוב בזמן אמת
   - **השפעה**: דרישות אחסון מופחתות לתוקפים

2. **התקפת דחיסת XOR** (פשרה של 50% זמן-זיכרון)
   - ניצלה תכונות מתמטיות להשגת הפחתת אחסון של 50%
   - **השפעה**: תוקפים יכלו לכרות עם חצי מהאחסון הנדרש

**אופטימיזציית פריסה**: פריסת scoop רציפה בסיסית ליעילות HDD

### פורמט POC2 (Burstcoin)
- ✅ **תוקן פגם התפלגות PoW**
- ❌ **פגיעות XOR-transpose נותרה ללא תיקון**
- **פריסה**: שמרה על אופטימיזציית scoop רציפה

### פורמט PoCX (נוכחי)
- ✅ **התפלגות PoW תוקנה** (ירושה מ-POC2)
- ✅ **פגיעות XOR-transpose תוקנה** (ייחודי ל-PoCX)
- ✅ **פריסת SIMD/GPU משופרת** מותאמת לעיבוד מקבילי ואיחוד זיכרון
- ✅ **Proof-of-work מדורג** מונע פשרות זמן-זיכרון ככל שכוח החישוב גדל (PoW מבוצע רק ביצירה או שדרוג plotfiles)

## קידוד XOR-Transpose

### הבעיה: פשרה של 50% זמן-זיכרון

בפורמטים POC1/POC2, תוקפים יכלו לנצל את היחס המתמטי בין scoops לאחסן רק חצי מהנתונים ולחשב את השאר בזמן אמת במהלך כרייה. "התקפת דחיסת XOR" זו חתרה תחת ערבות האחסון.

### הפתרון: הקשחת XOR-Transpose

PoCX גוזר את פורמט הכרייה שלו (X1) על ידי החלת קידוד XOR-transpose על זוגות של warps בסיס (X0):

**לבניית scoop S של nonce N ב-warp X1:**
1. קח את scoop S של nonce N מה-warp X0 הראשון (מיקום ישיר)
2. קח את scoop N של nonce S מה-warp X0 השני (מיקום מועתק)
3. בצע XOR על שני ערכי 64 הבתים לקבלת ה-scoop X1

שלב ההעתקה מחליף בין אינדקסים של scoop ו-nonce. במונחי מטריצה - כאשר שורות מייצגות scoops ועמודות מייצגות nonces - הוא משלב את האלמנט במיקום (S, N) ב-warp הראשון עם האלמנט ב-(N, S) בשני.

### מדוע זה מבטל את ההתקפה

ה-XOR-transpose משלב כל scoop עם שורה שלמה ועמודה שלמה של נתוני X0 הבסיסיים. שחזור scoop X1 בודד דורש אפוא גישה לנתונים המשתרעים על כל 4096 אינדקסי scoop. כל ניסיון לחשב נתונים חסרים ידרוש שחזור 4096 nonces מלאים במקום nonce בודד - הסרת מבנה העלות האסימטרי שנוצל בהתקפת XOR.

כתוצאה מכך, אחסון ה-warp X1 המלא הופך לאסטרטגיה הקיימא החישובית היחידה לכורים.

## מבנה מטא-נתונים בשם קובץ

כל מטא-נתוני ה-plot מקודדים בשם הקובץ בפורמט המדויק הבא:

```
{ACCOUNT_PAYLOAD}_{SEED}_{WARPS}_{SCALING}.pocx
```

### רכיבי שם קובץ

1. **ACCOUNT_PAYLOAD** (40 תווי hex)
   - נתוני חשבון גולמיים של 20 בתים כ-hex באותיות גדולות
   - בלתי תלוי ברשת (ללא מזהה רשת או checksum)
   - דוגמה: `DEADBEEFCAFEBABE1337C0DEBADC0FFEE15DEAD`

2. **SEED** (64 תווי hex)
   - ערך seed של 32 בתים כ-hex באותיות קטנות
   - **חדש ב-PoCX**: seed אקראי של 32 בתים בשם הקובץ מחליף מספור nonce רציף - מונע חפיפות plot
   - דוגמה: `c0ffeebeefcafebabedeadbeef1337c0de42424242feedfacecafed00dabad1dea`

3. **WARPS** (מספר עשרוני)
   - **יחידת גודל חדשה ב-PoCX**: מחליף גודל מבוסס nonce מ-POC1/POC2
   - **עיצוב עמיד ל-XOR-transpose**: כל warp = בדיוק 4096 nonces (גודל partition נדרש לטרנספורמציה עמידה ל-XOR-transpose)
   - **גודל**: 1 warp = 1073741824 בתים = 1 GiB (יחידה נוחה)
   - דוגמה: `1024` (plot של 1 TiB = 1024 warps)

4. **SCALING** (עשרוני עם קידומת X)
   - רמת סילום כ-`X{level}`
   - ערכים גבוהים יותר = יותר proof-of-work נדרש
   - דוגמה: `X4` (2^4 = 16× קושי POC2)

### דוגמאות שמות קבצים
```
DEADBEEFCAFEBABE1337C0DEBADC0FFEE15DEAD_c0ffeebeefcafebabedeadbeef1337c0de42424242feedfacecafed00dabad1dea_1024_X4.pocx
FEEDFACEDEADC0DE123456789ABCDEF012345678_b00b1e5feedc0debabeface5dea1deadc0de1337c0ffeebabeface5bad1dea5_2048_X1.pocx
```


## פריסת קובץ ומבנה נתונים

### ארגון היררכי
```
קובץ Plot (ללא כותרת)
├── Scoop 0
│   ├── Warp 0 (כל ה-nonces עבור scoop/warp זה)
│   ├── Warp 1
│   └── ...
├── Scoop 1
│   ├── Warp 0
│   ├── Warp 1
│   └── ...
└── Scoop 4095
    ├── Warp 0
    └── ...
```

### קבועים וגדלים

| קבוע | גודל | תיאור |
| --------------- | ----------------------- | ----------------------------------------------- |
| **HASH\_SIZE** | 32 B | פלט hash Shabal256 יחיד |
| **SCOOP\_SIZE** | 64 B (2 × HASH\_SIZE) | זוג hash נקראים בסבב כרייה |
| **NUM\_SCOOPS** | 4096 (2¹²) | scoops לכל nonce; אחד נבחר לכל סבב |
| **NONCE\_SIZE** | 262144 B (256 KiB) | כל ה-scoops של nonce (יחידה קטנה ביותר ב-PoC1/PoC2) |
| **WARP\_SIZE** | 1073741824 B (1 GiB) | יחידה קטנה ביותר ב-PoCX |

### פריסת קובץ Plot מותאמת ל-SIMD

PoCX מיישם דפוס גישת nonce מותאם ל-SIMD המאפשר עיבוד וקטורי של מספר nonces בו-זמנית. הוא מבוסס על מושגים ממחקר אופטימיזציית [POC2×16](https://www.reddit.com/r/burstcoin/comments/a1qyoq/cip_announcement_poc2x16_a_new_optimized_plot/) למיקסום תפוקת זיכרון ויעילות SIMD.

---

#### פריסה רציפה מסורתית

אחסון רציף של nonces:

```
[Nonce 0: נתוני Scoop] [Nonce 1: נתוני Scoop] [Nonce 2: נתוני Scoop] ...
```

חוסר יעילות SIMD: כל נתיב SIMD צריך את אותה מילה בין nonces:

```
Word 0 מ-Nonce 0 -> offset 0
Word 0 מ-Nonce 1 -> offset 512
Word 0 מ-Nonce 2 -> offset 1024
...
```

גישת scatter-gather מפחיתה תפוקה.

---

#### פריסת PoCX מותאמת ל-SIMD

PoCX מאחסן **מיקומי מילים בין 16 nonces** ברציפות:

```
שורת Cache (64 בתים):

Word0_N0 Word0_N1 Word0_N2 ... Word0_N15
Word1_N0 Word1_N1 Word1_N2 ... Word1_N15
...
```

**דיאגרמת ASCII**

```
פריסה מסורתית:

Nonce0: [W0][W1][W2][W3]...
Nonce1: [W0][W1][W2][W3]...
Nonce2: [W0][W1][W2][W3]...

פריסת PoCX:

Word0: [N0][N1][N2][N3]...[N15]
Word1: [N0][N1][N2][N3]...[N15]
Word2: [N0][N1][N2][N3]...[N15]
```

---

#### יתרונות גישת זיכרון

- שורת cache אחת מספקת את כל נתיבי SIMD.
- מבטל פעולות scatter-gather.
- מפחית החמצות cache.
- גישת זיכרון רציפה לחלוטין לחישוב וקטורי.
- גם GPUs נהנים מיישור 16-nonces, ממקסם יעילות cache.

---

#### סילום SIMD

| SIMD | רוחב וקטור* | Nonces | מחזורי עיבוד לשורת Cache |
|------------|---------------|--------|---------------------------------|
| SSE2/AVX | 128-bit | 4 | 4 מחזורים |
| AVX2 | 256-bit | 8 | 2 מחזורים |
| AVX512 | 512-bit | 16 | מחזור אחד |

\* לפעולות מספרים שלמים

---



## סילום Proof-of-Work

### רמות סילום
- **X0**: nonces בסיס ללא קידוד XOR-transpose (תיאורטי, לא משמש לכרייה)
- **X1**: קו בסיס XOR-transpose - פורמט מוקשח ראשון (1× עבודה)
- **X2**: 2× עבודת X1 (XOR בין 2 warps)
- **X3**: 4× עבודת X1 (XOR בין 4 warps)
- **...**
- **Xn**: 2^(n-1) × עבודת X1 מוטמעת

### יתרונות
- **קושי PoW מתכוונן**: מגדיל דרישות חישוב כדי לעמוד בקצב חומרה מהירה יותר
- **אריכות ימים של הפורמט**: מאפשר סילום גמיש של קושי כרייה לאורך זמן

### שדרוג Plot / תאימות לאחור

כאשר הרשת מגדילה את סקלת ה-PoW (Proof of Work) ב-1, plots קיימים דורשים שדרוג לשמירה על אותו גודל plot אפקטיבי. בעיקרו של דבר, כעת נדרש כפול PoW בקובצי ה-plot שלכם להשגת אותה תרומה לחשבון שלכם.

החדשות הטובות הן שה-PoW שכבר השלמתם ביצירת קובצי ה-plot שלכם לא אבד - פשוט צריך להוסיף PoW נוסף לקבצים הקיימים. אין צורך ב-replot.

לחלופין, ניתן להמשיך להשתמש ב-plots הנוכחיים ללא שדרוג, אבל שימו לב שהם כעת יתרמו רק 50% מהגודל האפקטיבי הקודם שלהם לחשבון שלכם. תוכנת הכרייה שלכם יכולה לסלם plotfile בזמן אמת.

## השוואה עם פורמטים קודמים

| תכונה | POC1 | POC2 | PoCX |
|---------|------|------|------|
| התפלגות PoW | ❌ פגומה | ✅ תוקנה | ✅ תוקנה |
| עמידות ל-XOR-Transpose | ❌ פגיע | ❌ פגיע | ✅ תוקנה |
| אופטימיזציית SIMD | ❌ אין | ❌ אין | ✅ מתקדמת |
| אופטימיזציית GPU | ❌ אין | ❌ אין | ✅ מותאם |
| Proof-of-Work מדורג | ❌ אין | ❌ אין | ✅ כן |
| תמיכת Seed | ❌ אין | ❌ אין | ✅ כן |

פורמט PoCX מייצג את המצב העדכני ביותר בפורמטים של Proof of Capacity plot, מתמודד עם כל הפגיעויות הידועות תוך מתן שיפורי ביצועים משמעותיים לחומרה מודרנית.

## הפניות וקריאה נוספת

- **רקע POC1/POC2**: [סקירת כריית Burstcoin](https://www.burstcoin.community/burstcoin-mining/) - מדריך מקיף לפורמטים מסורתיים של Proof of Capacity
- **מחקר POC2×16**: [הכרזת CIP: POC2×16 - פורמט plot מותאם חדש](https://www.reddit.com/r/burstcoin/comments/a1qyoq/cip_announcement_poc2x16_a_new_optimized_plot/) - מחקר אופטימיזציית SIMD מקורי שעורר השראה ל-PoCX
- **אלגוריתם Hash של Shabal**: [פרויקט Saphir: Shabal, הגשה לתחרות אלגוריתמי Hash קריפטוגרפיים של NIST](https://www.cs.rit.edu/~ark/20090927/Round2Candidates/Shabal.pdf) - מפרט טכני של אלגוריתם Shabal256 המשמש בכריית PoC

---

[← הקודם: מבוא](1-introduction.md) | [📘 תוכן העניינים](index.md) | [הבא: קונצנזוס וכרייה →](3-consensus-and-mining.md)
