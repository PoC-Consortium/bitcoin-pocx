[← הקודם: סנכרון זמן](5-timing-security.md) | [📘 תוכן העניינים](index.md) | [הבא: עיון ב-RPC →](7-rpc-reference.md)

---

# פרק 6: פרמטרי רשת ותצורה

מדריך מלא לתצורת רשת Bitcoin-PoCX בכל סוגי הרשתות.

---

## תוכן העניינים

1. [פרמטרי בלוק בראשית](#פרמטרי-בלוק-בראשית)
2. [תצורת Chainparams](#תצורת-chainparams)
3. [פרמטרי קונצנזוס](#פרמטרי-קונצנזוס)
4. [Coinbase ותגמולי בלוק](#coinbase-ותגמולי-בלוק)
5. [סילום דינמי](#סילום-דינמי)
6. [תצורת רשת](#תצורת-רשת)
7. [מבנה ספריית נתונים](#מבנה-ספריית-נתונים)

---

## פרמטרי בלוק בראשית

### חישוב Base Target

**נוסחה**: `genesis_base_target = 2^42 / block_time_seconds`

**רציונל**:
- כל nonce מייצג 256 KiB (64 בתים × 4096 scoops)
- 1 TiB = 2^22 nonces (הנחת קיבולת רשת התחלתית)
- איכות מינימלית צפויה ל-n nonces ≈ 2^64 / n
- עבור 1 TiB: E(quality) = 2^64 / 2^22 = 2^42
- לכן: base_target = 2^42 / block_time

**ערכים מחושבים**:
- Mainnet/Testnet/Signet (120s): `36650387592`
- Regtest (1s): משתמש במצב כיול קיבולת נמוכה

### הודעת בראשית

כל הרשתות חולקות את הודעת בראשית של Bitcoin:
```
"The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"
```

**יישום**: `src/kernel/chainparams.cpp`

---

## תצורת Chainparams

### פרמטרי Mainnet

**זהות רשת**:
- **בתי קסם**: `0xa7 0x3c 0x91 0x5e`
- **פורט ברירת מחדל**: `8888`
- **HRP של Bech32**: `pocx`

**קידומות כתובות** (Base58):
- PUBKEY_ADDRESS: `85` (כתובות מתחילות ב-'P')
- SCRIPT_ADDRESS: `90` (כתובות מתחילות ב-'R')
- SECRET_KEY: `128`

**תזמון בלוק**:
- **יעד זמן בלוק**: `120` שניות (2 דקות)
- **טווח זמן יעד**: `1209600` שניות (14 ימים)
- **MAX_FUTURE_BLOCK_TIME**: `15` שניות

**תגמולי בלוק**:
- **סבסידיה ראשונית**: `10 BTC`
- **מרווח חצייה**: `1050000` בלוקים (~4 שנים)
- **מספר חצאיות**: מקסימום 64 חצאיות

**התאמת קושי**:
- **חלון גלילה**: `24` בלוקים
- **התאמה**: כל בלוק
- **אלגוריתם**: ממוצע נע מעריכי

**עיכובי הקצאה**:
- **הפעלה**: `30` בלוקים (~שעה)
- **ביטול**: `720` בלוקים (~24 שעות)

### פרמטרי Testnet

**זהות רשת**:
- **בתי קסם**: `0x6d 0xf2 0x48 0xb3`
- **פורט ברירת מחדל**: `18888`
- **HRP של Bech32**: `tpocx`

**קידומות כתובות** (Base58):
- PUBKEY_ADDRESS: `127`
- SCRIPT_ADDRESS: `132`
- SECRET_KEY: `255`

**תזמון בלוק**:
- **יעד זמן בלוק**: `120` שניות
- **MAX_FUTURE_BLOCK_TIME**: `15` שניות
- **אפשר קושי מינימלי**: `true`

**תגמולי בלוק**:
- **סבסידיה ראשונית**: `10 BTC`
- **מרווח חצייה**: `1050000` בלוקים

**התאמת קושי**:
- **חלון גלילה**: `24` בלוקים

**עיכובי הקצאה**:
- **הפעלה**: `30` בלוקים (~שעה)
- **ביטול**: `720` בלוקים (~24 שעות)

### פרמטרי Regtest

**זהות רשת**:
- **בתי קסם**: `0xfa 0xbf 0xb5 0xda`
- **פורט ברירת מחדל**: `18444`
- **HRP של Bech32**: `rpocx`

**קידומות כתובות** (תואם Bitcoin):
- PUBKEY_ADDRESS: `111`
- SCRIPT_ADDRESS: `196`
- SECRET_KEY: `239`

**תזמון בלוק**:
- **יעד זמן בלוק**: שנייה `1` (כרייה מיידית לבדיקות)
- **טווח זמן יעד**: `86400` שניות (יום אחד)
- **MAX_FUTURE_BLOCK_TIME**: `15` שניות

**תגמולי בלוק**:
- **סבסידיה ראשונית**: `10 BTC`
- **מרווח חצייה**: `500` בלוקים

**התאמת קושי**:
- **חלון גלילה**: `24` בלוקים
- **אפשר קושי מינימלי**: `true`
- **ללא מיקוד מחדש**: `true`
- **כיול קיבולת נמוכה**: `true` (משתמש בכיול 16-nonce במקום 1 TiB)

**עיכובי הקצאה**:
- **הפעלה**: `4` בלוקים (~4 שניות)
- **ביטול**: `8` בלוקים (~8 שניות)

### פרמטרי Signet

**זהות רשת**:
- **בתי קסם**: 4 בתים ראשונים של SHA256d(signet_challenge)
- **פורט ברירת מחדל**: `38333`
- **HRP של Bech32**: `tpocx`

**תזמון בלוק**:
- **יעד זמן בלוק**: `120` שניות
- **MAX_FUTURE_BLOCK_TIME**: `15` שניות

**תגמולי בלוק**:
- **סבסידיה ראשונית**: `10 BTC`
- **מרווח חצייה**: `1050000` בלוקים

**התאמת קושי**:
- **חלון גלילה**: `24` בלוקים

---

## פרמטרי קונצנזוס

### פרמטרי תזמון

**MAX_FUTURE_BLOCK_TIME**: `15` שניות
- ספציפי ל-PoCX (Bitcoin משתמש ב-2 שעות)
- רציונל: תזמון PoC דורש אימות כמעט בזמן אמת
- בלוקים יותר מ-15s בעתיד נדחים

**אזהרת היסט זמן**: `10` שניות
- מפעילים מוזהרים כאשר שעון צומת סוטה >10s מזמן רשת
- אין אכיפה, מידע בלבד

**יעדי זמן בלוק**:
- Mainnet/Testnet/Signet: `120` שניות
- Regtest: שנייה `1`

**TIMESTAMP_WINDOW**: `15` שניות (שווה ל-MAX_FUTURE_BLOCK_TIME)

**יישום**: `src/chain.h`, `src/validation.cpp`

### פרמטרי התאמת קושי

**גודל חלון גלילה**: `24` בלוקים (כל הרשתות)
- ממוצע נע מעריכי של זמני בלוק אחרונים
- התאמה בכל בלוק
- תגובתי לשינויי קיבולת

**יישום**: `src/consensus/params.h`, לוגיקת קושי ביצירת בלוק

### פרמטרי מערכת הקצאות

**nForgingAssignmentDelay** (עיכוב הפעלה):
- Mainnet: `30` בלוקים (~שעה)
- Testnet: `30` בלוקים (~שעה)
- Regtest: `4` בלוקים (~4 שניות)

**nForgingRevocationDelay** (עיכוב ביטול):
- Mainnet: `720` בלוקים (~24 שעות)
- Testnet: `720` בלוקים (~24 שעות)
- Regtest: `8` בלוקים (~8 שניות)

**רציונל**:
- עיכוב הפעלה מונע הקצאה מחדש מהירה במהלך מרוצי בלוקים
- עיכוב ביטול מספק יציבות ומונע שימוש לרעה

**יישום**: `src/consensus/params.h`

---

## Coinbase ותגמולי בלוק

### לוח זמנים לסבסידיית בלוק

**סבסידיה ראשונית**: `10 BTC` (כל הרשתות)

**לוח חצייה**:
- כל `1050000` בלוקים (mainnet/testnet)
- כל `500` בלוקים (regtest)
- ממשיך למקסימום 64 חצאיות

**התקדמות חצייה**:
```
חצייה 0: 10.00000000 BTC  (בלוקים 0 - 1049999)
חצייה 1:  5.00000000 BTC  (בלוקים 1050000 - 2099999)
חצייה 2:  2.50000000 BTC  (בלוקים 2100000 - 3149999)
חצייה 3:  1.25000000 BTC  (בלוקים 3150000 - 4199999)
...
```

**היצע כולל**: ~21 מיליון BTC (זהה ל-Bitcoin)

### כללי פלט Coinbase

**יעד תשלום**:
- **ללא הקצאה**: Coinbase משלם לכתובת plot (proof.account_id)
- **עם הקצאה**: Coinbase משלם לכתובת כרייה (חותם אפקטיבי)

**פורמט פלט**: P2WPKH בלבד
- Coinbase חייב לשלם לכתובת bech32 SegWit v0
- נוצר ממפתח הציבורי של החותם האפקטיבי

**פתרון הקצאה**:
```cpp
effective_signer = GetEffectiveSigner(plot_address, height, view);
coinbase_script = P2WPKH(effective_signer);
```

**יישום**: `src/pocx/mining/scheduler.cpp:ForgeBlock()`

---

## סילום דינמי

### גבולות סילום

**מטרה**: הגדלת קושי ייצור plot ככל שהרשת מתבגרת למניעת ניפוח קיבולת

**מבנה**:
```cpp
struct CompressionBounds {
    uint8_t nPoCXMinCompression;     // רמה מינימלית מתקבלת
    uint8_t nPoCXTargetCompression;  // רמה מומלצת
};
```

**יחס**: `target = min + 1` (תמיד רמה אחת מעל מינימום)

### לוח הגדלת סילום

רמות סילום עולות ב**לוח זמנים מעריכי** על בסיס מרווחי חצייה:

| תקופת זמן | גובה בלוק | חצאיות | מינ' | יעד |
|-------------|--------------|----------|-----|--------|
| שנים 0-4 | 0 עד 1049999 | 0 | X1 | X2 |
| שנים 4-12 | 1050000 עד 3149999 | 1-2 | X2 | X3 |
| שנים 12-28 | 3150000 עד 7349999 | 3-6 | X3 | X4 |
| שנים 28-60 | 7350000 עד 15749999 | 7-14 | X4 | X5 |
| שנים 60-124 | 15750000 עד 32549999 | 15-30 | X5 | X6 |
| שנים 124+ | 32550000+ | 31+ | X6 | X7 |

**גבהי מפתח** (שנים → חצאיות → בלוקים):
- שנה 4: חצייה 1 בבלוק 1050000
- שנה 12: חצייה 3 בבלוק 3150000
- שנה 28: חצייה 7 בבלוק 7350000
- שנה 60: חצייה 15 בבלוק 15750000
- שנה 124: חצייה 31 בבלוק 32550000

### קושי רמת סילום

**סילום PoW**:
- רמת סילום X0: קו בסיס POC2 (תיאורטי)
- רמת סילום X1: קו בסיס XOR-transpose
- רמת סילום Xn: 2^(n-1) × עבודת X1 מוטמעת
- כל רמה מכפילה עבודת ייצור plot

**יישור כלכלי**:
- תגמולי בלוק נחצים → קושי ייצור plot עולה
- שומר על מרווח בטיחות: עלות יצירת plot > עלות חיפוש
- מונע ניפוח קיבולת משיפורי חומרה

### אימות Plot

**כללי אימות**:
- הוכחות מוגשות חייבות לכלול רמת סילום ≥ מינימום
- הוכחות עם סילום > יעד מתקבלות אך לא יעילות
- הוכחות מתחת למינימום: נדחות (PoW לא מספיק)

**אחזור גבולות**:
```cpp
auto bounds = GetPoCXCompressionBounds(height, halving_interval);
```

**יישום**: `src/pocx/algorithms/algorithms.h:GetPoCXCompressionBounds()`, `src/pocx/consensus/params.cpp`

---

## תצורת רשת

### צמתי Seed ו-DNS Seeds

**סטטוס**: placeholder להשקת mainnet

**תצורה מתוכננת**:
- צמתי seed: ייקבע
- DNS seeds: ייקבע

**מצב נוכחי** (testnet/regtest):
- אין תשתית seed ייעודית
- חיבורי עמיתים ידניים נתמכים דרך `-addnode`

**יישום**: `src/kernel/chainparams.cpp`

### נקודות בקרה

**נקודת בקרה בראשית**: תמיד בלוק 0

**נקודות בקרה נוספות**: לא מוגדרות כרגע

**עתיד**: נקודות בקרה יתווספו ככל ש-mainnet מתקדם

---

## תצורת פרוטוקול P2P

### גרסת פרוטוקול

**בסיס**: פרוטוקול Bitcoin Core v30.0
- **גרסת פרוטוקול**: ירושה מ-Bitcoin Core
- **סיביות שירות**: שירותי Bitcoin סטנדרטיים
- **סוגי הודעות**: הודעות P2P Bitcoin סטנדרטיות

**הרחבות PoCX**:
- כותרות בלוק כוללות שדות ספציפיים ל-PoCX
- הודעות בלוק כוללות נתוני הוכחת PoCX
- כללי אימות אוכפים קונצנזוס PoCX

**תאימות**: צמתי PoCX אינם תואמים לצמתי Bitcoin PoW (קונצנזוס שונה)

**יישום**: `src/protocol.h`, `src/net_processing.cpp`

---

## מבנה ספריית נתונים

### ספרייה ברירת מחדל

**מיקום**: `.bitcoin/` (זהה ל-Bitcoin Core)
- Linux: `~/.bitcoin/`
- macOS: `~/Library/Application Support/Bitcoin/`
- Windows: `%APPDATA%\Bitcoin\`

### תכני ספרייה

```
.bitcoin/
├── blocks/              # נתוני בלוק
│   ├── blk*.dat        # קובצי בלוק
│   ├── rev*.dat        # נתוני undo
│   └── index/          # אינדקס בלוקים (LevelDB)
├── chainstate/         # מערך UTXO + הקצאות כרייה (LevelDB)
├── wallets/            # קובצי ארנק
│   └── wallet.dat      # ארנק ברירת מחדל
├── bitcoin.conf        # קובץ תצורה
├── debug.log           # לוג debug
├── peers.dat           # כתובות עמיתים
├── mempool.dat         # שמירת mempool
└── banlist.dat         # עמיתים חסומים
```

### הבדלים מרכזיים מ-Bitcoin

**מסד נתוני Chainstate**:
- סטנדרטי: מערך UTXO
- **תוספת PoCX**: מצב הקצאות כרייה
- עדכונים אטומיים: UTXO + הקצאות מעודכנים יחד
- נתוני undo בטוחים ל-reorg להקצאות

**קובצי בלוק**:
- פורמט בלוק Bitcoin סטנדרטי
- **תוספת PoCX**: מורחב עם שדות הוכחת PoCX (account_id, seed, nonce, signature, pubkey)

### דוגמת קובץ תצורה

**bitcoin.conf**:
```ini
# בחירת רשת
#testnet=1
#regtest=1

# שרת כריית PoCX (נדרש לכורים חיצוניים)
miningserver=1

# הגדרות RPC
server=1
rpcuser=yourusername
rpcpassword=yourpassword
rpcallowip=127.0.0.1
rpcport=8332

# הגדרות חיבור
listen=1
port=8888
maxconnections=125

# יעד זמן בלוק (מידע, נאכף על ידי קונצנזוס)
# 120 שניות ל-mainnet/testnet
```

---

## הפניות לקוד

**Chainparams**: `src/kernel/chainparams.cpp`
**פרמטרי קונצנזוס**: `src/consensus/params.h`
**גבולות דחיסה**: `src/pocx/algorithms/algorithms.h`, `src/pocx/consensus/params.cpp`
**חישוב Base Target בראשית**: `src/pocx/consensus/params.cpp`
**לוגיקת תשלום Coinbase**: `src/pocx/mining/scheduler.cpp:ForgeBlock()`
**אחסון מצב הקצאה**: `src/coins.h`, `src/coins.cpp` (הרחבות CCoinsViewCache)

---

## הפניות צולבות

פרקים קשורים:
- [פרק 2: פורמט Plot](2-plot-format.md) - רמות סילום בייצור plot
- [פרק 3: קונצנזוס וכרייה](3-consensus-and-mining.md) - אימות סילום, מערכת הקצאות
- [פרק 4: הקצאות כרייה](4-forging-assignments.md) - פרמטרי עיכוב הקצאה
- [פרק 5: אבטחת תזמון](5-timing-security.md) - רציונל MAX_FUTURE_BLOCK_TIME

---

[← הקודם: סנכרון זמן](5-timing-security.md) | [📘 תוכן העניינים](index.md) | [הבא: עיון ב-RPC →](7-rpc-reference.md)
