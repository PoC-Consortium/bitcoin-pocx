[<- 이전: RPC 참조](7-rpc-reference.md) | [목차](index.md)

---

# 8장: 지갑 및 GUI 사용자 가이드

Bitcoin-PoCX Qt 지갑과 포징 할당 관리를 위한 완전한 가이드입니다.

---

## 목차

1. [개요](#개요)
2. [통화 단위](#통화-단위)
3. [포징 할당 대화상자](#포징-할당-대화상자)
4. [트랜잭션 내역](#트랜잭션-내역)
5. [주소 요구사항](#주소-요구사항)
6. [채굴 통합](#채굴-통합)
7. [문제 해결](#문제-해결)
8. [보안 모범 사례](#보안-모범-사례)

---

## 개요

### Bitcoin-PoCX 지갑 기능

Bitcoin-PoCX Qt 지갑(`bitcoin-qt`)은 다음을 제공합니다:
- 표준 Bitcoin Core 지갑 기능 (송금, 수신, 트랜잭션 관리)
- **포징 할당 관리자**: 플롯 할당 생성/취소를 위한 GUI
- **채굴 서버 모드**: `-miningserver` 플래그로 채굴 관련 기능 활성화
- **트랜잭션 내역**: 할당 및 취소 트랜잭션 표시

### 지갑 시작하기

**노드만** (채굴 없음):
```bash
./build/bin/bitcoin-qt
```

**채굴 포함** (할당 대화상자 활성화):
```bash
./build/bin/bitcoin-qt -server -miningserver
```

**명령줄 대안**:
```bash
./build/bin/bitcoind -miningserver
```

### 채굴 요구사항

**채굴 작업용**:
- `-miningserver` 플래그 필요
- P2WPKH 주소와 개인키가 있는 지갑
- 플롯 생성을 위한 외부 플로터 (`pocx_plotter`)
- 채굴을 위한 외부 마이너 (`pocx_miner`)

**풀 채굴용**:
- 풀 주소에 포징 할당 생성
- 풀 서버에서 지갑 필요 없음 (풀이 키 관리)

---

## 통화 단위

### 단위 표시

Bitcoin-PoCX는 **BTCX** 통화 단위를 사용합니다 (BTC 아님):

| 단위 | 사토시 | 표시 |
|------|--------|------|
| **BTCX** | 100000000 | 1.00000000 BTCX |
| **mBTCX** | 100000 | 1000.00 mBTCX |
| **uBTCX** | 100 | 1000000.00 uBTCX |
| **사토시** | 1 | 100000000 sat |

**GUI 설정**: 환경설정 -> 표시 -> 단위

---

## 포징 할당 대화상자

### 대화상자 접근

**메뉴**: `지갑 -> 포징 할당`
**도구 모음**: 채굴 아이콘 (`-miningserver` 플래그 사용 시에만 표시)
**창 크기**: 600×450 픽셀

### 대화상자 모드

#### 모드 1: 할당 생성

**목적**: 플롯 소유권을 유지하면서 풀이나 다른 주소에 포징 권한을 위임합니다.

**사용 사례**:
- 풀 채굴 (풀 주소에 할당)
- 콜드 스토리지 (채굴 키가 플롯 소유권과 분리)
- 공유 인프라 (핫 월렛에 위임)

**요구사항**:
- 플롯 주소 (P2WPKH bech32, 개인키 소유 필수)
- 포징 주소 (P2WPKH bech32, 플롯 주소와 다름)
- 지갑 잠금 해제 (암호화된 경우)
- 플롯 주소에 확인된 UTXO 있음

**단계**:
1. "할당 생성" 모드 선택
2. 드롭다운에서 플롯 주소 선택 또는 수동 입력
3. 포징 주소 입력 (풀 또는 위임자)
4. "할당 전송" 클릭 (입력이 유효하면 버튼 활성화)
5. 트랜잭션 즉시 브로드캐스트
6. `nForgingAssignmentDelay` 블록 후 할당 활성화:
   - 메인넷/테스트넷: 30 블록 (~1시간)
   - Regtest: 4 블록 (~4초)

**트랜잭션 수수료**: 기본 `minRelayFee`의 10배 (사용자 정의 가능)

**트랜잭션 구조**:
- 입력: 플롯 주소의 UTXO (소유권 증명)
- OP_RETURN 출력: `POCX` 마커 + plot_address + forging_address (46 바이트)
- 잔돈 출력: 지갑에 반환

#### 모드 2: 할당 취소

**목적**: 포징 할당을 취소하고 플롯 소유자에게 권한을 반환합니다.

**요구사항**:
- 플롯 주소 (개인키 소유 필수)
- 지갑 잠금 해제 (암호화된 경우)
- 플롯 주소에 확인된 UTXO 있음

**단계**:
1. "할당 취소" 모드 선택
2. 플롯 주소 선택
3. "취소 전송" 클릭
4. 트랜잭션 즉시 브로드캐스트
5. `nForgingRevocationDelay` 블록 후 취소 유효:
   - 메인넷/테스트넷: 720 블록 (~24시간)
   - Regtest: 8 블록 (~8초)

**효과**:
- 지연 기간 동안 포징 주소가 여전히 포징 가능
- 취소 완료 후 플롯 소유자가 권한 회복
- 이후 새 할당 생성 가능

**트랜잭션 구조**:
- 입력: 플롯 주소의 UTXO (소유권 증명)
- OP_RETURN 출력: `XCOP` 마커 + plot_address (26 바이트)
- 잔돈 출력: 지갑에 반환

#### 모드 3: 할당 상태 확인

**목적**: 플롯 주소에 대한 현재 할당 상태를 조회합니다.

**요구사항**: 없음 (읽기 전용, 지갑 필요 없음)

**단계**:
1. "할당 상태 확인" 모드 선택
2. 플롯 주소 입력
3. "상태 확인" 클릭
4. 상태 박스에 세부사항과 함께 현재 상태 표시

**상태 표시** (색상 코드):

**회색 - UNASSIGNED**
```
UNASSIGNED - 할당이 존재하지 않음
```

**주황색 - ASSIGNING**
```
ASSIGNING - 할당 활성화 대기 중
포징 주소: pocx1qforger...
생성 높이: 12000
활성화 높이: 12030 (5 블록 남음)
```

**녹색 - ASSIGNED**
```
ASSIGNED - 활성 할당
포징 주소: pocx1qforger...
생성 높이: 12000
활성화 높이: 12030
```

**적주황색 - REVOKING**
```
REVOKING - 취소 대기 중
포징 주소: pocx1qforger... (아직 활성)
할당 생성 높이: 12000
취소 높이: 12300
취소 유효 높이: 13020 (50 블록 남음)
```

**빨간색 - REVOKED**
```
REVOKED - 할당 취소됨
이전 할당 대상: pocx1qforger...
할당 생성 높이: 12000
취소 높이: 12300
취소 유효 높이: 13020
```

---

## 트랜잭션 내역

### 할당 트랜잭션 표시

**유형**: "Assignment"
**아이콘**: 채굴 아이콘 (채굴된 블록과 동일)

**주소 열**: 플롯 주소 (포징 권한이 할당되는 주소)
**금액 열**: 트랜잭션 수수료 (음수, 발신 트랜잭션)
**상태 열**: 확인 수 (0-6+)

**세부사항** (클릭 시):
- 트랜잭션 ID
- 플롯 주소
- 포징 주소 (OP_RETURN에서 파싱)
- 생성 높이
- 활성화 높이
- 트랜잭션 수수료
- 타임스탬프

### 취소 트랜잭션 표시

**유형**: "Revocation"
**아이콘**: 채굴 아이콘

**주소 열**: 플롯 주소
**금액 열**: 트랜잭션 수수료 (음수)
**상태 열**: 확인 수

**세부사항** (클릭 시):
- 트랜잭션 ID
- 플롯 주소
- 취소 높이
- 취소 유효 높이
- 트랜잭션 수수료
- 타임스탬프

### 트랜잭션 필터링

**사용 가능한 필터**:
- "전체" (기본, 할당/취소 포함)
- 날짜 범위
- 금액 범위
- 주소로 검색
- 트랜잭션 ID로 검색
- 라벨로 검색 (주소에 라벨이 있는 경우)

**참고**: 할당/취소 트랜잭션은 현재 "전체" 필터에 표시됩니다. 전용 유형 필터는 아직 구현되지 않았습니다.

### 트랜잭션 정렬

**정렬 순서** (유형별):
- Generated (유형 0)
- Received (유형 1-3)
- Assignment (유형 4)
- Revocation (유형 5)
- Sent (유형 6+)

---

## 주소 요구사항

### P2WPKH (SegWit v0) 전용

**포징 작업에 필요**:
- Bech32 인코딩 주소 (메인넷 "pocx1q", 테스트넷 "tpocx1q", regtest "rpocx1q"로 시작)
- P2WPKH (Pay-to-Witness-Public-Key-Hash) 형식
- 20바이트 키 해시

**지원되지 않음**:
- P2PKH (레거시, "1"로 시작)
- P2SH (래핑된 SegWit, "3"로 시작)
- P2TR (Taproot, "bc1p"로 시작)

**근거**: PoCX 블록 서명은 증명 검증을 위해 특정 witness v0 형식을 요구합니다.

### 주소 드롭다운 필터링

**플롯 주소 콤보박스**:
- 지갑의 수신 주소로 자동 채워짐
- P2WPKH가 아닌 주소 필터링
- 형식 표시: 라벨이 있으면 "라벨 (주소)", 없으면 주소만
- 첫 번째 항목: "-- 사용자 정의 주소 입력 --" (수동 입력용)

**수동 입력**:
- 입력 시 형식 검증
- 유효한 bech32 P2WPKH여야 함
- 잘못된 형식이면 버튼 비활성화

### 검증 오류 메시지

**대화상자 오류**:
- "플롯 주소는 P2WPKH (bech32)여야 합니다"
- "포징 주소는 P2WPKH (bech32)여야 합니다"
- "잘못된 주소 형식"
- "플롯 주소에 코인이 없습니다. 소유권을 증명할 수 없습니다."
- "감시 전용 지갑으로는 트랜잭션을 생성할 수 없습니다"
- "지갑을 사용할 수 없습니다"
- "지갑 잠김" (RPC에서)

---

## 채굴 통합

### 설정 요구사항

**노드 구성**:
```bash
# bitcoin.conf
miningserver=1
server=1
```

**지갑 요구사항**:
- 플롯 소유권용 P2WPKH 주소
- 채굴용 개인키 (또는 할당 사용 시 포징 주소)
- 트랜잭션 생성을 위한 확인된 UTXO

**외부 도구**:
- `pocx_plotter`: 플롯 파일 생성
- `pocx_miner`: 플롯 스캔 및 논스 제출

### 워크플로우

#### 솔로 채굴

1. **플롯 파일 생성**:
   ```bash
   pocx_plotter --account <plot_address_hash160> --seed <32_bytes> --nonces <count>
   ```

2. **채굴 서버로 노드 시작**:
   ```bash
   bitcoin-qt -server -miningserver
   ```

3. **마이너 구성**:
   - 노드 RPC 엔드포인트 지정
   - 플롯 파일 디렉토리 지정
   - 계정 ID 구성 (플롯 주소에서)

4. **채굴 시작**:
   ```bash
   pocx_miner --rpc-url http://localhost:8332 --plots /path/to/plots
   ```

5. **모니터링**:
   - 마이너가 매 블록마다 `get_mining_info` 호출
   - 최적의 데드라인을 위해 플롯 스캔
   - 솔루션 발견 시 `submit_nonce` 호출
   - 노드가 자동으로 블록 검증 및 포징

#### 풀 채굴

1. **플롯 파일 생성** (솔로 채굴과 동일)

2. **포징 할당 생성**:
   - 포징 할당 대화상자 열기
   - 플롯 주소 선택
   - 풀의 포징 주소 입력
   - "할당 전송" 클릭
   - 활성화 지연 대기 (테스트넷 30 블록)

3. **마이너 구성**:
   - **풀** 엔드포인트 지정 (로컬 노드 아님)
   - 풀이 체인에 `submit_nonce` 처리

4. **풀 운영**:
   - 풀 지갑이 포징 주소 개인키 보유
   - 풀이 마이너 제출 검증
   - 풀이 블록체인에 `submit_nonce` 호출
   - 풀이 풀 정책에 따라 보상 분배

### 코인베이스 보상

**할당 없음**:
- 코인베이스가 플롯 소유자 주소에 직접 지급
- 플롯 주소에서 잔액 확인

**할당 있음**:
- 코인베이스가 포징 주소에 지급
- 풀이 보상 수신
- 마이너가 풀에서 지분 수령

**보상 일정**:
- 초기: 블록당 10 BTCX
- 반감: 1050000 블록마다 (~4년)
- 일정: 10 -> 5 -> 2.5 -> 1.25 -> ...

---

## 문제 해결

### 일반적인 문제

#### "지갑에 플롯 주소의 개인키가 없습니다"

**원인**: 지갑이 해당 주소를 소유하지 않음
**해결책**:
- `importprivkey` RPC로 개인키 가져오기
- 또는 지갑이 소유한 다른 플롯 주소 사용

#### "이 플롯에 이미 할당이 존재합니다"

**원인**: 플롯이 이미 다른 주소에 할당됨
**해결책**:
1. 기존 할당 취소
2. 취소 지연 대기 (테스트넷 720 블록)
3. 새 할당 생성

#### "주소 형식이 지원되지 않습니다"

**원인**: 주소가 P2WPKH bech32가 아님
**해결책**:
- "pocx1q" (메인넷) 또는 "tpocx1q" (테스트넷)로 시작하는 주소 사용
- 필요시 새 주소 생성: `getnewaddress "" "bech32"`

#### "트랜잭션 수수료가 너무 낮습니다"

**원인**: 네트워크 멤풀 혼잡 또는 릴레이에 수수료가 너무 낮음
**해결책**:
- 수수료율 매개변수 증가
- 멤풀 정리 대기

#### "할당이 아직 활성화되지 않았습니다"

**원인**: 활성화 지연이 아직 경과하지 않음
**해결책**:
- 상태 확인: 활성화까지 남은 블록
- 지연 기간 완료 대기

#### "플롯 주소에 코인이 없습니다"

**원인**: 플롯 주소에 확인된 UTXO 없음
**해결책**:
1. 플롯 주소에 자금 전송
2. 1 확인 대기
3. 할당 생성 재시도

#### "감시 전용 지갑으로는 트랜잭션을 생성할 수 없습니다"

**원인**: 지갑이 개인키 없이 주소만 가져옴
**해결책**: 주소만이 아닌 전체 개인키 가져오기

#### "포징 할당 탭이 보이지 않습니다"

**원인**: 노드가 `-miningserver` 플래그 없이 시작됨
**해결책**: `bitcoin-qt -server -miningserver`로 재시작

### 디버그 단계

1. **지갑 상태 확인**:
   ```bash
   bitcoin-cli getwalletinfo
   ```

2. **주소 소유권 확인**:
   ```bash
   bitcoin-cli getaddressinfo pocx1qplot...
   # 확인: "iswatchonly": false, "ismine": true
   ```

3. **할당 상태 확인**:
   ```bash
   bitcoin-cli get_assignment pocx1qplot...
   ```

4. **최근 트랜잭션 보기**:
   ```bash
   bitcoin-cli listtransactions "*" 10
   ```

5. **노드 동기화 확인**:
   ```bash
   bitcoin-cli getblockchaininfo
   # 확인: blocks == headers (완전 동기화됨)
   ```

---

## 보안 모범 사례

### 플롯 주소 보안

**키 관리**:
- 플롯 주소 개인키를 안전하게 저장
- 할당 트랜잭션이 서명을 통해 소유권 증명
- 플롯 소유자만 할당 생성/취소 가능

**백업**:
- 지갑 정기 백업 (`dumpwallet` 또는 `backupwallet`)
- wallet.dat를 안전한 장소에 저장
- HD 지갑 사용 시 복구 문구 기록

### 포징 주소 위임

**보안 모델**:
- 포징 주소가 블록 보상 수신
- 포징 주소가 블록 서명 가능 (채굴)
- 포징 주소는 할당 수정이나 취소 **불가**
- 플롯 소유자가 완전한 제어권 유지

**사용 사례**:
- **핫 월렛 위임**: 플롯 키는 콜드 스토리지, 포징 키는 채굴용 핫 월렛
- **풀 채굴**: 풀에 위임, 플롯 소유권 유지
- **공유 인프라**: 여러 마이너, 하나의 포징 주소

### 네트워크 시간 동기화

**중요성**:
- PoCX 합의가 정확한 시간 필요
- 시계 오차 >10초에서 경고 트리거
- 시계 오차 >15초에서 채굴 불가

**해결책**:
- 시스템 시계를 NTP와 동기화 유지
- 모니터링: `bitcoin-cli getnetworkinfo`에서 시간 오프셋 경고
- 신뢰할 수 있는 NTP 서버 사용

### 할당 지연

**활성화 지연** (테스트넷 30 블록):
- 체인 포크 중 빠른 재할당 방지
- 네트워크가 합의에 도달하도록 허용
- 우회 불가

**취소 지연** (테스트넷 720 블록):
- 채굴 풀에 안정성 제공
- 할당 "그리핑" 공격 방지
- 지연 중 포징 주소가 활성 상태 유지

### 지갑 암호화

**암호화 활성화**:
```bash
bitcoin-cli encryptwallet "your_passphrase"
```

**트랜잭션용 잠금 해제**:
```bash
bitcoin-cli walletpassphrase "your_passphrase" 300
```

**모범 사례**:
- 강력한 암호 사용 (20자 이상)
- 암호를 평문으로 저장하지 않음
- 할당 생성 후 지갑 잠금

---

## 코드 참조

**포징 할당 대화상자**: `src/qt/forgingassignmentdialog.cpp`, `src/qt/forgingassignmentdialog.h`
**트랜잭션 표시**: `src/qt/transactionrecord.cpp`, `src/qt/transactiontablemodel.cpp`
**트랜잭션 파싱**: `src/qt/transactionrecord.cpp`
**지갑 통합**: `src/pocx/assignments/transactions.cpp`
**할당 RPC**: `src/pocx/rpc/assignments_wallet.cpp`
**GUI 메인**: `src/qt/bitcoingui.cpp`

---

## 상호 참조

관련 장:
- [3장: 합의 및 채굴](3-consensus-and-mining.md) - 채굴 과정
- [4장: 포징 할당](4-forging-assignments.md) - 할당 아키텍처
- [6장: 네트워크 매개변수](6-network-parameters.md) - 할당 지연 값
- [7장: RPC 참조](7-rpc-reference.md) - RPC 명령어 세부사항

---

[<- 이전: RPC 참조](7-rpc-reference.md) | [목차](index.md)
