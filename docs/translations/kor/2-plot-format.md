[<- 이전: 소개](1-introduction.md) | [목차](index.md) | [다음: 합의 및 채굴 ->](3-consensus-and-mining.md)

---

# 2장: PoCX 플롯 형식 사양

이 문서는 보안 개선, SIMD 최적화 및 확장 가능한 작업 증명을 갖춘 POC2 형식의 향상된 버전인 PoCX 플롯 형식을 설명합니다.

## 형식 개요

PoCX 플롯 파일은 효율적인 채굴 작업을 위해 구성된 사전 계산된 Shabal256 해시 값을 포함합니다. POC1 이후 PoC 전통에 따라, **모든 메타데이터는 파일명에 내장**되어 있으며 파일 헤더가 없습니다.

### 파일 확장자
- **표준**: `.pocx` (완성된 플롯)
- **진행 중**: `.tmp` (플로팅 중, 완료 시 `.pocx`로 이름 변경)

## 역사적 맥락과 취약점 발전

### POC1 형식 (레거시)
**두 가지 주요 취약점 (시간-메모리 트레이드오프):**

1. **PoW 분포 결함**
   - 스쿱 간 작업 증명의 불균일한 분포
   - 낮은 스쿱 번호는 즉석에서 계산 가능
   - **영향**: 공격자의 스토리지 요구사항 감소

2. **XOR 압축 공격** (50% 시간-메모리 트레이드오프)
   - 수학적 속성을 악용하여 50% 스토리지 감소 달성
   - **영향**: 공격자가 필요한 스토리지의 절반으로 채굴 가능

**레이아웃 최적화**: HDD 효율성을 위한 기본 순차 스쿱 레이아웃

### POC2 형식 (Burstcoin)
- PoW 분포 결함 수정
- XOR-전치 취약점은 패치되지 않음
- **레이아웃**: 순차 스쿱 최적화 유지

### PoCX 형식 (현재)
- **PoW 분포 수정** (POC2에서 상속)
- **XOR-전치 취약점 패치** (PoCX 고유)
- **향상된 SIMD/GPU 레이아웃** - 병렬 처리 및 메모리 통합 최적화
- **확장 가능한 작업 증명** - 계산 능력이 증가해도 시간-메모리 트레이드오프 방지 (PoW는 플롯 파일 생성 또는 업그레이드 시에만 수행)

## XOR-전치 인코딩

### 문제: 50% 시간-메모리 트레이드오프

POC1/POC2 형식에서 공격자는 스쿱 간의 수학적 관계를 악용하여 데이터의 절반만 저장하고 나머지는 채굴 중에 즉석에서 계산할 수 있었습니다. 이 "XOR 압축 공격"은 스토리지 보장을 훼손했습니다.

### 해결책: XOR-전치 강화

PoCX는 기본 워프 쌍(X0)에 XOR-전치 인코딩을 적용하여 채굴 형식(X1)을 도출합니다:

**X1 워프에서 논스 N의 스쿱 S를 구성하려면:**
1. 첫 번째 X0 워프에서 논스 N의 스쿱 S 가져오기 (직접 위치)
2. 두 번째 X0 워프에서 논스 S의 스쿱 N 가져오기 (전치된 위치)
3. 두 64바이트 값을 XOR하여 X1 스쿱 획득

전치 단계는 스쿱과 논스 인덱스를 교환합니다. 행렬 용어로 - 행이 스쿱을 나타내고 열이 논스를 나타내는 경우 - 첫 번째 워프의 위치 (S, N) 요소와 두 번째 워프의 (N, S) 요소를 결합합니다.

### 이것이 공격을 제거하는 이유

XOR-전치는 각 스쿱을 기본 X0 데이터의 전체 행과 전체 열과 연결합니다. 단일 X1 스쿱을 복구하려면 4096개의 스쿱 인덱스 전체에 걸친 데이터 접근이 필요합니다. 누락된 데이터를 계산하려는 시도는 단일 논스가 아닌 4096개의 전체 논스를 재생성해야 하므로, XOR 공격이 악용한 비대칭 비용 구조가 제거됩니다.

결과적으로 전체 X1 워프를 저장하는 것이 채굴자에게 계산적으로 유일하게 실행 가능한 전략이 됩니다.

## 파일명 메타데이터 구조

모든 플롯 메타데이터는 다음 정확한 형식을 사용하여 파일명에 인코딩됩니다:

```
{ACCOUNT_PAYLOAD}_{SEED}_{WARPS}_{SCALING}.pocx
```

### 파일명 구성요소

1. **ACCOUNT_PAYLOAD** (40 16진수 문자)
   - 원시 20바이트 계정 페이로드를 대문자 16진수로 표시
   - 네트워크 독립적 (네트워크 ID나 체크섬 없음)
   - 예시: `DEADBEEFCAFEBABE1337C0DEBADC0FFEE15DEAD`

2. **SEED** (64 16진수 문자)
   - 32바이트 시드 값을 소문자 16진수로 표시
   - **PoCX의 새 기능**: 파일명의 랜덤 32바이트 시드가 연속 논스 번호 매기기를 대체 - 플롯 중복 방지
   - 예시: `c0ffeebeefcafebabedeadbeef1337c0de42424242feedfacecafed00dabad1dea`

3. **WARPS** (10진수)
   - **PoCX의 새 크기 단위**: POC1/POC2의 논스 기반 크기 조정을 대체
   - **XOR-전치 저항 설계**: 각 워프 = 정확히 4096 논스 (XOR-전치 저항 변환에 필요한 파티션 크기)
   - **크기**: 1 워프 = 1073741824 바이트 = 1 GiB (편리한 단위)
   - 예시: `1024` (1 TiB 플롯 = 1024 워프)

4. **SCALING** (X 접두사 10진수)
   - 스케일링 레벨을 `X{레벨}`로 표시
   - 높은 값 = 더 많은 작업 증명 필요
   - 예시: `X4` (2^4 = POC2 난이도의 16배)

### 예시 파일명
```
DEADBEEFCAFEBABE1337C0DEBADC0FFEE15DEAD_c0ffeebeefcafebabedeadbeef1337c0de42424242feedfacecafed00dabad1dea_1024_X4.pocx
FEEDFACEDEADC0DE123456789ABCDEF012345678_b00b1e5feedc0debabeface5dea1deadc0de1337c0ffeebabeface5bad1dea5_2048_X1.pocx
```


## 파일 레이아웃 및 데이터 구조

### 계층적 구성
```
플롯 파일 (헤더 없음)
├── 스쿱 0
│   ├── 워프 0 (이 스쿱/워프의 모든 논스)
│   ├── 워프 1
│   └── ...
├── 스쿱 1
│   ├── 워프 0
│   ├── 워프 1
│   └── ...
└── 스쿱 4095
    ├── 워프 0
    └── ...
```

### 상수 및 크기

| 상수           | 크기                    | 설명                                      |
| -------------- | ----------------------- | ----------------------------------------- |
| **HASH\_SIZE** | 32 B                    | 단일 Shabal256 해시 출력                   |
| **SCOOP\_SIZE**| 64 B (2 × HASH\_SIZE)   | 채굴 라운드에서 읽는 해시 쌍               |
| **NUM\_SCOOPS**| 4096 (2^12)             | 논스당 스쿱; 라운드당 하나 선택            |
| **NONCE\_SIZE**| 262144 B (256 KiB)      | 논스의 모든 스쿱 (PoC1/PoC2 최소 단위)     |
| **WARP\_SIZE** | 1073741824 B (1 GiB)    | PoCX의 최소 단위                          |

### SIMD 최적화 플롯 파일 레이아웃

PoCX는 여러 논스의 벡터화 처리를 가능하게 하는 SIMD 인식 논스 접근 패턴을 구현합니다. 메모리 처리량과 SIMD 효율성을 극대화하기 위해 [POC2×16 최적화 연구](https://www.reddit.com/r/burstcoin/comments/a1qyoq/cip_announcement_poc2x16_a_new_optimized_plot/)의 개념을 기반으로 합니다.

---

#### 전통적인 순차 레이아웃

논스의 순차적 저장:

```
[논스 0: 스쿱 데이터] [논스 1: 스쿱 데이터] [논스 2: 스쿱 데이터] ...
```

SIMD 비효율성: 각 SIMD 레인은 논스 간에 동일한 워드가 필요합니다:

```
논스 0의 워드 0 -> 오프셋 0
논스 1의 워드 0 -> 오프셋 512
논스 2의 워드 0 -> 오프셋 1024
...
```

스캐터-개더 접근은 처리량을 감소시킵니다.

---

#### PoCX SIMD 최적화 레이아웃

PoCX는 **16개 논스에 걸친 워드 위치**를 연속적으로 저장합니다:

```
캐시 라인 (64 바이트):

Word0_N0 Word0_N1 Word0_N2 ... Word0_N15
Word1_N0 Word1_N1 Word1_N2 ... Word1_N15
...
```

**ASCII 다이어그램**

```
전통적 레이아웃:

Nonce0: [W0][W1][W2][W3]...
Nonce1: [W0][W1][W2][W3]...
Nonce2: [W0][W1][W2][W3]...

PoCX 레이아웃:

Word0: [N0][N1][N2][N3]...[N15]
Word1: [N0][N1][N2][N3]...[N15]
Word2: [N0][N1][N2][N3]...[N15]
```

---

#### 메모리 접근 이점

- 하나의 캐시 라인이 모든 SIMD 레인에 데이터 공급
- 스캐터-개더 작업 제거
- 캐시 미스 감소
- 벡터화 계산을 위한 완전히 순차적인 메모리 접근
- GPU도 16-논스 정렬로 캐시 효율성 극대화

---

#### SIMD 스케일링

| SIMD       | 벡터 폭*     | 논스 수 | 캐시 라인당 처리 사이클 |
|------------|--------------|---------|------------------------|
| SSE2/AVX   | 128비트      | 4       | 4 사이클               |
| AVX2       | 256비트      | 8       | 2 사이클               |
| AVX512     | 512비트      | 16      | 1 사이클               |

\* 정수 연산 기준

---



## 작업 증명 스케일링

### 스케일링 레벨
- **X0**: XOR-전치 인코딩 없는 기본 논스 (이론적, 채굴에 사용되지 않음)
- **X1**: XOR-전치 기준선 - 첫 번째 강화 형식 (1× 작업)
- **X2**: 2× X1 작업 (2 워프에 걸친 XOR)
- **X3**: 4× X1 작업 (4 워프에 걸친 XOR)
- **...**
- **Xn**: 2^(n-1) × X1 작업 내장

### 이점
- **조정 가능한 PoW 난이도**: 더 빠른 하드웨어에 맞추어 계산 요구사항 증가
- **형식 수명**: 시간 경과에 따른 채굴 난이도의 유연한 스케일링 가능

### 플롯 업그레이드 / 역호환성

네트워크가 PoW(작업 증명) 스케일을 1 증가시키면, 기존 플롯은 동일한 유효 플롯 크기를 유지하기 위해 업그레이드가 필요합니다. 본질적으로, 계정에 동일한 기여를 하려면 플롯 파일에 두 배의 PoW가 필요합니다.

좋은 소식은 플롯 파일을 생성할 때 이미 완료한 PoW가 손실되지 않는다는 것입니다. 기존 파일에 추가 PoW만 추가하면 됩니다. 재플로팅이 필요 없습니다.

또는 업그레이드 없이 현재 플롯을 계속 사용할 수 있지만, 이전 유효 크기의 50%만 계정에 기여한다는 점에 유의하세요. 채굴 소프트웨어가 플롯 파일을 즉석에서 스케일링할 수 있습니다.

## 레거시 형식과의 비교

| 기능 | POC1 | POC2 | PoCX |
|------|------|------|------|
| PoW 분포 | 결함 | 수정 | 수정 |
| XOR-전치 저항 | 취약 | 취약 | 수정 |
| SIMD 최적화 | 없음 | 없음 | 고급 |
| GPU 최적화 | 없음 | 없음 | 최적화 |
| 확장 가능한 작업 증명 | 없음 | 없음 | 있음 |
| 시드 지원 | 없음 | 없음 | 있음 |

PoCX 형식은 알려진 모든 취약점을 해결하면서 현대 하드웨어에 대한 상당한 성능 향상을 제공하는 용량 증명 플롯 형식의 최신 기술을 대표합니다.

## 참조 및 추가 자료

- **POC1/POC2 배경**: [Burstcoin 채굴 개요](https://www.burstcoin.community/burstcoin-mining/) - 전통적인 용량 증명 채굴 형식에 대한 종합 가이드
- **POC2×16 연구**: [CIP 발표: POC2×16 - 새로운 최적화 플롯 형식](https://www.reddit.com/r/burstcoin/comments/a1qyoq/cip_announcement_poc2x16_a_new_optimized_plot/) - PoCX에 영감을 준 원본 SIMD 최적화 연구
- **Shabal 해시 알고리즘**: [Saphir 프로젝트: NIST 암호화 해시 알고리즘 경쟁 제출물 Shabal](https://www.cs.rit.edu/~ark/20090927/Round2Candidates/Shabal.pdf) - PoC 채굴에 사용되는 Shabal256 알고리즘의 기술 사양

---

[<- 이전: 소개](1-introduction.md) | [목차](index.md) | [다음: 합의 및 채굴 ->](3-consensus-and-mining.md)
