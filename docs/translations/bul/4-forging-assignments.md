[‚Üê –ù–∞–∑–∞–¥: –ö–æ–Ω—Å–µ–Ω—Å—É—Å –∏ –∫–æ–ø–∞–µ–Ω–µ](3-consensus-and-mining.md) | [üìò –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ](index.md) | [–ù–∞–ø—Ä–µ–¥: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –≤—Ä–µ–º–µ ‚Üí](5-timing-security.md)

---

# –ì–ª–∞–≤–∞ 4: –°–∏—Å—Ç–µ–º–∞ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ –≤ PoCX

## –†–µ–∑—é–º–µ

–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å–≤–∞ **–∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞—Ç–∞** —Å–∏—Å—Ç–µ–º–∞ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ –≤ PoCX, –∏–∑–ø–æ–ª–∑–≤–∞—â–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∞–º–æ —Å OP_RETURN. –°–∏—Å—Ç–µ–º–∞—Ç–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏—Ü–∏—Ç–µ –Ω–∞ plot —Ñ–∞–π–ª–æ–≤–µ –¥–∞ –¥–µ–ª–µ–≥–∏—Ä–∞—Ç –ø—Ä–∞–≤–∞ –∑–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ –æ—Ç–¥–µ–ª–Ω–∏ –∞–¥—Ä–µ—Å–∏ —á—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ä–≤ –≤–µ—Ä–∏–≥–∞—Ç–∞, —Å –ø—ä–ª–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç –ø—Ä–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –∞—Ç–æ–º–∞—Ä–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–∞ –¥–∞–Ω–Ω–∏.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–∞–ø—ä–ª–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–∞—â–∞

## –û—Å–Ω–æ–≤–Ω–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞ –¥–∏–∑–∞–π–Ω–∞

**–ö–ª—é—á–æ–≤ –ø—Ä–∏–Ω—Ü–∏–ø:** –î–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è—Ç–∞ —Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –Ω–µ –∞–∫—Ç–∏–≤–∏

- –ë–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ UTXO –∑–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –∏–ª–∏ —Ö–∞—Ä—á–µ–Ω–µ
- –°—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –æ—Ç–¥–µ–ª–Ω–æ –æ—Ç UTXO —Å–µ—Ç–∞
- –°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç—Ç–∞ —Å–µ –¥–æ–∫–∞–∑–≤–∞ —Å –ø–æ–¥–ø–∏—Å –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –Ω–µ —Å —Ö–∞—Ä—á–µ–Ω–µ –Ω–∞ UTXO
- –ü—ä–ª–Ω–æ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞ –∑–∞ –ø—ä–ª–Ω–∞ –æ–¥–∏—Ç–Ω–∞ —Å–ª–µ–¥–∞
- –ê—Ç–æ–º–∞—Ä–Ω–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ —á—Ä–µ–∑ LevelDB batch –∑–∞–ø–∏—Å–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –§–æ—Ä–º–∞—Ç –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ

```
Inputs:
  [0]: –í—Å—è–∫–æ UTXO, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞–Ω–æ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot (–¥–æ–∫–∞–∑–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç + –ø–ª–∞—â–∞ —Ç–∞–∫—Å–∏)
       –¢—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ —Å —á–∞—Å—Ç–Ω–∏—è –∫–ª—é—á –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
  [1+]: –ù–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –≤—Ö–æ–¥–æ–≤–µ –∑–∞ –ø–æ–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ç–∞–∫—Å–∏

Outputs:
  [0]: OP_RETURN (POCX –º–∞—Ä–∫–µ—Ä + –∞–¥—Ä–µ—Å –Ω–∞ plot + –∞–¥—Ä–µ—Å –∑–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ)
       –§–æ—Ä–º–∞—Ç: OP_RETURN <0x2c> "POCX" <plot_addr_20> <forge_addr_20>
       –†–∞–∑–º–µ—Ä: 46 –±–∞–π—Ç–∞ –æ–±—â–æ (1 –±–∞–π—Ç OP_RETURN + 1 –±–∞–π—Ç –¥—ä–ª–∂–∏–Ω–∞ + 44 –±–∞–π—Ç–∞ –¥–∞–Ω–Ω–∏)
       –°—Ç–æ–π–Ω–æ—Å—Ç: 0 BTC (–Ω–µ—Ö–∞—Ä—á–∏–º–∏, –Ω–µ —Å–µ –¥–æ–±–∞–≤—è—Ç –∫—ä–º UTXO —Å–µ—Ç–∞)

  [1]: –†–µ—Å—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ –∫—ä–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω P2WPKH)
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/assignments/opcodes.cpp:25-52`

### –§–æ—Ä–º–∞—Ç –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞ –æ—Ç–º—è–Ω–∞

```
Inputs:
  [0]: –í—Å—è–∫–æ UTXO, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–∞–Ω–æ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot (–¥–æ–∫–∞–∑–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç + –ø–ª–∞—â–∞ —Ç–∞–∫—Å–∏)
       –¢—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ —Å —á–∞—Å—Ç–Ω–∏—è –∫–ª—é—á –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
  [1+]: –ù–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –≤—Ö–æ–¥–æ–≤–µ –∑–∞ –ø–æ–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ç–∞–∫—Å–∏

Outputs:
  [0]: OP_RETURN (XCOP –º–∞—Ä–∫–µ—Ä + –∞–¥—Ä–µ—Å –Ω–∞ plot)
       –§–æ—Ä–º–∞—Ç: OP_RETURN <0x18> "XCOP" <plot_addr_20>
       –†–∞–∑–º–µ—Ä: 26 –±–∞–π—Ç–∞ –æ–±—â–æ (1 –±–∞–π—Ç OP_RETURN + 1 –±–∞–π—Ç –¥—ä–ª–∂–∏–Ω–∞ + 24 –±–∞–π—Ç–∞ –¥–∞–Ω–Ω–∏)
       –°—Ç–æ–π–Ω–æ—Å—Ç: 0 BTC (–Ω–µ—Ö–∞—Ä—á–∏–º–∏, –Ω–µ —Å–µ –¥–æ–±–∞–≤—è—Ç –∫—ä–º UTXO —Å–µ—Ç–∞)

  [1]: –†–µ—Å—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ –∫—ä–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω P2WPKH)
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/assignments/opcodes.cpp:54-77`

### –ú–∞—Ä–∫–µ—Ä–∏

- **–ú–∞—Ä–∫–µ—Ä –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** `POCX` (0x50, 0x4F, 0x43, 0x58) = "Proof of Capacity neXt"
- **–ú–∞—Ä–∫–µ—Ä –∑–∞ –æ—Ç–º—è–Ω–∞:** `XCOP` (0x58, 0x43, 0x4F, 0x50) = "eXit Capacity OPeration"

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/assignments/opcodes.cpp:15-19`

### –ö–ª—é—á–æ–≤–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏ Bitcoin —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–µ–∑ –ø—Ä–æ–º–µ–Ω–∏ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞)
- OP_RETURN –∏–∑—Ö–æ–¥–∏—Ç–µ —Å–∞ –¥–æ–∫–∞–∑—É–µ–º–æ –Ω–µ—Ö–∞—Ä—á–∏–º–∏ (–Ω–∏–∫–æ–≥–∞ –Ω–µ —Å–µ –¥–æ–±–∞–≤—è—Ç –∫—ä–º UTXO —Å–µ—Ç–∞)
- –°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç—Ç–∞ –≤—ä—Ä—Ö—É plot —Å–µ –¥–æ–∫–∞–∑–≤–∞ —Å –ø–æ–¥–ø–∏—Å –Ω–∞ input[0] –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot
- –ù–∏—Å–∫–∞ —Ü–µ–Ω–∞ (~200 –±–∞–π—Ç–∞, –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ <0.0001 BTC —Ç–∞–∫—Å–∞)
- –ü–æ—Ä—Ç—Ñ–µ–π–ª—ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞ –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ UTXO –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot –∑–∞ –¥–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ

–í—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –≤ —Å—ä—â–∞—Ç–∞ LevelDB –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ –∫–∞—Ç–æ UTXO —Å–µ—Ç–∞ (`chainstate/`), –Ω–æ —Å –æ—Ç–¥–µ–ª–Ω–∏ –∫–ª—é—á–æ–≤–∏ –ø—Ä–µ—Ñ–∏–∫—Å–∏:

```
chainstate/ LevelDB:
‚îú‚îÄ UTXO Set (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω Bitcoin Core)
‚îÇ  ‚îî‚îÄ 'C' –ø—Ä–µ—Ñ–∏–∫—Å: COutPoint ‚Üí Coin
‚îÇ
‚îî‚îÄ Assignment State (PoCX –¥–æ–±–∞–≤–∫–∏)
   ‚îî‚îÄ 'A' –ø—Ä–µ—Ñ–∏–∫—Å: (plot_address, assignment_txid) ‚Üí ForgingAssignment
       ‚îî‚îÄ –ü—ä–ª–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è: –≤—Å–∏—á–∫–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –∑–∞ plot –≤—ä–≤ –≤—Ä–µ–º–µ—Ç–æ
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/txdb.cpp:237-348`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment

```cpp
struct ForgingAssignment {
    // –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç
    std::array<uint8_t, 20> plotAddress;      // –°–æ–±—Å—Ç–≤–µ–Ω–∏–∫ –Ω–∞ plot (20-–±–∞–π—Ç–æ–≤ P2WPKH —Ö–µ—à)
    std::array<uint8_t, 20> forgingAddress;   // –ü—Ä–∏—Ç–µ–∂–∞—Ç–µ–ª –Ω–∞ –ø—Ä–∞–≤–∞ –∑–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ (20-–±–∞–π—Ç–æ–≤ P2WPKH —Ö–µ—à)

    // –ñ–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
    uint256 assignment_txid;                   // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, —Å—ä–∑–¥–∞–ª–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ—Ç–æ
    int assignment_height;                     // –í–∏—Å–æ—á–∏–Ω–∞ –Ω–∞ –±–ª–æ–∫ –ø—Ä–∏ —Å—ä–∑–¥–∞–≤–∞–Ω–µ
    int assignment_effective_height;           // –ö–æ–≥–∞ —Å—Ç–∞–≤–∞ –∞–∫—Ç–∏–≤–Ω–æ (height + –∑–∞–±–∞–≤—è–Ω–µ)

    // –ñ–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –Ω–∞ –æ—Ç–º—è–Ω–∞
    bool revoked;                              // –û—Ç–º–µ–Ω–µ–Ω–æ –ª–∏ –µ —Ç–æ–≤–∞?
    uint256 revocation_txid;                   // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –æ—Ç–º–µ–Ω–∏–ª–∞ –≥–æ
    int revocation_height;                     // –í–∏—Å–æ—á–∏–Ω–∞ –Ω–∞ –±–ª–æ–∫ –ø—Ä–∏ –æ—Ç–º—è–Ω–∞
    int revocation_effective_height;           // –ö–æ–≥–∞ –æ—Ç–º—è–Ω–∞—Ç–∞ –≤–ª–∏–∑–∞ –≤ —Å–∏–ª–∞ (height + –∑–∞–±–∞–≤—è–Ω–µ)

    // –ú–µ—Ç–æ–¥–∏ –∑–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
    ForgingState GetStateAtHeight(int height) const;
    bool IsActiveAtHeight(int height) const;
};
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/coins.h:111-178`

### –°—ä—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ

```cpp
enum class ForgingState : uint8_t {
    UNASSIGNED = 0,  // –ù–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
    ASSIGNING = 1,   // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ —Å—ä–∑–¥–∞–¥–µ–Ω–æ, –∏–∑—á–∞–∫–≤–∞ –∑–∞–±–∞–≤—è–Ω–µ –∑–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ
    ASSIGNED = 2,    // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
    REVOKING = 3,    // –û—Ç–º–µ–Ω–µ–Ω–æ, –Ω–æ –≤—Å–µ –æ—â–µ –∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–µ–∑ –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –∑–∞–±–∞–≤—è–Ω–µ
    REVOKED = 4      // –ù–∞–ø—ä–ª–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–æ, –≤–µ—á–µ –Ω–µ –µ –∞–∫—Ç–∏–≤–Ω–æ
};
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/coins.h:98-104`

### –ö–ª—é—á–æ–≤–µ –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

```cpp
// –ö–ª—é—á –∑–∞ –∏—Å—Ç–æ—Ä–∏—è: —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –ø—ä–ª–µ–Ω –∑–∞–ø–∏—Å –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
// –§–æ—Ä–º–∞—Ç –Ω–∞ –∫–ª—é—á: (prefix, plotAddress, assignment_height, assignment_txid)
struct AssignmentHistoryKey {
    uint8_t prefix;                       // DB_ASSIGNMENT_HISTORY = 'A'
    std::array<uint8_t, 20> plotAddress;  // –ê–¥—Ä–µ—Å –Ω–∞ plot (20 –±–∞–π—Ç–∞)
    int assignment_height;                // –í–∏—Å–æ—á–∏–Ω–∞ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ
    uint256 assignment_txid;              // ID –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
};
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/txdb.cpp:245-262`

### –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è

- –í—Å—è–∫–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (–Ω–∏–∫–æ–≥–∞ –Ω–µ —Å–µ –∏–∑—Ç—Ä–∏–≤–∞ –æ—Å–≤–µ–Ω –ø—Ä–∏ —Ä–µ–æ—Ä–≥)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –∑–∞ plot —Å–µ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞—Ç –≤—ä–≤ –≤—Ä–µ–º–µ—Ç–æ
- –ü–æ–∑–≤–æ–ª—è–≤–∞ –ø—ä–ª–Ω–∞ –æ–¥–∏—Ç–Ω–∞ —Å–ª–µ–¥–∞ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
- –û—Ç–º–µ–Ω–µ–Ω–∏—Ç–µ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –æ—Å—Ç–∞–≤–∞—Ç –≤ –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏ —Å `revoked=true`

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –±–ª–æ–∫–æ–≤–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ConnectBlock

OP_RETURN –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∏ –æ—Ç–º—è–Ω–∞ —Å–µ –æ–±—Ä–∞–±–æ—Ç–≤–∞—Ç –ø–æ –≤—Ä–µ–º–µ –Ω–∞ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ –Ω–∞ –±–ª–æ–∫ –≤ `validation.cpp`:

```cpp
// –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –°–ª–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–∫—Ä–∏–ø—Ç, –ø—Ä–µ–¥–∏ UpdateCoins
#ifdef ENABLE_POCX
for (const auto& tx : block.vtx) {
    for (const CTxOut& output : tx.vout) {
        if (IsAssignmentOpReturn(output)) {
            // –ü–∞—Ä—Å–≤–∞–Ω–µ –Ω–∞ OP_RETURN –¥–∞–Ω–Ω–∏
            auto [plot_addr, forge_addr] = ParseAssignmentOpReturn(output);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç (tx —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫ –Ω–∞ plot)
            if (!VerifyPlotOwnership(tx, plot_addr, view))
                return state.Invalid("bad-assignment-ownership");

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ plot (—Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ UNASSIGNED –∏–ª–∏ REVOKED)
            ForgingState state = GetPlotForgingState(plot_addr, height, view);
            if (state != UNASSIGNED && state != REVOKED)
                return state.Invalid("plot-not-available-for-assignment");

            // –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –Ω–æ–≤–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
            int activation_height = height + consensus.nForgingAssignmentDelay;
            ForgingAssignment assignment(plot_addr, forge_addr, tx.GetHash(),
                                       height, activation_height);

            view.AddForgingAssignment(assignment);

            // –°—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ undo –¥–∞–Ω–Ω–∏
            blockundo.vforgingundo.emplace_back(UndoType::ADDED, assignment);
        }
        else if (IsRevocationOpReturn(output)) {
            // –ü–∞—Ä—Å–≤–∞–Ω–µ –Ω–∞ OP_RETURN –¥–∞–Ω–Ω–∏
            auto plot_addr = ParseRevocationOpReturn(output);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
            if (!VerifyPlotOwnership(tx, plot_addr, view))
                return state.Invalid("bad-revocation-ownership");

            // –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
            auto existing = view.GetForgingAssignment(plot_addr, height);
            if (!existing || existing->revoked)
                return state.Invalid("no-assignment-to-revoke");

            // –°—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ä–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –∑–∞ undo
            blockundo.vforgingundo.emplace_back(UndoType::REVOKED, *existing);

            // –ú–∞—Ä–∫–∏—Ä–∞–Ω–µ –∫–∞—Ç–æ –æ—Ç–º–µ–Ω–µ–Ω–æ
            ForgingAssignment revoked = *existing;
            revoked.revoked = true;
            revoked.revocation_txid = tx.GetHash();
            revoked.revocation_height = height;
            revoked.revocation_effective_height = height + consensus.nForgingRevocationDelay;

            view.UpdateForgingAssignment(revoked);
        }
    }
}
#endif

// UpdateCoins –ø—Ä–æ–¥—ä–ª–∂–∞–≤–∞ –Ω–æ—Ä–º–∞–ª–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞ OP_RETURN –∏–∑—Ö–æ–¥–∏)
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/validation.cpp:2775-2878`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç

```cpp
bool VerifyPlotOwnership(const CTransaction& tx,
                        const std::array<uint8_t, 20>& plotAddress,
                        const CCoinsViewCache& view)
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –ø–æ–Ω–µ –µ–¥–∏–Ω –≤—Ö–æ–¥ –µ –ø–æ–¥–ø–∏—Å–∞–Ω –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
    for (const auto& input : tx.vin) {
        Coin coin = view.GetCoin(input.prevout);
        if (!coin) continue;

        // –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –¥–µ—Å—Ç–∏–Ω–∞—Ü–∏—è
        CTxDestination dest;
        if (!ExtractDestination(coin.out.scriptPubKey, dest)) continue;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –µ P2WPKH –∫—ä–º –∞–¥—Ä–µ—Å –Ω–∞ plot
        if (auto* witness_addr = std::get_if<WitnessV0KeyHash>(&dest)) {
            if (std::equal(witness_addr->begin(), witness_addr->end(),
                          plotAddress.begin())) {
                // Bitcoin Core –≤–µ—á–µ –µ –≤–∞–ª–∏–¥–∏—Ä–∞–ª –ø–æ–¥–ø–∏—Å–∞
                return true;
            }
        }
    }
    return false;
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/assignments/opcodes.cpp:217-256`

### –ó–∞–±–∞–≤—è–Ω–∏—è –Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ

–î–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è—Ç–∞ –∏ –æ—Ç–º—è–Ω–∏—Ç–µ –∏–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∏ –∑–∞–±–∞–≤—è–Ω–∏—è –∑–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –∑–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞–Ω–µ –Ω–∞ –∞—Ç–∞–∫–∏ –ø—Ä–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:

```cpp
// –ö–æ–Ω—Å–µ–Ω—Å—É—Å–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∏ –∑–∞ –º—Ä–µ–∂–∞)
// –ü—Ä–∏–º–µ—Ä: 30 –±–ª–æ–∫–∞ = ~1 —á–∞—Å —Å 2-–º–∏–Ω—É—Ç–Ω–æ –≤—Ä–µ–º–µ –Ω–∞ –±–ª–æ–∫
consensus.nForgingAssignmentDelay;   // –ó–∞–±–∞–≤—è–Ω–µ –Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
consensus.nForgingRevocationDelay;   // –ó–∞–±–∞–≤—è–Ω–µ –Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç–º—è–Ω–∞
```

**–ü—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ:**
- –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ: `UNASSIGNED ‚Üí ASSIGNING (–∑–∞–±–∞–≤—è–Ω–µ) ‚Üí ASSIGNED`
- –û—Ç–º—è–Ω–∞: `ASSIGNED ‚Üí REVOKING (–∑–∞–±–∞–≤—è–Ω–µ) ‚Üí REVOKED`

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/consensus/params.h`, `src/kernel/chainparams.cpp`

## –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ Mempool

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏—Ç–µ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∏ –æ—Ç–º—è–Ω–∞ —Å–µ –≤–∞–ª–∏–¥–∏—Ä–∞—Ç –ø—Ä–∏ –ø—Ä–∏–µ–º–∞–Ω–µ –≤ mempool, –∑–∞ –¥–∞ —Å–µ –æ—Ç—Ö–≤—ä—Ä–ª—è—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–µ–¥–∏ –º—Ä–µ–∂–æ–≤–æ —Ä–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ.

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∏–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (CheckTransaction)

–ò–∑–≤—ä—Ä—à–≤–∞—Ç —Å–µ –≤ `src/consensus/tx_check.cpp` –±–µ–∑ –¥–æ—Å—Ç—ä–ø –¥–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –≤–µ—Ä–∏–≥–∞—Ç–∞:

1. **–ú–∞–∫—Å–∏–º—É–º –µ–¥–∏–Ω POCX OP_RETURN:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ –Ω–µ –º–æ–∂–µ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ POCX/XCOP –º–∞—Ä–∫–µ—Ä–∏

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/consensus/tx_check.cpp:63-77`

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –ø—Ä–∏–µ–º–∞–Ω–µ –≤ Mempool (PreChecks)

–ò–∑–≤—ä—Ä—à–≤–∞—Ç —Å–µ –≤ `src/validation.cpp` —Å –ø—ä–ª–µ–Ω –¥–æ—Å—Ç—ä–ø –¥–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –≤–µ—Ä–∏–≥–∞—Ç–∞ –∏ mempool:

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ

1. **–°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç –Ω–∞ plot:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
2. **–°—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ plot:** Plot —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ UNASSIGNED (0) –∏–ª–∏ REVOKED (4)
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç–∏ –≤ mempool:** –ù—è–º–∞ –¥—Ä—É–≥–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∑–∞ —Ç–æ–∑–∏ plot –≤ mempool (–ø—ä—Ä–≤–æ—Ç–æ –ø–µ—á–µ–ª–∏)

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –æ—Ç–º—è–Ω–∞

1. **–°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç –Ω–∞ plot:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
2. **–ê–∫—Ç–∏–≤–Ω–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** Plot —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –≤ —Å—ä—Å—Ç–æ—è–Ω–∏–µ ASSIGNED (2) —Å–∞–º–æ
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç–∏ –≤ mempool:** –ù—è–º–∞ –¥—Ä—É–≥–∞ –æ—Ç–º—è–Ω–∞ –∑–∞ —Ç–æ–∑–∏ plot –≤ mempool

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/validation.cpp:898-993`

### –ü–æ—Ç–æ–∫ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è

```
–†–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
       ‚Üì
CheckTransaction() [tx_check.cpp]
  ‚úì –ú–∞–∫—Å–∏–º—É–º –µ–¥–∏–Ω POCX OP_RETURN
       ‚Üì
MemPoolAccept::PreChecks() [validation.cpp]
  ‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç –Ω–∞ plot
  ‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
  ‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∏ –≤ mempool
       ‚Üì
   –í–∞–ª–∏–¥–Ω–∞ ‚Üí –ü—Ä–∏–µ–º–∞–Ω–µ –≤ Mempool
   –ù–µ–≤–∞–ª–∏–¥–Ω–∞ ‚Üí –û—Ç—Ö–≤—ä—Ä–ª—è–Ω–µ (–±–µ–∑ —Ä–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)
       ‚Üì
–ö–æ–ø–∞–µ–Ω–µ –Ω–∞ –±–ª–æ–∫
       ‚Üì
ConnectBlock() [validation.cpp]
  ‚úì –ü–æ–≤—Ç–æ—Ä–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∑–∞—â–∏—Ç–∞ –≤ –¥—ä–ª–±–æ—á–∏–Ω–∞)
  ‚úì –ü—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ
  ‚úì –ó–∞–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ undo –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### –ó–∞—â–∏—Ç–∞ –≤ –¥—ä–ª–±–æ—á–∏–Ω–∞

–í—Å–∏—á–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ mempool —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ `ConnectBlock()` –∑–∞ –∑–∞—â–∏—Ç–∞ —Å—Ä–µ—â—É:
- –ê—Ç–∞–∫–∏ –∑–∞ –∑–∞–æ–±–∏–∫–∞–ª—è–Ω–µ –Ω–∞ mempool
- –ù–µ–≤–∞–ª–∏–¥–Ω–∏ –±–ª–æ–∫–æ–≤–µ –æ—Ç –∑–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–∏ –º–∏–Ω—å–æ—Ä–∏
- –ì—Ä–∞–Ω–∏—á–Ω–∏ —Å–ª—É—á–∞–∏ –ø—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è

–í–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞ –Ω–∞ –±–ª–æ–∫ –æ—Å—Ç–∞–≤–∞ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–∞ –∑–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞.

## –ê—Ç–æ–º–∞—Ä–Ω–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

### –¢—Ä–∏—Å–ª–æ–π–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CCoinsViewCache (–ö–µ—à –≤ –ø–∞–º–µ—Ç—Ç–∞)       ‚îÇ  ‚Üê –ü—Ä–æ–º–µ–Ω–∏ –≤ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è —Å–µ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞—Ç –≤ –ø–∞–º–µ—Ç
‚îÇ   - Coins: cacheCoins                   ‚îÇ
‚îÇ   - Assignments: pendingAssignments     ‚îÇ
‚îÇ   - Dirty tracking: dirtyPlots          ‚îÇ
‚îÇ   - Deletions: deletedAssignments       ‚îÇ
‚îÇ   - Memory tracking: cachedAssignmentsUsage ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì Flush()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CCoinsViewDB (–°–ª–æ–π –∑–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏)     ‚îÇ  ‚Üê –ï–¥–∏–Ω–∏—á–µ–Ω –∞—Ç–æ–º–∞—Ä–µ–Ω –∑–∞–ø–∏—Å
‚îÇ   - BatchWrite(): UTXOs + Assignments   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì WriteBatch()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LevelDB (–°—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫)          ‚îÇ  ‚Üê ACID –≥–∞—Ä–∞–Ω—Ü–∏–∏
‚îÇ   - –ê—Ç–æ–º–∞—Ä–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ—Ü–µ—Å –Ω–∞ Flush

–ö–æ–≥–∞—Ç–æ —Å–µ –∏–∑–≤–∏–∫–∞ `view.Flush()` –ø–æ –≤—Ä–µ–º–µ –Ω–∞ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ –Ω–∞ –±–ª–æ–∫:

```cpp
bool CCoinsViewCache::Flush() {
    // 1. –ó–∞–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ coins –∫—ä–º –±–∞–∑–∞—Ç–∞
    auto cursor = CoinsViewCacheCursor(/*...*/, /*will_erase=*/true);
    bool fOk = base->BatchWrite(cursor, hashBlock);

    // 2. –ê—Ç–æ–º–∞—Ä–µ–Ω –∑–∞–ø–∏—Å –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è
    if (fOk && !dirtyPlots.empty()) {
        // –°—ä–±–∏—Ä–∞–Ω–µ –Ω–∞ dirty –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è
        ForgingAssignmentsMap assignmentsToWrite;
        PlotAddressAssignmentMap currentToWrite;  // –ü—Ä–∞–∑–µ–Ω - –Ω–µ–∏–∑–ø–æ–ª–∑–≤–∞–Ω

        for (const auto& plotAddr : dirtyPlots) {
            auto it = pendingAssignments.find(plotAddr);
            if (it != pendingAssignments.end()) {
                for (const auto& assignment : it->second) {
                    assignmentsToWrite[{plotAddr, assignment}] = assignment;
                }
            }
        }

        // –ó–∞–ø–∏—Å –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
        fOk = base->BatchWriteAssignments(assignmentsToWrite, currentToWrite,
                                         deletedAssignments);

        if (fOk) {
            // –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ
            dirtyPlots.clear();
            deletedAssignments.clear();
        }
    }

    if (fOk) {
        cacheCoins.clear();  // –û—Å–≤–æ–±–æ–∂–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–∞–º–µ—Ç
        pendingAssignments.clear();
        cachedAssignmentsUsage = 0;
    }

    return fOk;
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/coins.cpp:278-315`

### Batch –∑–∞–ø–∏—Å –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

```cpp
bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) {
    CDBBatch batch(*m_db);  // –ï–¥–∏–Ω–∏—á–µ–Ω LevelDB batch

    // 1. –ú–∞—Ä–∫–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–µ—Ö–æ–¥–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
    batch.Write(DB_HEAD_BLOCKS, Vector(hashBlock, old_tip));

    // 2. –ó–∞–ø–∏—Å –Ω–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏ –≤ coins
    for (auto it = cursor.Begin(); it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {
        if (it->second.coin.IsSpent())
            batch.Erase(CoinKey(it->first));
        else
            batch.Write(CoinKey(it->first), it->second.coin);
    }

    // 3. –ú–∞—Ä–∫–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
    batch.Write(DB_BEST_BLOCK, hashBlock);

    // 4. –ê–¢–û–ú–ê–†–ï–ù COMMIT
    bool ret = m_db->WriteBatch(batch);

    return ret;
}

// –î–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è—Ç–∞ —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç –æ—Ç–¥–µ–ª–Ω–æ, –Ω–æ –≤ —Å—ä—â–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
bool CCoinsViewDB::BatchWriteAssignments(
    const ForgingAssignmentsMap& assignments,
    const PlotAddressAssignmentMap& currentAssignments,  // –ù–µ–∏–∑–ø–æ–ª–∑–≤–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—ä—Ä (–∑–∞–ø–∞–∑–µ–Ω –∑–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç –Ω–∞ API)
    const DeletedAssignmentsSet& deletedAssignments)
{
    CDBBatch batch(*m_db);  // –ù–æ–≤ batch, –Ω–æ —Å—ä—â–∞—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

    // –ó–∞–ø–∏—Å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è
    for (const auto& [key, assignment] : assignments) {
        const auto& [plot_addr, txid] = key;
        batch.Write(AssignmentHistoryKey(plot_addr, txid), assignment);
    }

    // –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∏–∑—Ç—Ä–∏—Ç–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –æ—Ç –∏—Å—Ç–æ—Ä–∏—è—Ç–∞
    for (const auto& [plot_addr, txid] : deletedAssignments) {
        batch.Erase(AssignmentHistoryKey(plot_addr, txid));
    }

    // –ê–¢–û–ú–ê–†–ï–ù COMMIT
    return m_db->WriteBatch(batch);
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/txdb.cpp:332-348`

### –ì–∞—Ä–∞–Ω—Ü–∏–∏ –∑–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç

‚úÖ **–ö–∞–∫–≤–æ –µ –∞—Ç–æ–º–∞—Ä–Ω–æ:**
- –í—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏ –≤ coins –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –±–ª–æ–∫ —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ
- –í—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏ –≤ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –±–ª–æ–∫ —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ
- –ë–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏ –æ—Å—Ç–∞–≤–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –ø—Ä–∏ —Å—Ä–∏–≤–æ–≤–µ

‚ö†Ô∏è **–¢–µ–∫—É—â–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
- Coins –∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç –≤ **–æ—Ç–¥–µ–ª–Ω–∏** LevelDB batch –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ò –¥–≤–µ—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–µ —Å–ª—É—á–≤–∞—Ç –ø–æ –≤—Ä–µ–º–µ –Ω–∞ `view.Flush()`, –Ω–æ –Ω–µ –≤ –µ–¥–∏–Ω–∏—á–µ–Ω –∞—Ç–æ–º–∞—Ä–µ–Ω –∑–∞–ø–∏—Å
- –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞: –ò –¥–≤–∞—Ç–∞ batch-–∞ –∑–∞–≤—ä—Ä—à–≤–∞—Ç –±—ä—Ä–∑–æ –ø—Ä–µ–¥–∏ disk fsync
- –†–∏—Å–∫—ä—Ç –µ –º–∏–Ω–∏–º–∞–ª–µ–Ω: –ò –¥–≤–∞—Ç–∞ –±–∏—Ö–∞ —Ç—Ä—è–±–≤–∞–ª–æ –¥–∞ —Å–µ –ø—Ä–µ–∏–≥—Ä–∞—è—Ç –æ—Ç —Å—ä—â–∏—è –±–ª–æ–∫ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –æ—Ç —Å—Ä–∏–≤

**–ó–∞–±–µ–ª–µ–∂–∫–∞:** –¢–æ–≤–∞ —Å–µ —Ä–∞–∑–ª–∏—á–∞–≤–∞ –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ–Ω –ø–ª–∞–Ω, –∫–æ–π—Ç–æ –ø—Ä–µ–¥–≤–∏–∂–¥–∞—à–µ –µ–¥–∏–Ω–∏—á–µ–Ω —É–Ω–∏—Ñ–∏—Ü–∏—Ä–∞–Ω batch. –¢–µ–∫—É—â–∞—Ç–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–ø–æ–ª–∑–≤–∞ –¥–≤–∞ batch-–∞, –Ω–æ –ø–æ–¥–¥—ä—Ä–∂–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç —á—Ä–µ–∑ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º–∏ –∑–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –æ—Ç —Å—Ä–∏–≤ –Ω–∞ Bitcoin Core (DB_HEAD_BLOCKS –º–∞—Ä–∫–µ—Ä).

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ Undo –¥–∞–Ω–Ω–∏

```cpp
struct ForgingUndo {
    enum class UndoType : uint8_t {
        ADDED = 0,      // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –¥–æ–±–∞–≤–µ–Ω–æ (–∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –ø—Ä–∏ undo)
        MODIFIED = 1,   // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–æ (–≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –ø—Ä–∏ undo)
        REVOKED = 2     // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –æ—Ç–º–µ–Ω–µ–Ω–æ (–æ—Ç–º—è–Ω–∞ –Ω–∞ –æ—Ç–º—è–Ω–∞ –ø—Ä–∏ undo)
    };

    UndoType type;
    ForgingAssignment assignment;  // –ü—ä–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–¥–∏ –ø—Ä–æ–º—è–Ω–∞—Ç–∞
};

struct CBlockUndo {
    std::vector<CTxUndo> vtxundo;           // UTXO undo –¥–∞–Ω–Ω–∏
    std::vector<ForgingUndo> vforgingundo;  // Undo –¥–∞–Ω–Ω–∏ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è
};
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/undo.h:63-105`

### –ü—Ä–æ—Ü–µ—Å –Ω–∞ DisconnectBlock

–ö–æ–≥–∞—Ç–æ –±–ª–æ–∫ —Å–µ –æ—Ç–≤—ä—Ä–∑–≤–∞ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:

```cpp
DisconnectResult Chainstate::DisconnectBlock(const CBlock& block,
                                              const CBlockIndex* pindex,
                                              CCoinsViewCache& view)
{
    // ... —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ UTXO –æ—Ç–≤—ä—Ä–∑–≤–∞–Ω–µ ...

    // –ß–µ—Ç–µ–Ω–µ –Ω–∞ undo –¥–∞–Ω–Ω–∏ –æ—Ç –¥–∏—Å–∫–∞
    CBlockUndo blockUndo;
    if (!ReadBlockUndo(blockUndo, *pindex))
        return DISCONNECT_FAILED;

    #ifdef ENABLE_POCX
    // Undo –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏ –≤ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–±—Ä–∞—Ç–µ–Ω —Ä–µ–¥)
    for (auto it = blockUndo.vforgingundo.rbegin();
         it != blockUndo.vforgingundo.rend(); ++it) {

        switch (it->type) {
            case UndoType::ADDED:
                // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –¥–æ–±–∞–≤–µ–Ω–æ - –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ
                view.RemoveForgingAssignment(
                    it->assignment.plotAddress,
                    it->assignment.assignment_txid
                );
                break;

            case UndoType::REVOKED:
                // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –æ—Ç–º–µ–Ω–µ–Ω–æ - –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –Ω–µ–æ—Ç–º–µ–Ω–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
                view.RestoreForgingAssignment(it->assignment);
                break;

            case UndoType::MODIFIED:
                // –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –±–µ—à–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–æ - –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–µ–¥–∏—à–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
                view.UpdateForgingAssignment(it->assignment);
                break;
        }
    }
    #endif

    return DISCONNECT_OK;
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/validation.cpp:2381-2415`

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–µ—à –ø—Ä–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è

```cpp
class CCoinsViewCache {
private:
    // –ö–µ—à–æ–≤–µ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è
    mutable std::map<std::array<uint8_t, 20>, std::vector<ForgingAssignment>> pendingAssignments;
    mutable std::set<std::array<uint8_t, 20>> dirtyPlots;  // –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–∏ plot-–æ–≤–µ
    mutable std::set<std::pair<std::array<uint8_t, 20>, uint256>> deletedAssignments;  // –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–∏—è
    mutable size_t cachedAssignmentsUsage{0};  // –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –ø–∞–º–µ—Ç

public:
    void AddForgingAssignment(const ForgingAssignment& assignment) {
        pendingAssignments[assignment.plotAddress].push_back(assignment);
        dirtyPlots.insert(assignment.plotAddress);
        cachedAssignmentsUsage += sizeof(ForgingAssignment);
    }

    void RemoveForgingAssignment(const std::array<uint8_t, 20>& plotAddress,
                                 const uint256& assignment_txid) {
        auto key = std::make_pair(plotAddress, assignment_txid);
        deletedAssignments.insert(key);
        dirtyPlots.insert(plotAddress);
        if (cachedAssignmentsUsage >= sizeof(ForgingAssignment)) {
            cachedAssignmentsUsage -= sizeof(ForgingAssignment);
        }
    }

    void RestoreForgingAssignment(const ForgingAssignment& assignment) {
        pendingAssignments[assignment.plotAddress].push_back(assignment);
        dirtyPlots.insert(assignment.plotAddress);
        auto key = std::make_pair(assignment.plotAddress, assignment.assignment_txid);
        deletedAssignments.erase(key);
        if (true) {
            cachedAssignmentsUsage += sizeof(ForgingAssignment);
        }
    }
};
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/coins.cpp:494-565`

## RPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ö–æ–º–∞–Ω–¥–∏ –∑–∞ –≤—ä–∑–µ–ª (–±–µ–∑ –∏–∑–∏—Å–∫–≤–∞–Ω–µ –∑–∞ –ø–æ—Ä—Ç—Ñ–µ–π–ª)

#### get_assignment
```bash
bitcoin-cli get_assignment "pocx1qplot..."
```

–í—Ä—ä—â–∞ —Ç–µ–∫—É—â —Å—Ç–∞—Ç—É—Å –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∑–∞ –∞–¥—Ä–µ—Å –Ω–∞ plot:
```json
{
  "plot_address": "pocx1qplot...",
  "has_assignment": true,
  "state": "ASSIGNED",
  "forging_address": "pocx1qforger...",
  "assignment_txid": "abc123...",
  "assignment_height": 100,
  "activation_height": 244,
  "revoked": false
}
```

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/rpc/assignments.cpp:31-126`

### –ö–æ–º–∞–Ω–¥–∏ –∑–∞ –ø–æ—Ä—Ç—Ñ–µ–π–ª (–∏–∑–∏—Å–∫–≤–∞ –ø–æ—Ä—Ç—Ñ–µ–π–ª)

#### create_assignment
```bash
bitcoin-cli create_assignment "pocx1qplot..." "pocx1qforger..."
```

–°—ä–∑–¥–∞–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞ –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ UTXO –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot –∑–∞ –¥–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
- –ò–∑–≥—Ä–∞–∂–¥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å OP_RETURN + –∏–∑—Ö–æ–¥ –∑–∞ —Ä–µ—Å—Ç–æ
- –ü–æ–¥–ø–∏—Å–≤–∞ —Å –∫–ª—é—á–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
- –†–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–≤–∞ –≤ –º—Ä–µ–∂–∞—Ç–∞

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/rpc/assignments_wallet.cpp:29-93`

#### revoke_assignment
```bash
bitcoin-cli revoke_assignment "pocx1qplot..."
```

–°—ä–∑–¥–∞–≤–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞ –æ—Ç–º—è–Ω–∞:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–±–∏—Ä–∞ –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ UTXO –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot –∑–∞ –¥–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
- –ò–∑–≥—Ä–∞–∂–¥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å OP_RETURN + –∏–∑—Ö–æ–¥ –∑–∞ —Ä–µ—Å—Ç–æ
- –ü–æ–¥–ø–∏—Å–≤–∞ —Å –∫–ª—é—á–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
- –†–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–≤–∞ –≤ –º—Ä–µ–∂–∞—Ç–∞

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/rpc/assignments_wallet.cpp:95-154`

### –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–π–ª

–ü—Ä–æ—Ü–µ—Å—ä—Ç –Ω–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–π–ª:

```cpp
1. –ü–∞—Ä—Å–≤–∞–Ω–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∞–¥—Ä–µ—Å–∏ (—Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ P2WPKH bech32)
2. –ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–∞–π-–≥–æ–ª—è–º–æ—Ç–æ UTXO –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot (–¥–æ–∫–∞–∑–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç)
3. –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å —Ñ–∏–∫—Ç–∏–≤–µ–Ω –∏–∑—Ö–æ–¥
4. –ü–æ–¥–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–ø–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ —Ç–æ—á–µ–Ω —Ä–∞–∑–º–µ—Ä —Å witness –¥–∞–Ω–Ω–∏)
5. –ó–∞–º—è–Ω–∞ –Ω–∞ —Ñ–∏–∫—Ç–∏–≤–µ–Ω –∏–∑—Ö–æ–¥ —Å OP_RETURN
6. –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª–Ω–∞ –∫–æ—Ä–µ–∫—Ü–∏—è –Ω–∞ —Ç–∞–∫—Å–∏ –Ω–∞ –±–∞–∑–∞ –ø—Ä–æ–º—è–Ω–∞ –≤ —Ä–∞–∑–º–µ—Ä–∞
7. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ —Ñ–∏–Ω–∞–ª–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
8. –†–∞–∑–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤ –º—Ä–µ–∂–∞—Ç–∞
```

**–ö–ª—é—á–æ–≤ –º–æ–º–µ–Ω—Ç:** –ü–æ—Ä—Ç—Ñ–µ–π–ª—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ —Ö–∞—Ä—á–∏ –æ—Ç –∞–¥—Ä–µ—Å–∞ –Ω–∞ plot, –∑–∞ –¥–∞ –¥–æ–∫–∞–∂–µ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç, —Ç–∞–∫–∞ —á–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–Ω—É–∂–¥–∞–≤–∞ –∏–∑–±–æ—Ä –Ω–∞ coin –æ—Ç —Ç–æ–∑–∏ –∞–¥—Ä–µ—Å.

**–ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:** `src/pocx/assignments/transactions.cpp:38-263`

## –§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω–∏ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ

```
src/
‚îú‚îÄ‚îÄ coins.h                        # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment, –º–µ—Ç–æ–¥–∏ –Ω–∞ CCoinsViewCache [710 —Ä–µ–¥–∞]
‚îú‚îÄ‚îÄ coins.cpp                      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∫–µ—à, batch –∑–∞–ø–∏—Å–∏ [603 —Ä–µ–¥–∞]
‚îÇ
‚îú‚îÄ‚îÄ txdb.h                         # –ú–µ—Ç–æ–¥–∏ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –Ω–∞ CCoinsViewDB [90 —Ä–µ–¥–∞]
‚îú‚îÄ‚îÄ txdb.cpp                       # –ß–µ—Ç–µ–Ω–µ/–∑–∞–ø–∏—Å –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ [349 —Ä–µ–¥–∞]
‚îÇ
‚îú‚îÄ‚îÄ undo.h                         # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingUndo –∑–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ validation.cpp                 # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ ConnectBlock/DisconnectBlock
‚îÇ
‚îî‚îÄ‚îÄ pocx/
    ‚îú‚îÄ‚îÄ assignments/
    ‚îÇ   ‚îú‚îÄ‚îÄ opcodes.h              # OP_RETURN —Ñ–æ—Ä–º–∞—Ç, –ø–∞—Ä—Å–≤–∞–Ω–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ opcodes.cpp            # [259 —Ä–µ–¥–∞] –î–µ—Ñ–∏–Ω–∏—Ü–∏–∏ –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏, OP_RETURN –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
    ‚îÇ   ‚îú‚îÄ‚îÄ assignment_state.h     # –ü–æ–º–æ—â–Ω–∏—Ü–∏ GetEffectiveSigner, GetAssignmentState
    ‚îÇ   ‚îú‚îÄ‚îÄ assignment_state.cpp   # –§—É–Ω–∫—Ü–∏–∏ –∑–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
    ‚îÇ   ‚îú‚îÄ‚îÄ transactions.h         # API –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–π–ª
    ‚îÇ   ‚îî‚îÄ‚îÄ transactions.cpp       # –§—É–Ω–∫—Ü–∏–∏ create_assignment, revoke_assignment –∑–∞ –ø–æ—Ä—Ç—Ñ–µ–π–ª
    ‚îÇ
    ‚îú‚îÄ‚îÄ rpc/
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments.h          # RPC –∫–æ–º–∞–Ω–¥–∏ –∑–∞ –≤—ä–∑–µ–ª (–±–µ–∑ –ø–æ—Ä—Ç—Ñ–µ–π–ª)
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments.cpp        # get_assignment, list_assignments RPC
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments_wallet.h   # RPC –∫–æ–º–∞–Ω–¥–∏ –∑–∞ –ø–æ—Ä—Ç—Ñ–µ–π–ª
    ‚îÇ   ‚îî‚îÄ‚îÄ assignments_wallet.cpp # create_assignment, revoke_assignment RPC
    ‚îÇ
    ‚îî‚îÄ‚îÄ consensus/
        ‚îî‚îÄ‚îÄ params.h               # nForgingAssignmentDelay, nForgingRevocationDelay
```

## –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

- **–ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** O(n) ‚Äî —Å–∫–∞–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –∑–∞ –∞–¥—Ä–µ—Å –Ω–∞ plot –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–∞–π-—Å–∫–æ—Ä–æ—à–Ω–æ—Ç–æ
- **–ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è:** O(n) ‚Äî –∏—Ç–µ—Ä–∞—Ü–∏—è –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –∑–∞ plot
- **–°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** O(1) ‚Äî –µ–¥–∏–Ω–∏—á–Ω–æ –≤–º—ä–∫–≤–∞–Ω–µ
- **–û—Ç–º—è–Ω–∞ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** O(1) ‚Äî –µ–¥–∏–Ω–∏—á–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
- **–†–µ–æ—Ä–≥ (–∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ):** O(1) ‚Äî –¥–∏—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ undo –¥–∞–Ω–Ω–∏

–ö—ä–¥–µ—Ç–æ n = –±—Ä–æ–π –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –∑–∞ plot (–æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –º–∞–ª—ä–∫, < 10)

### –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –ø–∞–º–µ—Ç

- **–ó–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** ~160 –±–∞–π—Ç–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment)
- **Overhead –Ω–∞ –∫–µ—à:** Overhead –Ω–∞ —Ö–µ—à —Ç–∞–±–ª–∏—Ü–∞ –∑–∞ dirty –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ
- **–¢–∏–ø–∏—á–µ–Ω –±–ª–æ–∫:** <10 –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è = <2 KB –ø–∞–º–µ—Ç

### –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ –¥–∏—Å–∫

- **–ó–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** ~200 –±–∞–π—Ç–∞ –Ω–∞ –¥–∏—Å–∫ (—Å LevelDB overhead)
- **10000 –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è:** ~2 MB –¥–∏—Å–∫–æ–≤–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- **–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª–Ω–æ —Å–ø—Ä—è–º–æ UTXO —Å–µ—Ç:** <0.001% –æ—Ç —Ç–∏–ø–∏—á–µ–Ω chainstate

## –¢–µ–∫—É—â–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –±—ä–¥–µ—â–∞ —Ä–∞–±–æ—Ç–∞

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç

**–¢–µ–∫—É—â–æ:** Coins –∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç –≤ –æ—Ç–¥–µ–ª–Ω–∏ LevelDB batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ –Ω–∞ `view.Flush()`

**–í—ä–∑–¥–µ–π—Å—Ç–≤–∏–µ:** –¢–µ–æ—Ä–µ—Ç–∏—á–µ–Ω —Ä–∏—Å–∫ –æ—Ç –Ω–µ—Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞–∫–æ –≤—ä–∑–Ω–∏–∫–Ω–µ —Å—Ä–∏–≤ –º–µ–∂–¥—É batch-–æ–≤–µ—Ç–µ

**–°–º–µ–∫—á–∞–≤–∞–Ω–µ:**
- –ò –¥–≤–∞—Ç–∞ batch-–∞ –∑–∞–≤—ä—Ä—à–≤–∞—Ç –±—ä—Ä–∑–æ –ø—Ä–µ–¥–∏ fsync
- –í—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ—Ç–æ –æ—Ç —Å—Ä–∏–≤ –Ω–∞ Bitcoin Core –∏–∑–ø–æ–ª–∑–≤–∞ DB_HEAD_BLOCKS –º–∞—Ä–∫–µ—Ä
- –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞: –ù–∏–∫–æ–≥–∞ –Ω–µ –µ –Ω–∞–±–ª—é–¥–∞–≤–∞–Ω–æ –ø—Ä–∏ —Ç–µ—Å—Ç–≤–∞–Ω–µ

**–ë—ä–¥–µ—â–æ –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–µ –≤ –µ–¥–∏–Ω–∏—á–Ω–∞ LevelDB batch –æ–ø–µ—Ä–∞—Ü–∏—è

### –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è

**–¢–µ–∫—É—â–æ:** –í—Å–∏—á–∫–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –∑–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤—Ä–µ–º–µ

**–í—ä–∑–¥–µ–π—Å—Ç–≤–∏–µ:** ~200 –±–∞–π—Ç–∞ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –∑–∞–≤–∏–Ω–∞–≥–∏

**–ë—ä–¥–µ—â–µ:** –ù–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ø—ä–ª–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è, –ø–æ-—Å—Ç–∞—Ä–∏ –æ—Ç N –±–ª–æ–∫–∞

**–ó–∞–±–µ–ª–µ–∂–∫–∞:** –ú–∞–ª–∫–æ –≤–µ—Ä–æ—è—Ç–Ω–æ –¥–∞ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ ‚Äî –¥–æ—Ä–∏ 1 –º–∏–ª–∏–æ–Ω –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è = 200 MB

## –°—Ç–∞—Ç—É—Å –Ω–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ

‚úÖ OP_RETURN –ø–∞—Ä—Å–≤–∞–Ω–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç
‚úÖ ConnectBlock —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ
‚úÖ ConnectBlock –æ—Ç–º—è–Ω–∞
‚úÖ DisconnectBlock –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
‚úÖ –û–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ç–µ–Ω–µ/–∑–∞–ø–∏—Å –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
‚úÖ –ü—Ä–µ—Ö–æ–¥–∏ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ (UNASSIGNED ‚Üí ASSIGNING ‚Üí ASSIGNED ‚Üí REVOKING ‚Üí REVOKED)
‚úÖ RPC –∫–æ–º–∞–Ω–¥–∏ (get_assignment, create_assignment, revoke_assignment)
‚úÖ –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–π–ª

### –û–±–ª–∞—Å—Ç–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ –ø–æ–∫—Ä–∏—Ç–∏–µ

- Unit —Ç–µ—Å—Ç–æ–≤–µ: `src/test/pocx_*_tests.cpp`
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ: `test/functional/feature_pocx_*.py`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ: –†—ä—á–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ —Å regtest

## –ö–æ–Ω—Å–µ–Ω—Å—É—Å–Ω–∏ –ø—Ä–∞–≤–∏–ª–∞

### –ü—Ä–∞–≤–∏–ª–∞ –∑–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ

1. **–°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
2. **–°—ä—Å—Ç–æ—è–Ω–∏–µ:** Plot —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –≤ —Å—ä—Å—Ç–æ—è–Ω–∏–µ UNASSIGNED –∏–ª–∏ REVOKED
3. **–§–æ—Ä–º–∞—Ç:** –í–∞–ª–∏–¥–µ–Ω OP_RETURN —Å POCX –º–∞—Ä–∫–µ—Ä + 2x 20-–±–∞–π—Ç–æ–≤–∏ –∞–¥—Ä–µ—Å–∏
4. **–£–Ω–∏–∫–∞–ª–Ω–æ—Å—Ç:** –ï–¥–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –Ω–∞ plot –Ω–∞–≤–µ–¥–Ω—ä–∂

### –ü—Ä–∞–≤–∏–ª–∞ –∑–∞ –æ—Ç–º—è–Ω–∞

1. **–°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç:** –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∞ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–∏–∫–∞ –Ω–∞ plot
2. **–°—ä—â–µ—Å—Ç–≤—É–≤–∞–Ω–µ:** –î–µ–ª–µ–≥–∏—Ä–∞–Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∏ –¥–∞ –Ω–µ –µ –≤–µ—á–µ –æ—Ç–º–µ–Ω–µ–Ω–æ
3. **–§–æ—Ä–º–∞—Ç:** –í–∞–ª–∏–¥–µ–Ω OP_RETURN —Å XCOP –º–∞—Ä–∫–µ—Ä + 20-–±–∞–π—Ç–æ–≤ –∞–¥—Ä–µ—Å

### –ü—Ä–∞–≤–∏–ª–∞ –∑–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ

- **–ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ:** `assignment_height + nForgingAssignmentDelay`
- **–ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ç–º—è–Ω–∞:** `revocation_height + nForgingRevocationDelay`
- **–ó–∞–±–∞–≤—è–Ω–∏—è:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∏ –∑–∞ –º—Ä–µ–∂–∞ (–Ω–∞–ø—Ä. 30 –±–ª–æ–∫–∞ = ~1 —á–∞—Å —Å 2-–º–∏–Ω—É—Ç–Ω–æ –≤—Ä–µ–º–µ –Ω–∞ –±–ª–æ–∫)

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±–ª–æ–∫

- –ù–µ–≤–∞–ª–∏–¥–Ω–æ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ/–æ—Ç–º—è–Ω–∞ ‚Üí –±–ª–æ–∫—ä—Ç —Å–µ –æ—Ç—Ö–≤—ä—Ä–ª—è (–∫–æ–Ω—Å–µ–Ω—Å—É—Å–µ–Ω –ø—Ä–æ–≤–∞–ª)
- OP_RETURN –∏–∑—Ö–æ–¥–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–µ –∏–∑–∫–ª—é—á–≤–∞—Ç –æ—Ç UTXO —Å–µ—Ç–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ Bitcoin –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞—Ç–∞ –Ω–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è —Å–µ —Å–ª—É—á–≤–∞ –ø—Ä–µ–¥–∏ UTXO –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ ConnectBlock

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥–ø–∏—Å–≤–∞–Ω–µ –≤ PoCX, –∫–∞–∫—Ç–æ –µ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è:

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏ Bitcoin —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ UTXO
‚úÖ **–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç –Ω–∞ —Ä–∞–∑—Ö–æ–¥–∏—Ç–µ:** –ë–µ–∑ –∏–∑–∏—Å–∫–≤–∞–Ω–µ –∑–∞ –ø—Ä–∞—Ö, —Å–∞–º–æ —Ç–∞–∫—Å–∏ –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç –ø—Ä–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:** –ò–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–∏ undo –¥–∞–Ω–Ω–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞—Ç –ø—Ä–∞–≤–∏–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ —á—Ä–µ–∑ LevelDB batch-–æ–≤–µ
‚úÖ **–ü—ä–ª–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è:** –ü—ä–ª–Ω–∞ –æ–¥–∏—Ç–Ω–∞ —Å–ª–µ–¥–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–µ–ª–µ–≥–∏—Ä–∞–Ω–∏—è –≤—ä–≤ –≤—Ä–µ–º–µ—Ç–æ
‚úÖ **–ß–∏—Å—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ú–∏–Ω–∏–º–∞–ª–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ Bitcoin Core, –∏–∑–æ–ª–∏—Ä–∞–Ω PoCX –∫–æ–¥
‚úÖ **–ì–æ—Ç–æ–≤–∞ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ:** –ù–∞–ø—ä–ª–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞, —Ç–µ—Å—Ç–≤–∞–Ω–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–∞—â–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞

- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–æ–¥:** –û—Ç–ª–∏—á–Ω–∞ ‚Äî —è—Å–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É Bitcoin Core –∏ PoCX
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏:** –ò–∑—á–µ—Ä–ø–∞—Ç–µ–ª–Ω–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ö–æ–¥ —Å –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∏ –¥–æ–±—Ä–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–¢–µ—Å—Ç–≤–∞–Ω–µ:** –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç —Ç–µ—Å—Ç–≤–∞–Ω–∞, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

### –í–∞–ª–∏–¥–∏—Ä–∞–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏ —Ä–µ—à–µ–Ω–∏—è

1. ‚úÖ –ü–æ–¥—Ö–æ–¥ —Å–∞–º–æ —Å OP_RETURN (—Å—Ä–µ—â—É –±–∞–∑–∏—Ä–∞–Ω –Ω–∞ UTXO)
2. ‚úÖ –û—Ç–¥–µ–ª–Ω–æ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ (—Å—Ä–µ—â—É Coin extraData)
3. ‚úÖ –ü—ä–ª–Ω–æ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è (—Å—Ä–µ—â—É —Å–∞–º–æ —Ç–µ–∫—É—â–æ)
4. ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–æ—Å—Ç —á—Ä–µ–∑ –ø–æ–¥–ø–∏—Å (—Å—Ä–µ—â—É —Ö–∞—Ä—á–µ–Ω–µ –Ω–∞ UTXO)
5. ‚úÖ –ó–∞–±–∞–≤—è–Ω–∏—è –Ω–∞ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –∞—Ç–∞–∫–∏ –ø—Ä–∏ —Ä–µ–æ—Ä–≥)

–°–∏—Å—Ç–µ–º–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç–∏–≥–∞ –≤—Å–∏—á–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∏ —Ü–µ–ª–∏ —Å —á–∏—Å—Ç–∞, –ø–æ–¥–¥—ä—Ä–∂–∞–µ–º–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è.

---

[‚Üê –ù–∞–∑–∞–¥: –ö–æ–Ω—Å–µ–Ω—Å—É—Å –∏ –∫–æ–ø–∞–µ–Ω–µ](3-consensus-and-mining.md) | [üìò –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ](index.md) | [–ù–∞–ø—Ä–µ–¥: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –≤—Ä–µ–º–µ ‚Üí](5-timing-security.md)
