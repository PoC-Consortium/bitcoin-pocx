[← 前へ: 時刻同期](5-timing-security.md) | [目次](index.md) | [次へ: RPCリファレンス →](7-rpc-reference.md)

---

# 第6章: ネットワークパラメータと設定

すべてのネットワークタイプにわたるBitcoin-PoCXネットワーク設定の完全なリファレンス。

---

## 目次

1. [ジェネシスブロックパラメータ](#ジェネシスブロックパラメータ)
2. [Chainparams設定](#chainparams設定)
3. [コンセンサスパラメータ](#コンセンサスパラメータ)
4. [Coinbaseとブロック報酬](#coinbaseとブロック報酬)
5. [動的スケーリング](#動的スケーリング)
6. [ネットワーク設定](#ネットワーク設定)
7. [データディレクトリ構造](#データディレクトリ構造)

---

## ジェネシスブロックパラメータ

### ベースターゲット計算

**計算式**: `genesis_base_target = 2^42 / block_time_seconds`

**根拠**:
- 各ノンスは256 KiB（64バイト × 4096スクープ）を表す
- 1 TiB = 2^22ノンス（開始ネットワーク容量の仮定）
- nノンスの期待最小品質 ≈ 2^64 / n
- 1 TiBの場合: E(quality) = 2^64 / 2^22 = 2^42
- したがって: base_target = 2^42 / block_time

**計算値**:
- メインネット/テストネット/Signet（120秒）: `36650387592`
- Regtest（1秒）: 低容量キャリブレーションモードを使用

### ジェネシスメッセージ

すべてのネットワークでBitcoinジェネシスメッセージを共有:
```
"The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"
```

**実装**: `src/kernel/chainparams.cpp`

---

## Chainparams設定

### メインネットパラメータ

**ネットワークID**:
- **マジックバイト**: `0xa7 0x3c 0x91 0x5e`
- **デフォルトポート**: `8888`
- **Bech32 HRP**: `pocx`

**アドレスプレフィックス**（Base58）:
- PUBKEY_ADDRESS: `85`（アドレスは'P'で始まる）
- SCRIPT_ADDRESS: `90`（アドレスは'R'で始まる）
- SECRET_KEY: `128`

**ブロックタイミング**:
- **ブロック時間ターゲット**: `120`秒（2分）
- **ターゲットタイムスパン**: `1209600`秒（14日）
- **MAX_FUTURE_BLOCK_TIME**: `15`秒

**ブロック報酬**:
- **初期報酬**: `10 BTC`
- **半減期間隔**: `1050000`ブロック（約4年）
- **半減回数**: 最大64回

**難易度調整**:
- **ローリングウィンドウ**: `24`ブロック
- **調整**: 毎ブロック
- **アルゴリズム**: 指数移動平均

**割り当て遅延**:
- **アクティベーション**: `30`ブロック（約1時間）
- **取り消し**: `720`ブロック（約24時間）

### テストネットパラメータ

**ネットワークID**:
- **マジックバイト**: `0x6d 0xf2 0x48 0xb3`
- **デフォルトポート**: `18888`
- **Bech32 HRP**: `tpocx`

**アドレスプレフィックス**（Base58）:
- PUBKEY_ADDRESS: `127`
- SCRIPT_ADDRESS: `132`
- SECRET_KEY: `255`

**ブロックタイミング**:
- **ブロック時間ターゲット**: `120`秒
- **MAX_FUTURE_BLOCK_TIME**: `15`秒
- **最小難易度許可**: `true`

**ブロック報酬**:
- **初期報酬**: `10 BTC`
- **半減期間隔**: `1050000`ブロック

**難易度調整**:
- **ローリングウィンドウ**: `24`ブロック

**割り当て遅延**:
- **アクティベーション**: `30`ブロック（約1時間）
- **取り消し**: `720`ブロック（約24時間）

### Regtestパラメータ

**ネットワークID**:
- **マジックバイト**: `0xfa 0xbf 0xb5 0xda`
- **デフォルトポート**: `18444`
- **Bech32 HRP**: `rpocx`

**アドレスプレフィックス**（Bitcoin互換）:
- PUBKEY_ADDRESS: `111`
- SCRIPT_ADDRESS: `196`
- SECRET_KEY: `239`

**ブロックタイミング**:
- **ブロック時間ターゲット**: `1`秒（テスト用の即時マイニング）
- **ターゲットタイムスパン**: `86400`秒（1日）
- **MAX_FUTURE_BLOCK_TIME**: `15`秒

**ブロック報酬**:
- **初期報酬**: `10 BTC`
- **半減期間隔**: `500`ブロック

**難易度調整**:
- **ローリングウィンドウ**: `24`ブロック
- **最小難易度許可**: `true`
- **リターゲティングなし**: `true`
- **低容量キャリブレーション**: `true`（1 TiBの代わりに16ノンスキャリブレーションを使用）

**割り当て遅延**:
- **アクティベーション**: `4`ブロック（約4秒）
- **取り消し**: `8`ブロック（約8秒）

### Signetパラメータ

**ネットワークID**:
- **マジックバイト**: SHA256d(signet_challenge)の最初の4バイト
- **デフォルトポート**: `38333`
- **Bech32 HRP**: `tpocx`

**ブロックタイミング**:
- **ブロック時間ターゲット**: `120`秒
- **MAX_FUTURE_BLOCK_TIME**: `15`秒

**ブロック報酬**:
- **初期報酬**: `10 BTC`
- **半減期間隔**: `1050000`ブロック

**難易度調整**:
- **ローリングウィンドウ**: `24`ブロック

---

## コンセンサスパラメータ

### タイミングパラメータ

**MAX_FUTURE_BLOCK_TIME**: `15`秒
- PoCX固有（Bitcoinは2時間を使用）
- 根拠: PoCタイミングはほぼリアルタイムの検証を必要とする
- 15秒以上先のブロックは拒否

**時刻オフセット警告**: `10`秒
- ノードクロックがネットワーク時刻から10秒以上ずれると運用者に警告
- 強制なし、情報提供のみ

**ブロック時間ターゲット**:
- メインネット/テストネット/Signet: `120`秒
- Regtest: `1`秒

**TIMESTAMP_WINDOW**: `15`秒（MAX_FUTURE_BLOCK_TIMEと同じ）

**実装**: `src/chain.h`、`src/validation.cpp`

### 難易度調整パラメータ

**ローリングウィンドウサイズ**: `24`ブロック（すべてのネットワーク）
- 最近のブロック時間の指数移動平均
- 毎ブロック調整
- 容量変化に応答

**実装**: `src/consensus/params.h`、ブロック作成時の難易度ロジック

### 割り当てシステムパラメータ

**nForgingAssignmentDelay**（アクティベーション遅延）:
- メインネット: `30`ブロック（約1時間）
- テストネット: `30`ブロック（約1時間）
- Regtest: `4`ブロック（約4秒）

**nForgingRevocationDelay**（取り消し遅延）:
- メインネット: `720`ブロック（約24時間）
- テストネット: `720`ブロック（約24時間）
- Regtest: `8`ブロック（約8秒）

**根拠**:
- アクティベーション遅延はブロックレース中の急速な再割り当てを防止
- 取り消し遅延は安定性を提供し、悪用を防止

**実装**: `src/consensus/params.h`

---

## Coinbaseとブロック報酬

### ブロック報酬スケジュール

**初期報酬**: `10 BTC`（すべてのネットワーク）

**半減スケジュール**:
- `1050000`ブロックごと（メインネット/テストネット）
- `500`ブロックごと（regtest）
- 最大64回の半減まで継続

**半減進行**:
```
半減 0: 10.00000000 BTC（ブロック 0 - 1049999）
半減 1:  5.00000000 BTC（ブロック 1050000 - 2099999）
半減 2:  2.50000000 BTC（ブロック 2100000 - 3149999）
半減 3:  1.25000000 BTC（ブロック 3150000 - 4199999）
...
```

**総供給量**: 約2100万BTC（Bitcoinと同じ）

### Coinbase出力ルール

**支払い先**:
- **割り当てなし**: Coinbaseはプロットアドレス（proof.account_id）に支払い
- **割り当てあり**: Coinbaseはフォージングアドレス（有効な署名者）に支払い

**出力形式**: P2WPKHのみ
- Coinbaseはbech32 SegWit v0アドレスに支払い必須
- 有効な署名者の公開鍵から生成

**割り当て解決**:
```cpp
effective_signer = GetEffectiveSigner(plot_address, height, view);
coinbase_script = P2WPKH(effective_signer);
```

**実装**: `src/pocx/mining/scheduler.cpp:ForgeBlock()`

---

## 動的スケーリング

### スケーリング境界

**目的**: ネットワーク成熟に伴いプロット生成難易度を増加させ、容量インフレを防止

**構造**:
```cpp
struct CompressionBounds {
    uint8_t nPoCXMinCompression;     // 受け入れられる最小レベル
    uint8_t nPoCXTargetCompression;  // 推奨レベル
};
```

**関係**: `target = min + 1`（常に最小より1レベル上）

### スケーリング増加スケジュール

スケーリングレベルは半減期間隔に基づく**指数スケジュール**で増加:

| 期間 | ブロック高さ | 半減期 | 最小 | ターゲット |
|-------------|--------------|----------|-----|--------|
| 0-4年 | 0 〜 1049999 | 0 | X1 | X2 |
| 4-12年 | 1050000 〜 3149999 | 1-2 | X2 | X3 |
| 12-28年 | 3150000 〜 7349999 | 3-6 | X3 | X4 |
| 28-60年 | 7350000 〜 15749999 | 7-14 | X4 | X5 |
| 60-124年 | 15750000 〜 32549999 | 15-30 | X5 | X6 |
| 124年以降 | 32550000以降 | 31以降 | X6 | X7 |

**重要な高さ**（年 → 半減期 → ブロック）:
- 4年目: 半減期1、ブロック1050000
- 12年目: 半減期3、ブロック3150000
- 28年目: 半減期7、ブロック7350000
- 60年目: 半減期15、ブロック15750000
- 124年目: 半減期31、ブロック32550000

### スケーリングレベル難易度

**PoWスケーリング**:
- スケーリングレベルX0: POC2ベースライン（理論的）
- スケーリングレベルX1: XOR-transposeベースライン
- スケーリングレベルXn: 2^(n-1) × X1ワークが埋め込み
- 各レベルはプロット生成作業を2倍に

**経済的整合性**:
- ブロック報酬半減 → プロット生成難易度増加
- 安全マージンを維持: プロット作成コスト > 参照コスト
- ハードウェア改善からの容量インフレを防止

### プロット検証

**検証ルール**:
- 送信された証明はスケーリングレベル ≥ 最小である必要
- スケーリング > ターゲットの証明は受け入れられるが非効率
- 最小未満の証明: 拒否（PoW不足）

**境界取得**:
```cpp
auto bounds = GetPoCXCompressionBounds(height, halving_interval);
```

**実装**: `src/pocx/algorithms/algorithms.h:GetPoCXCompressionBounds()`、`src/pocx/consensus/params.cpp`

---

## ネットワーク設定

### シードノードとDNSシード

**ステータス**: メインネットローンチ用プレースホルダー

**計画された設定**:
- シードノード: 未定
- DNSシード: 未定

**現在の状態**（テストネット/regtest）:
- 専用シードインフラなし
- `-addnode`経由の手動ピア接続をサポート

**実装**: `src/kernel/chainparams.cpp`

### チェックポイント

**ジェネシスチェックポイント**: 常にブロック0

**追加チェックポイント**: 現在未設定

**将来**: メインネット進行に伴いチェックポイントを追加

---

## P2Pプロトコル設定

### プロトコルバージョン

**ベース**: Bitcoin Core v30.0プロトコル
- **プロトコルバージョン**: Bitcoin Coreから継承
- **サービスビット**: 標準Bitcoinサービス
- **メッセージタイプ**: 標準Bitcoin P2Pメッセージ

**PoCX拡張**:
- ブロックヘッダーにPoCX固有フィールドを含む
- ブロックメッセージにPoCX証明データを含む
- 検証ルールはPoCXコンセンサスを強制

**互換性**: PoCXノードはBitcoin PoWノードと非互換（異なるコンセンサス）

**実装**: `src/protocol.h`、`src/net_processing.cpp`

---

## データディレクトリ構造

### デフォルトディレクトリ

**場所**: `.bitcoin/`（Bitcoin Coreと同じ）
- Linux: `~/.bitcoin/`
- macOS: `~/Library/Application Support/Bitcoin/`
- Windows: `%APPDATA%\Bitcoin\`

### ディレクトリ内容

```
.bitcoin/
├── blocks/              # ブロックデータ
│   ├── blk*.dat        # ブロックファイル
│   ├── rev*.dat        # 取り消しデータ
│   └── index/          # ブロックインデックス（LevelDB）
├── chainstate/         # UTXOセット + フォージング割り当て（LevelDB）
├── wallets/            # ウォレットファイル
│   └── wallet.dat      # デフォルトウォレット
├── bitcoin.conf        # 設定ファイル
├── debug.log           # デバッグログ
├── peers.dat           # ピアアドレス
├── mempool.dat         # Mempool永続化
└── banlist.dat         # バンされたピア
```

### Bitcoinとの主な違い

**Chainstateデータベース**:
- 標準: UTXOセット
- **PoCX追加**: フォージング割り当て状態
- アトミック更新: UTXOと割り当てを一緒に更新
- 割り当て用の再編成安全な取り消しデータ

**ブロックファイル**:
- 標準Bitcoinブロック形式
- **PoCX追加**: PoCX証明フィールドで拡張（account_id、seed、nonce、signature、pubkey）

### 設定ファイル例

**bitcoin.conf**:
```ini
# ネットワーク選択
#testnet=1
#regtest=1

# PoCXマイニングサーバー（外部マイナーに必要）
miningserver=1

# RPC設定
server=1
rpcuser=yourusername
rpcpassword=yourpassword
rpcallowip=127.0.0.1
rpcport=8332

# 接続設定
listen=1
port=8888
maxconnections=125

# ブロック時間ターゲット（情報提供、コンセンサスで強制）
# メインネット/テストネットは120秒
```

---

## コード参照

**Chainparams**: `src/kernel/chainparams.cpp`
**コンセンサスパラメータ**: `src/consensus/params.h`
**圧縮境界**: `src/pocx/algorithms/algorithms.h`、`src/pocx/consensus/params.cpp`
**ジェネシスベースターゲット計算**: `src/pocx/consensus/params.cpp`
**Coinbase支払いロジック**: `src/pocx/mining/scheduler.cpp:ForgeBlock()`
**割り当て状態ストレージ**: `src/coins.h`、`src/coins.cpp`（CCoinsViewCache拡張）

---

## 相互参照

関連章:
- [第2章: プロット形式](2-plot-format.md) - プロット生成におけるスケーリングレベル
- [第3章: コンセンサスとマイニング](3-consensus-and-mining.md) - スケーリング検証、割り当てシステム
- [第4章: フォージング割り当て](4-forging-assignments.md) - 割り当て遅延パラメータ
- [第5章: タイミングセキュリティ](5-timing-security.md) - MAX_FUTURE_BLOCK_TIMEの根拠

---

[← 前へ: 時刻同期](5-timing-security.md) | [目次](index.md) | [次へ: RPCリファレンス →](7-rpc-reference.md)
