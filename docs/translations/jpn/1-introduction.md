[目次](index.md) | [次へ: プロット形式 →](2-plot-format.md)

---

# 第1章: はじめに

## Bitcoin-PoCXとは

Bitcoin-PoCXは、**次世代容量証明（Proof of Capacity neXt generation、PoCX）**コンセンサスサポートを追加するBitcoin Core統合プロジェクトです。Bitcoin Coreの既存アーキテクチャを維持しながら、Proof of Workの完全な代替としてエネルギー効率の高い容量証明マイニングを実現します。

**重要な区別**: これはPoW Bitcoinとの後方互換性のない**新しいチェーン**です。PoCXブロックは設計上、PoWノードと互換性がありません。

---

## プロジェクト概要

- **組織**: Proof of Capacity Consortium
- **プロジェクト名**: Bitcoin-PoCX
- **正式名称**: Bitcoin Core with PoCX Integration
- **ステータス**: テストネットフェーズ

---

## 容量証明とは

容量証明（Proof of Capacity、PoC）は、マイニングパワーが計算能力ではなく**ディスク容量**に比例するコンセンサスメカニズムです。マイナーは暗号学的ハッシュを含む大きなプロットファイルを事前生成し、これらのプロットを使用して有効なブロック解を見つけます。

**エネルギー効率**: プロットファイルは一度生成され、無期限に再利用されます。マイニングは最小限のCPUパワー（主にディスクI/O）のみを消費します。

**PoCXの強化点**:
- XOR-transpose圧縮攻撃の修正（POC2の50%時間-メモリトレードオフ）
- 最新ハードウェア向け16ノンス整列レイアウト
- プロット生成におけるスケーラブルなProof-of-Work（Xnスケーリングレベル）
- Bitcoin Coreへのネイティブ C++統合
- ブロック時間分布改善のためのタイムベンディングアルゴリズム

---

## アーキテクチャ概要

### リポジトリ構造

```
bitcoin-pocx/
├── bitcoin/             # Bitcoin Core v30.0 + PoCX統合
│   └── src/pocx/        # PoCX実装
├── pocx/                # PoCXコアフレームワーク（サブモジュール、読み取り専用）
└── docs/                # 本文書
```

### 統合哲学

**最小限の統合面**: 変更は`/src/pocx/`ディレクトリに分離され、Bitcoin Coreの検証、マイニング、RPCレイヤーへのクリーンなフックを持ちます。

**フィーチャーフラグ**: すべての変更は`#ifdef ENABLE_POCX`プリプロセッサガードの下にあります。無効時はBitcoin Coreが通常通りビルドされます。

**アップストリーム互換性**: 分離された統合ポイントにより、Bitcoin Coreの更新との定期的な同期を維持。

**ネイティブC++実装**: スカラー暗号アルゴリズム（Shabal256、スクープ計算、圧縮）がコンセンサス検証のためにBitcoin Coreに直接統合。

---

## 主要機能

### 1. 完全なコンセンサス置換

- **ブロック構造**: PoCX固有のフィールドがPoWのnonceとdifficulty bitsを置換
  - 生成署名（決定論的マイニングエントロピー）
  - ベースターゲット（難易度の逆数）
  - PoCX証明（アカウントID、シード、ノンス）
  - ブロック署名（プロット所有権の証明）

- **検証**: ヘッダーチェックからブロック接続まで5段階の検証パイプライン

- **難易度調整**: 最近のベースターゲットの移動平均を使用した毎ブロック調整

### 2. タイムベンディングアルゴリズム

**問題**: 従来のPoC ブロック時間は指数分布に従い、良い解を見つけるマイナーがいない場合に長いブロックが発生。

**解決策**: 立方根を使用した指数分布からカイ二乗分布への変換: `Y = scale × (X^(1/3))`

**効果**: 非常に良い解は遅くフォージ（ネットワークがすべてのディスクをスキャンする時間を確保、高速ブロックを削減）、悪い解は改善。平均ブロック時間は120秒を維持、長いブロックを削減。

**詳細**: [第3章: コンセンサスとマイニング](3-consensus-and-mining.md)

### 3. フォージング割り当てシステム

**機能**: プロット所有者はプロットの所有権を維持しながら、フォージング権限を他のアドレスに委譲可能。

**ユースケース**:
- プールマイニング（プロットがプールアドレスに割り当て）
- コールドストレージ（マイニングキーをプロット所有権から分離）
- マルチパーティマイニング（共有インフラストラクチャ）

**アーキテクチャ**: OP_RETURN専用設計—特別なUTXOなし、割り当てはchainStateデータベースで個別に追跡。

**詳細**: [第4章: フォージング割り当て](4-forging-assignments.md)

### 4. 防御的フォージング

**問題**: 高速クロックは15秒の将来許容範囲内でタイミング上の優位性を提供する可能性。

**解決策**: 同じ高さで競合ブロックを受信した場合、自動的にローカルの品質をチェック。より良ければ即座にフォージ。

**効果**: クロック操作へのインセンティブを排除—高速クロックは最良の解を既に持っている場合にのみ役立つ。

**詳細**: [第5章: タイミングセキュリティ](5-timing-security.md)

### 5. 動的圧縮スケーリング

**経済的整合性**: スケーリングレベル要件は指数スケジュールで増加（年4、12、28、60、124 = 半減期1、3、7、15、31）。

**効果**: ブロック報酬が減少するにつれて、プロット生成難易度が増加。プロット作成コストと参照コストの安全マージンを維持。

**防止**: 時間経過によるハードウェア高速化からの容量インフレを防止。

**詳細**: [第6章: ネットワークパラメータ](6-network-parameters.md)

---

## 設計哲学

### コード安全性

- 全体を通じた防御的プログラミング手法
- 検証パスでの包括的なエラー処理
- ネストされたロックなし（デッドロック防止）
- アトミックなデータベース操作（UTXOと割り当てを同時に）

### モジュラーアーキテクチャ

- Bitcoin Coreインフラストラクチャとポックスコンセンサスのクリーンな分離
- PoCXコアフレームワークが暗号プリミティブを提供
- Bitcoin Coreが検証フレームワーク、データベース、ネットワーキングを提供

### パフォーマンス最適化

- 高速失敗検証順序（安価なチェックを先に）
- 提出ごとに単一コンテキストフェッチ（cs_main取得の繰り返しなし）
- 一貫性のためのアトミックなデータベース操作

### 再編成安全性

- 割り当て状態変更の完全な取り消しデータ
- チェーン先端変更時のフォージング状態リセット
- すべての検証ポイントでの陳腐化検出

---

## PoCXとProof of Workの違い

| 側面 | Bitcoin（PoW） | Bitcoin-PoCX |
|------|----------------|--------------|
| **マイニングリソース** | 計算能力（ハッシュレート） | ディスク容量（キャパシティ） |
| **エネルギー消費** | 高（継続的ハッシング） | 低（ディスクI/Oのみ） |
| **マイニングプロセス** | hash < targetとなるnonceを探す | deadline < 経過時間となるnonceを探す |
| **難易度** | `bits`フィールド、2016ブロックごとに調整 | `base_target`フィールド、毎ブロック調整 |
| **ブロック時間** | 約10分（指数分布） | 120秒（タイムベンド、分散低減） |
| **報酬** | 50 BTC → 25 → 12.5 → ... | 10 BTC → 5 → 2.5 → ... |
| **ハードウェア** | ASIC（専用） | HDD（コモディティハードウェア） |
| **マイニングID** | 匿名 | プロット所有者または委任者 |

---

## システム要件

### ノード運用

**Bitcoin Coreと同じ**:
- **CPU**: 最新のx86_64プロセッサ
- **メモリ**: 4-8 GB RAM
- **ストレージ**: 新しいチェーン、現在は空（2分ブロックと割り当てデータベースにより、Bitcoinの約4倍速く成長可能）
- **ネットワーク**: 安定したインターネット接続
- **クロック**: 最適な運用のためにNTP同期を推奨

**注意**: ノード運用にプロットファイルは不要。

### マイニング要件

**マイニング用の追加要件**:
- **プロットファイル**: `pocx_plotter`（リファレンス実装）で事前生成
- **マイナーソフトウェア**: `pocx_miner`（リファレンス実装）がRPC経由で接続
- **ウォレット**: マイニングアドレス用の秘密鍵を持つ`bitcoind`または`bitcoin-qt`。プールマイニングではローカルウォレット不要。

---

## はじめに

### 1. Bitcoin-PoCXのビルド

```bash
# サブモジュールを含めてクローン
git clone --recursive https://github.com/PoC-Consortium/bitcoin-pocx.git
cd bitcoin-pocx/bitcoin

# PoCXを有効にしてビルド
cmake -B build -DENABLE_POCX=ON
cmake --build build
```

**詳細**: リポジトリルートの`CLAUDE.md`を参照

### 2. ノードの実行

**ノードのみ**:
```bash
./build/bin/bitcoind
# または
./build/bin/bitcoin-qt
```

**マイニング用**（外部マイナー用のRPCアクセスを有効化）:
```bash
./build/bin/bitcoind -miningserver
# または
./build/bin/bitcoin-qt -server -miningserver
```

**詳細**: [第6章: ネットワークパラメータ](6-network-parameters.md)

### 3. プロットファイルの生成

`pocx_plotter`（リファレンス実装）を使用してPoCX形式のプロットファイルを生成。

**詳細**: [第2章: プロット形式](2-plot-format.md)

### 4. マイニングのセットアップ

`pocx_miner`（リファレンス実装）を使用してノードのRPCインターフェースに接続。

**詳細**: [第7章: RPCリファレンス](7-rpc-reference.md)および[第8章: ウォレットガイド](8-wallet-guide.md)

---

## 帰属

### プロット形式

POC2形式（Burstcoin）に基づき、以下の強化を実施:
- セキュリティ欠陥の修正（XOR-transpose圧縮攻撃）
- スケーラブルなProof-of-Work
- SIMD最適化レイアウト
- シード機能

### ソースプロジェクト

- **pocx_miner**: [scavenger](https://github.com/PoC-Consortium/scavenger)ベースのリファレンス実装
- **pocx_plotter**: [engraver](https://github.com/PoC-Consortium/engraver)ベースのリファレンス実装

**完全な帰属**: [第2章: プロット形式](2-plot-format.md)

---

## 技術仕様概要

- **ブロック時間**: 120秒（メインネット）、1秒（regtest）
- **ブロック報酬**: 初期10 BTC、1050000ブロックごとに半減（約4年）
- **総供給量**: 約2100万BTC（Bitcoinと同じ）
- **将来許容範囲**: 15秒（最大15秒先のブロックを受け入れ）
- **クロック警告**: 10秒（時間ずれについて運用者に警告）
- **割り当て遅延**: 30ブロック（約1時間）
- **取り消し遅延**: 720ブロック（約24時間）
- **アドレス形式**: PoCXマイニング操作とフォージング割り当てにはP2WPKH（bech32、pocx1q...）のみ

---

## コード構成

**Bitcoin Coreの変更**: コアファイルへの最小限の変更、`#ifdef ENABLE_POCX`でフィーチャーフラグ管理

**新しいPoCX実装**: `src/pocx/`ディレクトリに分離

---

## セキュリティ考慮事項

### タイミングセキュリティ

- 15秒の将来許容範囲がネットワーク断片化を防止
- 10秒の警告しきい値が運用者にクロックドリフトを警告
- 防御的フォージングがクロック操作へのインセンティブを排除
- タイムベンディングがタイミング分散の影響を低減

**詳細**: [第5章: タイミングセキュリティ](5-timing-security.md)

### 割り当てセキュリティ

- OP_RETURN専用設計（UTXO操作なし）
- トランザクション署名がプロット所有権を証明
- アクティベーション遅延が急速な状態操作を防止
- すべての状態変更に対する再編成安全な取り消しデータ

**詳細**: [第4章: フォージング割り当て](4-forging-assignments.md)

### コンセンサスセキュリティ

- 署名はブロックハッシュから除外（改ざん防止）
- 署名サイズの制限（DoS防止）
- 圧縮境界の検証（弱い証明を防止）
- 毎ブロックの難易度調整（容量変化に対応）

**詳細**: [第3章: コンセンサスとマイニング](3-consensus-and-mining.md)

---

## ネットワークステータス

**メインネット**: 未ローンチ
**テストネット**: テスト用に利用可能
**Regtest**: 開発用に完全機能

**ジェネシスブロックパラメータ**: [第6章: ネットワークパラメータ](6-network-parameters.md)

---

## 次のステップ

**PoCXを理解するには**: [第2章: プロット形式](2-plot-format.md)に進み、プロットファイル構造と形式の進化を学習。

**マイニングセットアップには**: [第7章: RPCリファレンス](7-rpc-reference.md)に移動して統合の詳細を確認。

**ノード運用には**: [第6章: ネットワークパラメータ](6-network-parameters.md)で設定オプションを確認。

---

[目次](index.md) | [次へ: プロット形式 →](2-plot-format.md)
