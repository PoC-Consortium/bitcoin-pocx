# Bitcoin-PoCX: Bitcoin Core向けのエネルギー効率の高いコンセンサス

**バージョン**: 2.0 ドラフト
**日付**: 2025年12月
**組織**: Proof of Capacity Consortium

---

## 概要

BitcoinのProof-of-Work（PoW）コンセンサスは堅牢なセキュリティを提供しますが、継続的なリアルタイムハッシュ計算により相当なエネルギーを消費します。本稿では、PoWをProof of Capacity（PoC）で置き換えるBitcoinフォークであるBitcoin-PoCXを提案します。PoCでは、マイナーはプロット時にディスクに保存された大量のハッシュを事前計算し、その後継続的なハッシングの代わりに軽量なルックアップを実行してマイニングします。計算をマイニングフェーズから一回限りのプロットフェーズに移行することで、Bitcoin-PoCXはエネルギー消費を大幅に削減しながら、コモディティハードウェアでのマイニングを可能にし、参入障壁を下げ、ASIC支配のPoWに固有の中央集権化圧力を軽減します。これらはすべて、Bitcoinのセキュリティ前提と経済的動作を維持しながら実現されます。

本実装はいくつかの重要なイノベーションを導入します:
(1) 既存のPoCシステムにおける既知のすべての時間-メモリトレードオフ攻撃を排除するハード化されたプロット形式により、効果的なマイニングパワーがコミットされたストレージ容量に厳密に比例することを保証;
(2) デッドライン分布を指数分布からカイ二乗分布に変換するタイムベンディングアルゴリズムにより、平均を変更せずにブロック時間の分散を削減;
(3) 非カストディアルなプールマイニングを可能にするOP_RETURNベースのフォージング割り当てメカニズム;
(4) ハードウェアの改善に伴い長期的なセキュリティマージンを維持するため、半減スケジュールに合わせてプロット生成難易度を増加させる動的圧縮スケーリング。

Bitcoin-PoCXは、最小限のフィーチャーフラグ付き変更を通じてBitcoin Coreのアーキテクチャを維持し、PoCロジックを既存のコンセンサスコードから分離します。システムは120秒のブロック間隔をターゲットとし、ブロック報酬を10 BTCに調整することでBitcoinの金融政策を保持します。削減された報酬はブロック頻度の5倍増加を相殺し、長期的な発行率をBitcoinのオリジナルスケジュールに合わせ、約2100万の最大供給量を維持します。

---

## 1. はじめに

### 1.1 動機

BitcoinのProof-of-Work（PoW）コンセンサスは10年以上にわたり安全であることが証明されていますが、大きなコストを伴います：マイナーは継続的に計算リソースを消費する必要があり、高いエネルギー消費をもたらします。効率性の懸念を超えて、より広範な動機があります：参入障壁を下げながらセキュリティを維持する代替コンセンサスメカニズムの探求です。PoCは、コモディティストレージハードウェアを持つ事実上誰もが効果的にマイニングできるようにし、ASIC支配のPoWマイニングに見られる中央集権化圧力を軽減します。

Proof of Capacity（PoC）は、継続的な計算ではなくストレージコミットメントからマイニングパワーを導出することでこれを達成します。マイナーはディスクに保存された大量のハッシュ、つまりプロットを一回限りのプロットフェーズで事前計算します。マイニングはその後軽量なルックアップで構成され、リソースベースのコンセンサスのセキュリティ前提を維持しながらエネルギー使用を大幅に削減します。

### 1.2 Bitcoin Coreとの統合

Bitcoin-PoCXは、新しいブロックチェーンを作成するのではなく、PoCコンセンサスをBitcoin Coreに統合します。このアプローチは、Bitcoin Coreの実績あるセキュリティ、成熟したネットワーキングスタック、広く採用されたツールを活用しながら、変更を最小限かつフィーチャーフラグ付きに保ちます。PoCロジックは既存のコンセンサスコードから分離され、コア機能（ブロック検証、ウォレット操作、トランザクション形式）がほぼ変更されないことを保証します。

### 1.3 設計目標

**セキュリティ**: Bitcoin同等の堅牢性を維持;攻撃には多数のストレージ容量が必要。

**効率性**: 継続的な計算負荷をディスクI/Oレベルに削減。

**アクセシビリティ**: コモディティハードウェアでのマイニングを可能にし、参入障壁を低減。

**最小限の統合**: 最小限の変更フットプリントでPoCコンセンサスを導入。

---

## 2. 背景: Proof of Capacity

### 2.1 歴史

Proof of Capacity（PoC）は、2014年にBurstcoinによってProof-of-Work（PoW）のエネルギー効率の良い代替として導入されました。Burstcoinは、マイニングパワーが継続的なリアルタイムハッシングではなく、コミットされたストレージから導出できることを実証しました：マイナーは大規模なデータセット（「プロット」）を一度事前計算し、その小さな固定部分を読み取ることでマイニングしました。

初期のPoC実装は概念の実行可能性を証明しましたが、プロット形式と暗号構造がセキュリティにとって重要であることも明らかにしました。いくつかの時間-メモリトレードオフにより、攻撃者は正直な参加者よりも少ないストレージで効果的にマイニングできました。これは、PoCセキュリティが単にストレージをリソースとして使用することではなく、プロット設計にかかっていることを強調しました。

Burstcoinの遺産はPoCを実用的なコンセンサスメカニズムとして確立し、PoCXが構築する基盤を提供しました。

### 2.2 コア概念

PoCマイニングは、ディスクに保存された大規模な事前計算済みプロットファイルに基づいています。これらのプロットには「凍結された計算」が含まれます：高価なハッシングはプロット時に一度実行され、マイニングは軽量なディスク読み取りと単純な検証で構成されます。コア要素は以下を含みます：

**ノンス:**
プロットデータの基本単位。各ノンスはマイナーのアドレスとノンスインデックスからShabal256を介して生成された4096個のスクープ（合計256 KiB）を含みます。

**スクープ:**
ノンス内の64バイトセグメント。各ブロックで、ネットワークは前のブロックの生成署名に基づいてスクープインデックス（0-4095）を決定論的に選択します。ノンスごとにこのスクープのみを読み取る必要があります。

**生成署名:**
前のブロックから導出される256ビット値。スクープ選択のエントロピーを提供し、マイナーが将来のスクープインデックスを予測することを防ぎます。

**ワープ:**
4096ノンス（1 GiB）の構造的グループ。ワープは圧縮耐性プロット形式の関連単位です。

### 2.3 マイニングプロセスと品質パイプライン

PoCマイニングは、一回限りのプロットステップと軽量なブロックごとのルーチンで構成されます：

**一回限りのセットアップ:**
- プロット生成: Shabal256経由でノンスを計算しディスクに書き込み。

**ブロックごとのマイニング:**
- スクープ選択: 生成署名からスクープインデックスを決定。
- プロットスキャン: マイナーのプロット内のすべてのノンスからそのスクープを読み取り。

**品質パイプライン:**
- 生品質: Shabal256Liteを使用して各スクープを生成署名とハッシュし、64ビットの品質値を取得（低いほど良い）。
- デッドライン: ベースターゲット（ネットワークがターゲットブロック間隔に到達することを保証する難易度調整パラメータ）を使用して品質をデッドラインに変換: `deadline = quality / base_target`
- ベンドされたデッドライン: タイムベンディング変換を適用して予想ブロック時間を維持しながら分散を削減。

**ブロックフォージング:**
最短の（ベンドされた）デッドラインを持つマイナーがその時間が経過すると次のブロックをフォージ。

PoWとは異なり、ほぼすべての計算はプロット時に発生し、アクティブなマイニングは主にディスクバウンドで非常に低電力です。

### 2.4 以前のシステムの既知の脆弱性

**POC1分布の欠陥:**
オリジナルのBurstcoin POC1形式には構造的バイアスがありました：低インデックスのスクープは高インデックスのスクープよりもオンザフライで再計算するのが大幅に安価でした。これにより非均一な時間-メモリトレードオフが導入され、攻撃者はそれらのスクープに必要なストレージを削減でき、すべての事前計算済みデータが等しく高価であるという前提を破りました。

**XOR圧縮攻撃（POC2）:**
POC2では、攻撃者は8192ノンスの任意のセットを取り、4096ノンスの2つのブロック（AとB）に分割できます。両方のブロックを保存する代わりに、攻撃者は導出された構造のみを保存します: `A ⊕ transpose(B)`、ここで転置はスクープとノンスのインデックスを交換します—ブロックBのノンスNのスクープSはスクープNのノンスSになります。

マイニング中にノンスNのスクープSが必要なとき、攻撃者は以下で再構築します:
1. 位置(S, N)の保存されたXOR値を読み取り
2. ブロックAからノンスNを計算してスクープSを取得
3. ブロックBからノンスSを計算して転置されたスクープNを取得
4. 3つの値すべてをXORして元の64バイトスクープを復元

これはストレージを50%削減し、ルックアップごとに2つのノンス計算のみを必要とします—完全な事前計算を強制するために必要なしきい値をはるかに下回るコストです。攻撃が実行可能なのは、行（1つのノンス、4096スクープ）の計算が安価であるのに対し、列（4096ノンスにわたる単一のスクープ）の計算にはすべてのノンスの再生成が必要になるためです。転置構造はこの不均衡を露呈します。

これは、このような構造的な再結合を防ぎ、基礎となる時間-メモリトレードオフを除去するプロット形式の必要性を実証しました。セクション3.3では、PoCXがこの弱点にどのように対処し解決するかを説明します。

### 2.5 PoCXへの移行

以前のPoCシステムの制限は、安全で公正かつ分散化されたストレージマイニングが、慎重に設計されたプロット構造に依存することを明確にしました。Bitcoin-PoCXは、ハード化されたプロット形式、改善されたデッドライン分布、および分散化されたプールマイニングのメカニズムでこれらの問題に対処します—次のセクションで説明します。

---

## 3. PoCXプロット形式

### 3.1 ベースノンス構築

ノンスは、3つのパラメータから決定論的に導出される256 KiBデータ構造です：20バイトのアドレスペイロード、32バイトのシード、および64ビットのノンスインデックス。

構築は、これらの入力を組み合わせてShabal256でハッシュし、初期ハッシュを生成することから始まります。このハッシュは反復的な拡張プロセスの開始点として機能します：Shabal256は繰り返し適用され、各ステップは以前に生成されたデータに依存し、256 KiBバッファ全体が埋まるまで続きます。この連鎖プロセスはプロット時に実行される計算作業を表します。

最終拡散ステップは完成したバッファをハッシュし、結果をすべてのバイトにわたってXORします。これにより、完全なバッファが計算され、マイナーが計算をショートカットできないことが保証されます。その後、POC2シャッフルが適用され、各スクープの下半分と上半分を交換して、すべてのスクープが同等の計算労力を必要とすることを保証します。

最終的なノンスは各64バイトの4096スクープで構成され、マイニングで使用される基本単位を形成します。

### 3.2 SIMD整列プロットレイアウト

最新のハードウェアでスループットを最大化するために、PoCXはベクトル化処理を容易にするためにノンスデータをディスク上で編成します。各ノンスを順番に保存する代わりに、PoCXは複数の連続ノンスにわたる対応する4バイトワードを連続して整列させます。これにより、単一のメモリフェッチがすべてのSIMDレーンにデータを供給でき、キャッシュミスを最小化し、スキャッター・ギャザーのオーバーヘッドを排除します。

```
従来のレイアウト:
Nonce0: [W0][W1][W2][W3]...
Nonce1: [W0][W1][W2][W3]...
Nonce2: [W0][W1][W2][W3]...

PoCX SIMDレイアウト:
Word0: [N0][N1][N2]...[N15]
Word1: [N0][N1][N2]...[N15]
Word2: [N0][N1][N2]...[N15]
```

このレイアウトはCPUとGPUマイナーの両方に利益をもたらし、コンセンサス検証用の単純なスカラーアクセスパターンを維持しながら、高スループットの並列化されたスクープ評価を可能にします。マイニングがCPU計算ではなくストレージ帯域幅によって制限されることを保証し、Proof of Capacityの低電力特性を維持します。

### 3.3 ワープ構造とXOR-Transposeエンコーディング

ワープはPoCXの基本的なストレージ単位であり、4096ノンス（1 GiB）で構成されます。非圧縮形式（X0と呼ばれる）には、セクション3.1の構築で生成されたベースノンスが正確に含まれます。

**XOR-Transposeエンコーディング（X1）**

以前のPoCシステムに存在した構造的な時間-メモリトレードオフを除去するために、PoCXはX0ワープのペアにXOR-transposeエンコーディングを適用することで、ハード化されたマイニング形式X1を導出します。

X1ワープでノンスNのスクープSを構築するには:

1. 最初のX0ワープからノンスNのスクープSを取得（直接位置）
2. 2番目のX0ワープからノンスSのスクープNを取得（転置位置）
3. 2つの64バイト値をXORしてX1スクープを取得

転置ステップはスクープとノンスのインデックスを交換します。行がスクープ、列がノンスを表す行列として見ると、最初のワープの位置(S, N)の要素と2番目のワープの位置(N, S)の要素を組み合わせます。

**なぜこれが圧縮攻撃面を排除するのか**

XOR-transposeは各スクープを、基礎となるX0データの行全体と列全体に連結させます。単一のX1スクープを復元するには、4096個すべてのスクープインデックスにまたがるデータへのアクセスが必要です。欠落データを計算しようとすると、単一のノンスではなく4096個の完全なノンスを再生成する必要があり、POC2のXOR攻撃（セクション2.4）で悪用された非対称コスト構造が除去されます。

結果として、完全なX1ワープを保存することがマイナーにとって唯一の計算上実行可能な戦略となり、以前の設計で悪用された時間-メモリトレードオフを閉じます。

### 3.4 ディスクレイアウト

PoCXプロットファイルは多くの連続したX1ワープで構成されます。マイニング中の運用効率を最大化するために、各ファイル内のデータはスクープごとに編成されます：すべてのワープからのスクープ0データが順番に保存され、続いてすべてのスクープ1データ、スクープ4095まで続きます。

この**スクープ順次順序付け**により、マイナーは選択されたスクープに必要な完全なデータを単一の順次ディスクアクセスで読み取ることができ、シーク時間を最小化し、コモディティストレージデバイスでのスループットを最大化します。

セクション3.3のXOR-transposeエンコーディングと組み合わせて、このレイアウトはファイルが**構造的にハード化**され**運用上効率的**であることを保証します：順次スクープ順序付けは最適なディスクI/Oをサポートし、SIMD整列メモリレイアウト（セクション3.2参照）は高スループットの並列化されたスクープ評価を可能にします。

### 3.5 Proof-of-Workスケーリング（Xn）

PoCXは、進化するハードウェア性能に適応するために、Xnで示されるスケーリングレベルの概念を通じてスケーラブルな事前計算を実装します。ベースラインX1形式は最初のXOR-transposeハード化ワープ構造を表します。

各スケーリングレベルXnは、X1に対して指数関数的にワープに埋め込まれるProof-of-Workを増加させます：レベルXnで必要な作業はX1の2^(n-1)倍です。XnからXn+1への移行は、隣接するワープのペアにわたるXORを適用することと運用上同等であり、基礎となるプロットサイズを変更せずにより多くのProof-of-Workを段階的に埋め込みます。

低いスケーリングレベルで作成された既存のプロットファイルはマイニングに使用できますが、埋め込まれたProof-of-Workが低いことを反映して、ブロック生成への貢献は比例的に少なくなります。このメカニズムにより、PoCXプロットは時間の経過とともに安全で柔軟かつ経済的にバランスが取れた状態を維持します。

### 3.6 シード機能

シードパラメータは、手動の調整なしでアドレスごとに複数の重複しないプロットを可能にします。

**問題（POC2）**: マイナーは重複を避けるためにプロットファイル間でノンス範囲を手動で追跡する必要がありました。重複するノンスはマイニングパワーを増加させずにストレージを浪費します。

**解決策**: 各`(address, seed)`ペアは独立したキースペースを定義します。異なるシードを持つプロットは、ノンス範囲に関係なく重複しません。マイナーは調整なしで自由にプロットを作成できます。

---

## 4. Proof of Capacityコンセンサス

PoCXは、ストレージバウンドの証明メカニズムでBitcoinの中本コンセンサスを拡張します。エネルギーを繰り返しハッシングに費やす代わりに、マイナーは大量の事前計算済みデータ（プロット）をディスクにコミットします。ブロック生成中、彼らはこのデータの小さく予測不可能な部分を見つけて証明に変換する必要があります。予想時間ウィンドウ内で最良の証明を提供するマイナーが次のブロックをフォージする権利を獲得します。

本章では、PoCXがブロックメタデータをどのように構造化し、予測不可能性を導出し、静的ストレージを安全で低分散のコンセンサスメカニズムに変換するかを説明します。

### 4.1 ブロック構造

PoCXは、容量ベースのマイニングに必要な追加のコンセンサスフィールドで馴染みのあるBitcoinスタイルのブロックヘッダーを保持します。これらのフィールドは、ブロックをマイナーの保存されたプロット、ネットワークの難易度、および各マイニングチャレンジを定義する暗号エントロピーに結び付けます。

高レベルでは、PoCXブロックは以下を含みます：ブロック高さ（コンテキストフリー検証を簡素化するために明示的に記録）；生成署名（各ブロックをその前任者にリンクする新鮮なエントロピーのソース）；ベースターゲット（逆形式のネットワーク難易度を表す、高い値はより簡単なマイニングに対応）；PoCX証明（マイナーのプロット、プロット時に使用された圧縮レベル、選択されたノンス、およびそれから導出された品質を識別）；および署名キーと署名（ブロックをフォージするために使用された容量の制御を証明、または割り当てられたフォージングキーの制御を証明）。

証明は、バリデータがチャレンジを再計算し、選択されたスクープを検証し、結果の品質を確認するために必要なすべてのコンセンサス関連情報を埋め込みます。ブロック構造を再設計するのではなく拡張することで、PoCXは根本的に異なるマイニング作業のソースを可能にしながら、Bitcoinと概念的に整合したままです。

### 4.2 生成署名チェーン

生成署名は、安全なProof of Capacityマイニングに必要な予測不可能性を提供します。各ブロックは前のブロックの署名と署名者からその生成署名を導出し、マイナーが将来のチャレンジを予測したり有利なプロット領域を事前計算したりすることを防ぎます:

`generationSignature[n] = SHA256(generationSignature[n-1] || miner_pubkey[n-1])`

これは、暗号学的に強力なマイナー依存のエントロピー値のシーケンスを生成します。マイナーの公開鍵は前のブロックが公開されるまで不明であるため、参加者は将来のスクープ選択を予測できません。これにより、選択的な事前計算や戦略的なプロット作成が防止され、すべてのブロックが真に新鮮なマイニング作業を導入することが保証されます。

### 4.3 フォージングプロセス

PoCXでのマイニングは、保存されたデータを生成署名によって完全に駆動される証明に変換することで構成されます。プロセスは決定論的ですが、署名の予測不可能性により、マイナーは事前に準備できず、保存されたプロットに繰り返しアクセスする必要があります。

**チャレンジ導出（スクープ選択）:** マイナーは現在の生成署名とブロック高さをハッシュして、0-4095の範囲のスクープインデックスを取得します。このインデックスは、保存された各ノンスのどの64バイトセグメントが証明に参加するかを決定します。生成署名は前のブロックの署名者に依存するため、スクープ選択はブロック公開の瞬間にのみ判明します。

**証明評価（品質計算）:** プロット内の各ノンスについて、マイナーは選択されたスクープを取得し、生成署名と一緒にハッシュして品質を取得します—その大きさがマイナーの競争力を決定する64ビット値。低い品質はより良い証明に対応します。

**デッドライン形成（タイムベンディング）:** 生のデッドラインは品質に比例し、ベースターゲットに反比例します。レガシーPoCデザインでは、これらのデッドラインは高度に歪んだ指数分布に従い、追加のセキュリティを提供しない長いテール遅延を生成しました。PoCXはタイムベンディング（セクション4.4）を使用して生のデッドラインを変換し、分散を削減して予測可能なブロック間隔を保証します。ベンドされたデッドラインが経過すると、マイナーは証明を埋め込み、有効なフォージングキーで署名することでブロックをフォージします。

### 4.4 タイムベンディング

Proof of Capacityは指数分布されたデッドラインを生成します。短い期間（通常は数十秒）の後、すべてのマイナーは既に最良の証明を識別しており、追加の待機時間はセキュリティではなく遅延のみに貢献します。

タイムベンディングは立方根変換を適用することで分布を再形成します:

`deadline_bended = scale × (quality / base_target)^(1/3)`

スケールファクターは予想ブロック時間（120秒）を維持しながら分散を劇的に削減します。短いデッドラインは拡張され、ブロック伝播とネットワーク安全性を改善します。長いデッドラインは圧縮され、外れ値がチェーンを遅らせることを防ぎます。

![ブロック時間分布](blocktime_distributions.svg)

タイムベンディングは基礎となる証明の情報内容を維持します。マイナー間の競争力を変更しません；予想されるブロック間隔をよりスムーズで予測可能にするために待機時間のみを再配分します。実装は、すべてのプラットフォームで決定論的な結果を保証するために固定小数点演算（Q42形式）と256ビット整数を使用します。

### 4.5 難易度調整

PoCXはベースターゲット（逆難易度メジャー）を使用してブロック生成を規制します。予想ブロック時間は比率`quality / base_target`に比例するため、ベースターゲットを増加させるとブロック作成が加速し、減少させるとチェーンが減速します。

難易度は、最近のブロック間の測定時間をターゲット間隔と比較して毎ブロック調整されます。この頻繁な調整は、ストレージ容量がよりゆっくり変化するBitcoinのハッシュパワーとは異なり、迅速に追加または削除できるため必要です。

調整は2つのガイド制約に従います：**段階性**—ブロックごとの変更は制限され（最大±20%）、振動や操作を回避；**ハード化**—ベースターゲットはそのジェネシス値を超えることができず、ネットワークが元のセキュリティ前提を下回る難易度に低下することを防ぎます。

### 4.6 ブロック有効性

PoCXのブロックは、コンセンサス状態と一致する検証可能なストレージ由来の証明を提示するときに有効です。バリデータは独立してスクープ選択を再計算し、送信されたノンスとプロットメタデータから期待される品質を導出し、タイムベンディング変換を適用し、マイナーが宣言された時刻にブロックをフォージする資格があったことを確認します。

具体的には、有効なブロックは以下を必要とします：親ブロックからデッドラインが経過していること；送信された品質が証明の計算された品質と一致すること；スケーリングレベルがネットワーク最小を満たすこと；生成署名が期待値と一致すること；ベースターゲットが期待値と一致すること；ブロック署名が有効な署名者からのものであること；およびcoinbaseが有効な署名者のアドレスに支払うこと。

---

## 5. フォージング割り当て

### 5.1 動機

フォージング割り当ては、プロットの所有権を放棄することなく、プロット所有者がブロックフォージング権限を委譲することを可能にします。このメカニズムは、PoCXのセキュリティ保証を維持しながら、プールマイニングとコールドストレージセットアップを可能にします。

プールマイニングでは、プロット所有者はプールが自分たちの代わりにブロックをフォージすることを許可できます。プールはブロックを組み立てて報酬を分配しますが、プロット自体のカストディを得ることはありません。委譲はいつでも取り消し可能であり、プロット所有者は再プロットせずにプールを離れたり設定を変更したりする自由を維持します。

割り当てはまた、コールドキーとホットキーのクリーンな分離をサポートします。プロットを制御する秘密鍵はオフラインのまま維持でき、別のフォージングキー（オンラインマシンに保存）がブロックを生成します。フォージングキーの侵害は、所有権ではなくフォージング権限のみを侵害します。プロットは安全なままで、割り当ては取り消し可能であり、セキュリティギャップを即座に閉じます。

したがって、フォージング割り当ては、保存された容量の制御を仲介者に移譲してはならないという原則を維持しながら、運用上の柔軟性を提供します。

### 5.2 割り当てプロトコル

割り当ては、UTXOセットの不必要な成長を避けるためにOP_RETURNトランザクションを通じて宣言されます。割り当てトランザクションは、プロットアドレスと、そのプロットの容量を使用してブロックを生成する権限を持つフォージングアドレスを指定します。取り消しトランザクションにはプロットアドレスのみが含まれます。どちらの場合も、プロット所有者はトランザクションの支出入力に署名することで制御を証明します。

各割り当ては、明確に定義された状態のシーケンス（UNASSIGNED、ASSIGNING、ASSIGNED、REVOKING、REVOKED）を通じて進行します。割り当てトランザクションが確認されると、システムは短いアクティベーションフェーズに入ります。この遅延（30ブロック、約1時間）は、ブロックレース中の安定性を確保し、フォージングIDの敵対的な急速な切り替えを防ぎます。このアクティベーション期間が終了すると、割り当てはアクティブになり、プロット所有者が取り消しを発行するまでそのまま維持されます。

取り消しは720ブロック（約1日）の長い遅延期間に移行します。この期間中、以前のフォージングアドレスはアクティブなままです。この長い遅延は、プールに運用上の安定性を提供し、戦略的な「割り当てホッピング」を防ぎ、インフラストラクチャプロバイダーが効率的に運用するのに十分な確実性を与えます。取り消し遅延が終了すると、取り消しが完了し、プロット所有者は新しいフォージングキーを指定する自由を得ます。

割り当て状態は、UTXOセットと並行したコンセンサスレイヤー構造で維持され、チェーン再編成の安全な処理のための取り消しデータをサポートします。

### 5.3 検証ルール

すべてのブロックについて、バリデータは有効な署名者（ブロックに署名してcoinbase報酬を受け取る必要があるアドレス）を決定します。この署名者はブロックの高さでの割り当て状態にのみ依存します。

割り当てが存在しないか、割り当てがまだアクティベーションフェーズを完了していない場合、プロット所有者が有効な署名者のままです。割り当てがアクティブになると、割り当てられたフォージングアドレスが署名する必要があります。取り消し中、フォージングアドレスは取り消し遅延が終了するまで署名を続けます。その後のみ、権限がプロット所有者に戻ります。

バリデータは、ブロック署名が有効な署名者によって生成されること、coinbaseが同じアドレスに支払うこと、およびすべての遷移が規定のアクティベーションと取り消し遅延に従うことを強制します。プロット所有者のみが割り当てを作成または取り消しできます；フォージングキーは自身の権限を変更または拡張できません。

したがって、フォージング割り当ては信頼なしに柔軟な委譲を導入します。基礎となる容量の所有権は常にプロット所有者に暗号学的にアンカーされたままであり、フォージング権限は運用ニーズの変化に応じて委譲、ローテーション、または取り消しが可能です。

---

## 6. 動的スケーリング

ハードウェアが進化するにつれて、プロットの計算コストはディスクから事前計算済み作業を読み取るコストに対して減少します。対策なしでは、攻撃者は最終的に、保存された作業を読み取るマイナーよりも速くオンザフライで証明を生成でき、Proof of Capacityのセキュリティモデルを損ないます。

意図したセキュリティマージンを維持するために、PoCXはスケーリングスケジュールを実装します：プロットに必要な最小スケーリングレベルは時間とともに増加します。セクション3.5で説明した各スケーリングレベルXnは、プロット構造内に指数関数的により多くのProof-of-Workを埋め込み、計算が安くなっても、マイナーが相当なストレージリソースをコミットし続けることを保証します。

スケジュールはネットワークの経済的インセンティブ、特にブロック報酬の半減に合わせています。ブロックあたりの報酬が減少するにつれて、最小レベルは徐々に増加し、プロット労力とマイニングポテンシャルのバランスを維持します:

| 期間 | 年数 | 半減期 | 最小スケーリング | プロット作業倍率 |
|--------|-------|----------|-------------|---------------------|
| エポック0 | 0-4 | 0 | X1 | 2×ベースライン |
| エポック1 | 4-12 | 1-2 | X2 | 4×ベースライン |
| エポック2 | 12-28 | 3-6 | X3 | 8×ベースライン |
| エポック3 | 28-60 | 7-14 | X4 | 16×ベースライン |
| エポック4 | 60-124 | 15-30 | X5 | 32×ベースライン |
| エポック5 | 124以降 | 31以降 | X6 | 64×ベースライン |

マイナーは、オプションで現在の最小を1レベル超えるプロットを準備でき、ネットワークが次のエポックに移行するときに即時のアップグレードを回避して先を見越した計画を立てることができます。このオプションステップはブロック確率の点で追加の利点を与えません—単により滑らかな運用上の移行を可能にするだけです。

高さに対する最小スケーリングレベルを下回る証明を含むブロックは無効と見なされます。バリデータはコンセンサス検証中に証明で宣言されたスケーリングレベルを現在のネットワーク要件と照合し、参加するすべてのマイナーが進化するセキュリティ期待を満たすことを保証します。

---

## 7. マイニングアーキテクチャ

PoCXはコンセンサスクリティカルな操作をマイニングのリソース集約的なタスクから分離し、セキュリティと効率の両方を可能にします。ノードはブロックチェーンを維持し、ブロックを検証し、mempoolを管理し、RPCインターフェースを公開します。外部マイナーはプロットストレージ、スクープ読み取り、品質計算、およびデッドライン管理を処理します。この分離により、コンセンサスロジックはシンプルで監査可能に保たれ、マイナーはディスクスループットを最適化できます。

### 7.1 マイニングRPCインターフェース

マイナーは最小限のRPC呼び出しセットを通じてノードと対話します。get_mining_info RPCは現在のブロック高さ、生成署名、ベースターゲット、ターゲットデッドライン、および許容可能なプロットスケーリングレベルの範囲を提供します。この情報を使用して、マイナーは候補ノンスを計算します。submit_nonce RPCにより、マイナーはプロット識別子、ノンスインデックス、スケーリングレベル、およびマイナーアカウントを含む提案された解を送信できます。ノードは送信を評価し、証明が有効な場合は計算されたデッドラインで応答します。

### 7.2 フォージングスケジューラ

ノードはフォージングスケジューラを維持し、受信した送信を追跡して各ブロック高さの最良の解のみを保持します。送信されたノンスは、送信フラッディングやサービス拒否攻撃に対する組み込みの保護でキューに入れられます。スケジューラは計算されたデッドラインが経過するか、優れた解が到着するまで待機し、その時点でブロックを組み立て、有効なフォージングキーで署名し、ネットワークに公開します。

### 7.3 防御的フォージング

タイミング攻撃やクロック操作へのインセンティブを防ぐために、PoCXは防御的フォージングを実装します。同じ高さで競合ブロックが到着すると、スケジューラはローカル解と新しいブロックを比較します。ローカル品質が優れていれば、ノードは元のデッドラインを待つのではなく即座にフォージします。これにより、マイナーは単にローカルクロックを調整するだけでは優位性を得られないことが保証されます；最良の解が常に勝ち、公平性とネットワークセキュリティが維持されます。

---

## 8. セキュリティ分析

### 8.1 脅威モデル

PoCXは、相当だが限定的な能力を持つ敵対者をモデル化します。攻撃者は、無効なトランザクション、不正なブロック、または偽造された証明でネットワークを過負荷にして検証パスにストレステストを行おうとする可能性があります。彼らはローカルクロックを自由に操作し、タイムスタンプ処理、難易度調整ダイナミクス、または再編成ルールなどのコンセンサス動作のエッジケースを悪用しようとする可能性があります。敵対者はまた、ターゲットチェーンフォークを通じて履歴を書き換える機会を探ることが予想されます。

モデルは、単一の当事者がネットワーク総ストレージ容量の過半数を制御していないことを前提としています。リソースベースのコンセンサスメカニズムと同様に、51%容量攻撃者はチェーンを一方的に再編成できます；この基本的な制限はPoCXに固有のものではありません。PoCXはまた、攻撃者が正直なマイナーがディスクから読み取るよりも速くプロットデータを計算できないことを前提としています。スケーリングスケジュール（セクション6）により、セキュリティに必要な計算ギャップはハードウェアの改善とともに時間とともに増加します。

以下のセクションでは、各主要な攻撃クラスを詳細に検討し、PoCXに組み込まれた対策を説明します。

### 8.2 容量攻撃

PoWと同様に、過半数の容量を持つ攻撃者は履歴を書き換えることができます（51%攻撃）。これを達成するには、正直なネットワークよりも大きな物理ストレージフットプリントを取得する必要があります—高価で物流上困難な取り組みです。ハードウェアが取得されると、運用コストは低くなりますが、初期投資は正直に振る舞う強い経済的インセンティブを生み出します：チェーンを損なうことは、攻撃者自身の資産ベースの価値を損なうことになります。

PoCはまた、PoSに関連するnothing-at-stake問題を回避します。マイナーは複数の競合フォークに対してプロットをスキャンできますが、各スキャンは実際の時間を消費します—通常はチェーンあたり数十秒のオーダーです。120秒のブロック間隔では、これは本質的にマルチフォークマイニングを制限し、多くのフォークを同時にマイニングしようとするとすべてのパフォーマンスが低下します。フォークマイニングはコストレスではありません；I/Oスループットによって根本的に制約されます。

将来のハードウェアがほぼ瞬時のプロットスキャン（例：高速SSD）を可能にしたとしても、攻撃者はネットワーク容量の過半数を制御するための相当な物理リソース要件に直面し、51%スタイルの攻撃は高価で物流上困難になります。

最後に、容量攻撃はハッシュパワー攻撃よりもレンタルがはるかに困難です。GPUコンピューティングはオンデマンドで取得し、任意のPoWチェーンに即座にリダイレクトできます。対照的に、PoCは物理ハードウェア、時間のかかるプロット作成、および継続的なI/O操作を必要とします。これらの制約により、短期的で日和見的な攻撃ははるかに実行不可能になります。

### 8.3 タイミング攻撃

タイミングはProof of Capacityにおいて、Proof of Workよりも重要な役割を果たします。PoWでは、タイムスタンプは主に難易度調整に影響します；PoCでは、マイナーのデッドラインが経過したかどうか、したがってブロックがフォージに適格かどうかを決定します。デッドラインは親ブロックのタイムスタンプに対して測定されますが、ノードのローカルクロックは受信ブロックが将来に遠すぎるかどうかを判断するために使用されます。このため、PoCXは厳しいタイムスタンプ許容範囲を強制します：ブロックはノードのローカルクロックから15秒以上逸脱してはなりません（Bitcoinの2時間ウィンドウと比較して）。この制限は両方向に機能します—将来に遠すぎるブロックは拒否され、遅いクロックを持つノードは有効な受信ブロックを誤って拒否する可能性があります。

したがって、ノードはNTPまたは同等の時間ソースを使用してクロックを同期する必要があります。PoCXは、攻撃者が認知されたネットワーク時間を操作することを防ぐために、意図的にネットワーク内部の時間ソースへの依存を回避します。ノードは自身のドリフトを監視し、ローカルクロックが最近のブロックタイムスタンプから乖離し始めると警告を発します。

クロック加速（わずかに早くフォージするために高速ローカルクロックを実行すること）はわずかな利益しか提供しません。許容される許容範囲内では、防御的フォージング（セクション7.3）により、より良い解を持つマイナーは劣った早期ブロックを見ると即座に公開することが保証されます。高速クロックは、マイナーが既に勝っている解を数秒早く公開するのに役立つだけです；劣った証明を勝つものに変換することはできません。

タイムスタンプを介した難易度操作の試みは、ブロックあたり±20%の調整キャップと24ブロックのローリングウィンドウによって制限され、マイナーが短期的なタイミングゲームを通じて難易度に意味のある影響を与えることを防ぎます。

### 8.4 時間-メモリトレードオフ攻撃

時間-メモリトレードオフは、オンデマンドでプロットの一部を再計算することでストレージ要件を削減しようとします。以前のProof of Capacityシステムはこのような攻撃に脆弱でした、特にPOC1のスクープ不均衡の欠陥とPOC2のXOR-transpose圧縮攻撃（セクション2.4）です。両方とも、プロットデータの特定の部分を再生成するコストの非対称性を悪用し、敵対者がわずかな計算ペナルティのみを支払いながらストレージを削減できるようにしました。また、PoC2の代替プロット形式も同様のTMTO弱点に苦しんでいます；顕著な例はChiaで、そのプロット形式は4倍以上の任意の係数で削減できます。

PoCXはそのノンス構築とワープ形式を通じてこれらの攻撃面を完全に除去します。各ノンス内で、最終拡散ステップは完全に計算されたバッファをハッシュし、結果をすべてのバイトにわたってXORし、バッファのすべての部分が他のすべての部分に依存し、ショートカットできないことを保証します。その後、POC2シャッフルが各スクープの下半分と上半分を交換し、任意のスクープを復元する計算コストを均等化します。

PoCXはさらに、ハード化されたX1形式を導出することでPOC2 XOR-transpose圧縮攻撃を排除します。ここで各スクープは、ペアのワープにわたる直接位置と転置位置のXORです；これにより、すべてのスクープが基礎となるX0データの行全体と列全体に連結され、再構築には数千の完全なノンスが必要になり、非対称時間-メモリトレードオフが完全に除去されます。

結果として、完全なプロットを保存することがマイナーにとって唯一の計算上実行可能な戦略です。既知のショートカット（部分プロット、選択的再生成、構造化圧縮、またはハイブリッドコンピュート-ストレージアプローチ）は意味のある利点を提供しません。PoCXは、マイニングが厳密にストレージバウンドのままであり、容量が実際の物理的コミットメントを反映することを保証します。

### 8.5 割り当て攻撃

PoCXは、すべてのプロットからフォージャーへの割り当てを管理するために決定論的なステートマシンを使用します。各割り当ては明確に定義された状態（UNASSIGNED → ASSIGNING → ASSIGNED → REVOKING → REVOKED）を通じて進行し、強制されたアクティベーションと取り消し遅延があります。これにより、マイナーはシステムをだますために割り当てを瞬時に変更したり、フォージング権限を急速に切り替えたりすることができません。

すべての遷移は暗号証明（具体的には、入力UTXOに対して検証可能なプロット所有者による署名）を必要とするため、ネットワークは各割り当ての正当性を信頼できます。ステートマシンをバイパスしたり割り当てを偽造したりする試みは、コンセンサス検証中に自動的に拒否されます。リプレイ攻撃も同様に標準のBitcoinスタイルのトランザクションリプレイ保護によって防止され、すべての割り当てアクションが有効で未使用の入力に一意に結び付けられることを保証します。

ステートマシンガバナンス、強制遅延、および暗号証明の組み合わせにより、割り当てベースの不正行為は事実上不可能になります：マイナーは割り当てをハイジャックしたり、ブロックレース中に急速な再割り当てを行ったり、取り消しスケジュールを迂回したりすることができません。

### 8.6 署名セキュリティ

PoCXのブロック署名は、証明と有効なフォージングキーの間の重要なリンクとして機能し、許可されたマイナーのみが有効なブロックを生成できることを保証します。

改ざん攻撃を防ぐために、署名はブロックハッシュ計算から除外されます。これにより、検証を損なったりブロック置換攻撃を可能にしたりする可能性のある改ざん可能な署名のリスクが排除されます。

サービス拒否ベクトルを軽減するために、署名と公開鍵のサイズは固定されています（コンパクト署名用に65バイト、圧縮公開鍵用に33バイト）。これにより、攻撃者がブロックを膨張させてリソース枯渇を引き起こしたり、ネットワーク伝播を遅くしたりすることを防ぎます。

---

## 9. 実装

PoCXはBitcoin Coreへのモジュラー拡張として実装され、関連するすべてのコードは独自の専用サブディレクトリに含まれ、フィーチャーフラグを通じてアクティベートされます。この設計はオリジナルコードの整合性を維持し、PoCXをクリーンに有効または無効にでき、テスト、監査、およびアップストリーム変更との同期を簡素化します。

統合は、Proof of Capacityをサポートするために必要な本質的なポイントのみに触れます。ブロックヘッダーはPoCX固有のフィールドを含むように拡張され、コンセンサス検証は従来のBitcoinチェックと並んでストレージベースの証明を処理するように適応されました。デッドライン、スケジューリング、およびマイナー送信を管理するフォージングシステムは完全にPoCXモジュール内に含まれ、RPC拡張はマイニングと割り当て機能を外部クライアントに公開します。ユーザー向けには、ウォレットインターフェースがOP_RETURNトランザクションを通じて割り当てを管理するように強化され、新しいコンセンサス機能とのシームレスな対話を可能にします。

すべてのコンセンサスクリティカルな操作は、外部依存なしに決定論的なC++で実装され、クロスプラットフォームの一貫性を保証します。ハッシングにはShabal256が使用され、タイムベンディングと品質計算は固定小数点演算と256ビット操作に依存します。署名検証などの暗号操作は、Bitcoin Coreの既存のsecp256k1ライブラリを活用します。

このようにPoCX機能を分離することで、実装は監査可能で保守可能であり、継続的なBitcoin Core開発と完全に互換性があり、根本的に新しいストレージバウンドのコンセンサスメカニズムが、その整合性や使いやすさを損なうことなく成熟したProof-of-Workコードベースと共存できることを実証しています。

---

## 10. ネットワークパラメータ

PoCXはBitcoinのネットワークインフラストラクチャに構築され、そのチェーンパラメータフレームワークを再利用します。容量ベースのマイニング、ブロック間隔、割り当て処理、およびプロットスケーリングをサポートするために、いくつかのパラメータが拡張またはオーバーライドされました。これにはブロック時間ターゲット、初期報酬、半減スケジュール、割り当てアクティベーションと取り消し遅延、およびマジックバイト、ポート、Bech32プレフィックスなどのネットワーク識別子が含まれます。テストネットとregtest環境は、迅速な反復と低容量テストを可能にするためにこれらのパラメータをさらに調整します。

以下の表は、結果のメインネット、テストネット、およびregtest設定をまとめ、PoCXがBitcoinのコアパラメータをストレージバウンドのコンセンサスモデルにどのように適応させるかを強調しています。

### 10.1 メインネット

| パラメータ | 値 |
|-----------|-------|
| マジックバイト | `0xa7 0x3c 0x91 0x5e` |
| デフォルトポート | 8888 |
| Bech32 HRP | `pocx` |
| ブロック時間ターゲット | 120秒 |
| 初期報酬 | 10 BTC |
| 半減期間隔 | 1050000ブロック（約4年） |
| 総供給量 | 約2100万BTC |
| 割り当てアクティベーション | 30ブロック |
| 割り当て取り消し | 720ブロック |
| ローリングウィンドウ | 24ブロック |

### 10.2 テストネット

| パラメータ | 値 |
|-----------|-------|
| マジックバイト | `0x6d 0xf2 0x48 0xb3` |
| デフォルトポート | 18888 |
| Bech32 HRP | `tpocx` |
| ブロック時間ターゲット | 120秒 |
| その他のパラメータ | メインネットと同じ |

### 10.3 Regtest

| パラメータ | 値 |
|-----------|-------|
| マジックバイト | `0xfa 0xbf 0xb5 0xda` |
| デフォルトポート | 18444 |
| Bech32 HRP | `rpocx` |
| ブロック時間ターゲット | 1秒 |
| 半減期間隔 | 500ブロック |
| 割り当てアクティベーション | 4ブロック |
| 割り当て取り消し | 8ブロック |
| 低容量モード | 有効（約4 MBプロット） |

---

## 11. 関連研究

長年にわたり、いくつかのブロックチェーンおよびコンセンサスプロジェクトがストレージベースまたはハイブリッドマイニングモデルを探求してきました。PoCXはこの系譜の上に構築しながら、セキュリティ、効率、および互換性の強化を導入します。

**Burstcoin / Signum.** Burstcoinは2014年に最初の実用的なProof-of-Capacity（PoC）システムを導入し、プロット、ノンス、スクープ、およびデッドラインベースのマイニングなどのコア概念を定義しました。その後継、特にSignum（旧Burstcoin）はエコシステムを拡張し、最終的にProof-of-Commitment（PoC+）として知られるものに進化し、ストレージコミットメントとオプションのステーキングを組み合わせて有効容量に影響を与えました。PoCXはこれらのプロジェクトからストレージベースのマイニング基盤を継承しますが、ハード化されたプロット形式（XOR-transposeエンコーディング）、動的プロット作業スケーリング、デッドライン平滑化（「タイムベンディング」）、および柔軟な割り当てシステムを通じて大幅に分岐します—すべてスタンドアロンネットワークフォークを維持するのではなく、Bitcoin Coreコードベースにアンカーしています。

**Chia.** Chiaは、ディスクベースのストレージ証明とVDF（Verifiable Delay Functions）を介して強制される時間コンポーネントを組み合わせたProof of Space and Timeを実装しています。その設計は、クラシックPoCとは異なる証明再利用と新鮮なチャレンジ生成に関する特定の懸念に対処します。PoCXはその時間アンカー証明モデルを採用しません；代わりに、UTXO経済学とBitcoin由来のツールとの長期的な互換性のために最適化された、予測可能な間隔を持つストレージバウンドのコンセンサスを維持します。

**Spacemesh.** SpacemeshはDAGベース（メッシュ）ネットワークトポロジを使用したProof-of-Space-Time（PoST）スキームを提案しています。このモデルでは、参加者は単一の事前計算されたデータセットに依存するのではなく、割り当てられたストレージが時間の経過とともに無傷であることを定期的に証明する必要があります。対照的に、PoCXはブロック時間でのみストレージコミットメントを検証します—ハード化されたプロット形式と厳格な証明検証により—効率性と分散化を維持しながら、継続的なストレージ証明のオーバーヘッドを回避します。

---

## 12. 結論

Bitcoin-PoCXは、セキュリティ特性と経済モデルを維持しながら、エネルギー効率の高いコンセンサスをBitcoin Coreに統合できることを実証しています。主要な貢献には、XOR-transposeエンコーディング（攻撃者にルックアップごとに4096ノンスの計算を強制し、圧縮攻撃を排除）、タイムベンディングアルゴリズム（分布変換によりブロック時間の分散を削減）、フォージング割り当てシステム（OP_RETURNベースの委譲により非カストディアルプールマイニングを可能に）、動的スケーリング（半減に合わせてセキュリティマージンを維持）、および最小限の統合（フィーチャーフラグ付きコードを専用ディレクトリに分離）が含まれます。

システムは現在テストネットフェーズにあります。マイニングパワーはハッシュレートではなくストレージ容量から導出され、Bitcoinの実績ある経済モデルを維持しながらエネルギー消費を桁違いに削減します。

---

## 参考文献

Bitcoin Core. *Bitcoin Coreリポジトリ.* https://github.com/bitcoin/bitcoin

Burstcoin. *Proof of Capacity技術文書.* 2014.

NIST. *SHA-3コンペティション: Shabal.* 2008.

Cohen, B., Pietrzak, K. *The Chia Network Blockchain.* 2019.

Spacemesh. *Spacemeshプロトコル文書.* 2021.

PoC Consortium. *PoCXフレームワーク.* https://github.com/PoC-Consortium/pocx

PoC Consortium. *Bitcoin-PoCX統合.* https://github.com/PoC-Consortium/bitcoin-pocx

---

**ライセンス**: MIT
**組織**: Proof of Capacity Consortium
**ステータス**: テストネットフェーズ
