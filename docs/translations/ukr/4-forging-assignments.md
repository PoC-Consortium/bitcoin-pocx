[‚Üê –ù–∞–∑–∞–¥: –ö–æ–Ω—Å–µ–Ω—Å—É—Å —ñ –º–∞–π–Ω—ñ–Ω–≥](3-consensus-and-mining.md) | [üìò –ó–º—ñ—Å—Ç](index.md) | [–î–∞–ª—ñ: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–∞—Å—É ‚Üí](5-timing-security.md)

---

# –†–æ–∑–¥—ñ–ª 4: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—É–≤–∞–Ω–Ω—è PoCX

## –í–∏–∫–æ–Ω–∞–≤—á–µ —Ä–µ–∑—é–º–µ

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—É—î **—Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—É** —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—É–≤–∞–Ω–Ω—è PoCX –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ —Ç—ñ–ª—å–∫–∏ –Ω–∞ OP_RETURN. –°–∏—Å—Ç–µ–º–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–ª–∞—Å–Ω–∏–∫–∞–º –ø–ª–æ—Ç—ñ–≤ –¥–µ–ª–µ–≥—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∞ –∫—É–≤–∞–Ω–Ω—è –æ–∫—Ä–µ–º–∏–º –∞–¥—Ä–µ—Å–∞–º —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤ –ª–∞–Ω—Ü—é–∑—ñ, –∑ –ø–æ–≤–Ω–æ—é –±–µ–∑–ø–µ–∫–æ—é —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π —Ç–∞ –∞—Ç–æ–º–∞—Ä–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—î

## –û—Å–Ω–æ–≤–Ω–∞ —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—è –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è

**–ö–ª—é—á–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî —Ü–µ –¥–æ–∑–≤–æ–ª–∏, –∞ –Ω–µ –∞–∫—Ç–∏–≤–∏

- –ë–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö UTXO –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–±–æ –≤–∏—Ç—Ä–∞—á–∞–Ω–Ω—è
- –°—Ç–∞–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –Ω–∞–±–æ—Ä—É UTXO
- –í–æ–ª–æ–¥—ñ–Ω–Ω—è –¥–æ–≤–æ–¥–∏—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, –∞ –Ω–µ –≤–∏—Ç—Ä–∞—á–∞–Ω–Ω—è–º UTXO
- –ü–æ–≤–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–æ–≥–æ —Å–ª—ñ–¥—É
- –ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Å LevelDB

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

### –§–æ—Ä–º–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

```
–í—Ö–æ–¥–∏:
  [0]: –ë—É–¥—å-—è–∫–∏–π UTXO, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É (–¥–æ–≤–æ–¥–∏—Ç—å –≤–æ–ª–æ–¥—ñ–Ω–Ω—è + —Å–ø–ª–∞—á—É—î –∫–æ–º—ñ—Å—ñ—ó)
       –ü–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º –≤–ª–∞—Å–Ω–∏–∫–∞ –ø–ª–æ—Ç—É
  [1+]: –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—Ö–æ–¥–∏ –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è –∫–æ–º—ñ—Å—ñ—ó

–í–∏—Ö–æ–¥–∏:
  [0]: OP_RETURN (–º–∞—Ä–∫–µ—Ä POCX + –∞–¥—Ä–µ—Å–∞ –ø–ª–æ—Ç—É + –∞–¥—Ä–µ—Å–∞ –∫—É–≤–∞–Ω–Ω—è)
       –§–æ—Ä–º–∞—Ç: OP_RETURN <0x2c> "POCX" <plot_addr_20> <forge_addr_20>
       –†–æ–∑–º—ñ—Ä: 46 –±–∞–π—Ç—ñ–≤ –∑–∞–≥–∞–ª–æ–º (1 –±–∞–π—Ç OP_RETURN + 1 –±–∞–π—Ç –¥–æ–≤–∂–∏–Ω–∏ + 44 –±–∞–π—Ç–∏ –¥–∞–Ω–∏—Ö)
       –ó–Ω–∞—á–µ–Ω–Ω—è: 0 BTC (–Ω–µ–≤–∏—Ç—Ä–∞—á—É–≤–∞–Ω–∏–π, –Ω–µ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –Ω–∞–±–æ—Ä—É UTXO)

  [1]: –†–µ—à—Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π P2WPKH)
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/assignments/opcodes.cpp:25-52`

### –§–æ—Ä–º–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

```
–í—Ö–æ–¥–∏:
  [0]: –ë—É–¥—å-—è–∫–∏–π UTXO, –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É (–¥–æ–≤–æ–¥–∏—Ç—å –≤–æ–ª–æ–¥—ñ–Ω–Ω—è + —Å–ø–ª–∞—á—É—î –∫–æ–º—ñ—Å—ñ—ó)
       –ü–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º –≤–ª–∞—Å–Ω–∏–∫–∞ –ø–ª–æ—Ç—É
  [1+]: –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—Ö–æ–¥–∏ –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è –∫–æ–º—ñ—Å—ñ—ó

–í–∏—Ö–æ–¥–∏:
  [0]: OP_RETURN (–º–∞—Ä–∫–µ—Ä XCOP + –∞–¥—Ä–µ—Å–∞ –ø–ª–æ—Ç—É)
       –§–æ—Ä–º–∞—Ç: OP_RETURN <0x18> "XCOP" <plot_addr_20>
       –†–æ–∑–º—ñ—Ä: 26 –±–∞–π—Ç—ñ–≤ –∑–∞–≥–∞–ª–æ–º (1 –±–∞–π—Ç OP_RETURN + 1 –±–∞–π—Ç –¥–æ–≤–∂–∏–Ω–∏ + 24 –±–∞–π—Ç–∏ –¥–∞–Ω–∏—Ö)
       –ó–Ω–∞—á–µ–Ω–Ω—è: 0 BTC (–Ω–µ–≤–∏—Ç—Ä–∞—á—É–≤–∞–Ω–∏–π, –Ω–µ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –Ω–∞–±–æ—Ä—É UTXO)

  [1]: –†–µ—à—Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π P2WPKH)
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/assignments/opcodes.cpp:54-77`

### –ú–∞—Ä–∫–µ—Ä–∏

- **–ú–∞—Ä–∫–µ—Ä –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** `POCX` (0x50, 0x4F, 0x43, 0x58) = "Proof of Capacity neXt"
- **–ú–∞—Ä–∫–µ—Ä —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:** `XCOP` (0x58, 0x43, 0x4F, 0x50) = "eXit Capacity OPeration"

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/assignments/opcodes.cpp:15-19`

### –ö–ª—é—á–æ–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó Bitcoin (–±–µ–∑ –∑–º—ñ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª—É)
- –í–∏—Ö–æ–¥–∏ OP_RETURN –¥–æ–∫–∞–∑–æ–≤–æ –Ω–µ–≤–∏—Ç—Ä–∞—á—É–≤–∞–Ω—ñ (–Ω—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ –Ω–∞–±–æ—Ä—É UTXO)
- –í–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–ª–æ—Ç–æ–º –¥–æ–≤–æ–¥–∏—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å–æ–º –Ω–∞ input[0] –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É
- –ù–∏–∑—å–∫–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (~200 –±–∞–π—Ç—ñ–≤, –∑–∞–∑–≤–∏—á–∞–π <0.0001 BTC –∫–æ–º—ñ—Å—ñ—ó)
- –ì–∞–º–∞–Ω–µ—Ü—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±–∏—Ä–∞—î –Ω–∞–π–±—ñ–ª—å—à–∏–π UTXO –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É –¥–ª—è –¥–æ–≤–µ–¥–µ–Ω–Ω—è –≤–æ–ª–æ–¥—ñ–Ω–Ω—è

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è

–£—Å—ñ –¥–∞–Ω—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç—ñ–π —Å–∞–º—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö LevelDB, —â–æ –π –Ω–∞–±—ñ—Ä UTXO (`chainstate/`), –∞–ª–µ –∑ –æ–∫—Ä–µ–º–∏–º–∏ –ø—Ä–µ—Ñ—ñ–∫—Å–∞–º–∏ –∫–ª—é—á—ñ–≤:

```
chainstate/ LevelDB:
‚îú‚îÄ –ù–∞–±—ñ—Ä UTXO (—Å—Ç–∞–Ω–¥–∞—Ä—Ç Bitcoin Core)
‚îÇ  ‚îî‚îÄ –ü—Ä–µ—Ñ—ñ–∫—Å 'C': COutPoint ‚Üí Coin
‚îÇ
‚îî‚îÄ –°—Ç–∞–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å (–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è PoCX)
   ‚îî‚îÄ –ü—Ä–µ—Ñ—ñ–∫—Å 'A': (plot_address, assignment_txid) ‚Üí ForgingAssignment
       ‚îî‚îÄ –ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è: –≤—Å—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –ø–ª–æ—Ç—É –∑ —á–∞—Å–æ–º
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/txdb.cpp:237-348`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment

```cpp
struct ForgingAssignment {
    // –Ü–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å
    std::array<uint8_t, 20> plotAddress;      // –í–ª–∞—Å–Ω–∏–∫ –ø–ª–æ—Ç—É (20-–±–∞–π—Ç–æ–≤–∏–π —Ö–µ—à P2WPKH)
    std::array<uint8_t, 20> forgingAddress;   // –í–ª–∞—Å–Ω–∏–∫ –ø—Ä–∞–≤ –∫—É–≤–∞–Ω–Ω—è (20-–±–∞–π—Ç–æ–≤–∏–π —Ö–µ—à P2WPKH)

    // –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
    uint256 assignment_txid;                   // –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è, —â–æ —Å—Ç–≤–æ—Ä–∏–ª–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
    int assignment_height;                     // –í–∏—Å–æ—Ç–∞ –±–ª–æ–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
    int assignment_effective_height;           // –ö–æ–ª–∏ —Å—Ç–∞—î –∞–∫—Ç–∏–≤–Ω–∏–º (–≤–∏—Å–æ—Ç–∞ + –∑–∞—Ç—Ä–∏–º–∫–∞)

    // –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
    bool revoked;                              // –ß–∏ –±—É–ª–æ —Ü–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ?
    uint256 revocation_txid;                   // –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è, —â–æ —Å–∫–∞—Å—É–≤–∞–ª–∞
    int revocation_height;                     // –í–∏—Å–æ—Ç–∞ –±–ª–æ–∫—É —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
    int revocation_effective_height;           // –ö–æ–ª–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ (–≤–∏—Å–æ—Ç–∞ + –∑–∞—Ç—Ä–∏–º–∫–∞)

    // –ú–µ—Ç–æ–¥–∏ –∑–∞–ø–∏—Ç—É —Å—Ç–∞–Ω—É
    ForgingState GetStateAtHeight(int height) const;
    bool IsActiveAtHeight(int height) const;
};
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/coins.h:111-178`

### –°—Ç–∞–Ω–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å

```cpp
enum class ForgingState : uint8_t {
    UNASSIGNED = 0,  // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ —ñ—Å–Ω—É—î
    ASSIGNING = 1,   // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ, –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞—Ç—Ä–∏–º–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó
    ASSIGNED = 2,    // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–µ, –∫—É–≤–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª–µ–Ω–æ
    REVOKING = 3,    // –°–∫–∞—Å–æ–≤–∞–Ω–æ, –∞–ª–µ —â–µ –∞–∫—Ç–∏–≤–Ω–µ –ø—ñ–¥ —á–∞—Å –ø–µ—Ä—ñ–æ–¥—É –∑–∞—Ç—Ä–∏–º–∫–∏
    REVOKED = 4      // –ü–æ–≤–Ω—ñ—Å—Ç—é —Å–∫–∞—Å–æ–≤–∞–Ω–æ, –±—ñ–ª—å—à–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–µ
};
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/coins.h:98-104`

### –ö–ª—é—á—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```cpp
// –ö–ª—é—á —ñ—Å—Ç–æ—Ä—ñ—ó: –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤–Ω–∏–π –∑–∞–ø–∏—Å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
// –§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞: (prefix, plotAddress, assignment_height, assignment_txid)
struct AssignmentHistoryKey {
    uint8_t prefix;                       // DB_ASSIGNMENT_HISTORY = 'A'
    std::array<uint8_t, 20> plotAddress;  // –ê–¥—Ä–µ—Å–∞ –ø–ª–æ—Ç—É (20 –±–∞–π—Ç—ñ–≤)
    int assignment_height;                // –í–∏—Å–æ—Ç–∞ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
    uint256 assignment_txid;              // ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
};
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/txdb.cpp:245-262`

### –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó

- –ö–æ–∂–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø–æ—Å—Ç—ñ–π–Ω–æ (–Ω–µ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è —è–∫—â–æ –Ω–µ–º–∞—î —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó)
- –ö—ñ–ª—å–∫–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –¥–ª—è –ø–ª–æ—Ç—É –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è –∑ —á–∞—Å–æ–º
- –î–æ–∑–≤–æ–ª—è—î –ø–æ–≤–Ω–∏–π –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–∏–π —Å–ª—ñ–¥ —Ç–∞ –∑–∞–ø–∏—Ç–∏ —ñ—Å—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
- –°–∫–∞—Å–æ–≤–∞–Ω—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑ `revoked=true`

## –û–±—Ä–æ–±–∫–∞ –±–ª–æ–∫—ñ–≤

### –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è ConnectBlock

OP_RETURN –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å —Ç–∞ —Å–∫–∞—Å—É–≤–∞–Ω—å –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±–ª–æ–∫—É –≤ `validation.cpp`:

```cpp
// –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è: –ü—ñ—Å–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Å–∫—Ä–∏–ø—Ç—ñ–≤, –ø–µ—Ä–µ–¥ UpdateCoins
#ifdef ENABLE_POCX
for (const auto& tx : block.vtx) {
    for (const CTxOut& output : tx.vout) {
        if (IsAssignmentOpReturn(output)) {
            // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–∏—Ö OP_RETURN
            auto [plot_addr, forge_addr] = ParseAssignmentOpReturn(output);

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è (tx –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É)
            if (!VerifyPlotOwnership(tx, plot_addr, view))
                return state.Invalid("bad-assignment-ownership");

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –ø–ª–æ—Ç—É (–ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ UNASSIGNED –∞–±–æ REVOKED)
            ForgingState state = GetPlotForgingState(plot_addr, height, view);
            if (state != UNASSIGNED && state != REVOKED)
                return state.Invalid("plot-not-available-for-assignment");

            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
            int activation_height = height + consensus.nForgingAssignmentDelay;
            ForgingAssignment assignment(plot_addr, forge_addr, tx.GetHash(),
                                       height, activation_height);

            view.AddForgingAssignment(assignment);

            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
            blockundo.vforgingundo.emplace_back(UndoType::ADDED, assignment);
        }
        else if (IsRevocationOpReturn(output)) {
            // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–∏—Ö OP_RETURN
            auto plot_addr = ParseRevocationOpReturn(output);

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
            if (!VerifyPlotOwnership(tx, plot_addr, view))
                return state.Invalid("bad-revocation-ownership");

            // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
            auto existing = view.GetForgingAssignment(plot_addr, height);
            if (!existing || existing->revoked)
                return state.Invalid("no-assignment-to-revoke");

            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç–∞–Ω—É –¥–ª—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
            blockundo.vforgingundo.emplace_back(UndoType::REVOKED, *existing);

            // –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è —è–∫ —Å–∫–∞—Å–æ–≤–∞–Ω–æ–≥–æ
            ForgingAssignment revoked = *existing;
            revoked.revoked = true;
            revoked.revocation_txid = tx.GetHash();
            revoked.revocation_height = height;
            revoked.revocation_effective_height = height + consensus.nForgingRevocationDelay;

            view.UpdateForgingAssignment(revoked);
        }
    }
}
#endif

// UpdateCoins –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—î –≤–∏—Ö–æ–¥–∏ OP_RETURN)
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/validation.cpp:2775-2878`

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è

```cpp
bool VerifyPlotOwnership(const CTransaction& tx,
                        const std::array<uint8_t, 20>& plotAddress,
                        const CCoinsViewCache& view)
{
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–∏–Ω –≤—Ö—ñ–¥ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É
    for (const auto& input : tx.vin) {
        Coin coin = view.GetCoin(input.prevout);
        if (!coin) continue;

        // –í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
        CTxDestination dest;
        if (!ExtractDestination(coin.out.scriptPubKey, dest)) continue;

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ P2WPKH –¥–æ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É
        if (auto* witness_addr = std::get_if<WitnessV0KeyHash>(&dest)) {
            if (std::equal(witness_addr->begin(), witness_addr->end(),
                          plotAddress.begin())) {
                // Bitcoin Core –≤–∂–µ –≤–∞–ª—ñ–¥—É–≤–∞–≤ –ø—ñ–¥–ø–∏—Å
                return true;
            }
        }
    }
    return false;
}
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/assignments/opcodes.cpp:217-256`

### –ó–∞—Ç—Ä–∏–º–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó

–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –º–∞—é—Ç—å –Ω–∞—Å—Ç—Ä–æ—é–≤–∞–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∞—Ç–∞–∫ —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó:

```cpp
// –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É (–Ω–∞—Å—Ç—Ä–æ—é–≤–∞–Ω—ñ –¥–ª—è –∫–æ–∂–Ω–æ—ó –º–µ—Ä–µ–∂—ñ)
// –ü—Ä–∏–∫–ª–∞–¥: 30 –±–ª–æ–∫—ñ–≤ = ~1 –≥–æ–¥–∏–Ω–∞ –∑ 2-—Ö–≤–∏–ª–∏–Ω–Ω–∏–º —á–∞—Å–æ–º –±–ª–æ–∫—É
consensus.nForgingAssignmentDelay;   // –ó–∞—Ç—Ä–∏–º–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
consensus.nForgingRevocationDelay;   // –ó–∞—Ç—Ä–∏–º–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
```

**–ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ç–∞–Ω—É:**
- –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: `UNASSIGNED ‚Üí ASSIGNING (–∑–∞—Ç—Ä–∏–º–∫–∞) ‚Üí ASSIGNED`
- –°–∫–∞—Å—É–≤–∞–Ω–Ω—è: `ASSIGNED ‚Üí REVOKING (–∑–∞—Ç—Ä–∏–º–∫–∞) ‚Üí REVOKED`

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/consensus/params.h`, `src/kernel/chainparams.cpp`

## –í–∞–ª—ñ–¥–∞—Ü—ñ—è mempool

–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å —Ç–∞ —Å–∫–∞—Å—É–≤–∞–Ω—å –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–∏–π–Ω—è—Ç—Ç—ñ –≤ mempool –¥–ª—è –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –¥–æ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è –≤ –º–µ—Ä–µ–∂—ñ.

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä—ñ–≤–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (CheckTransaction)

–í–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ `src/consensus/tx_check.cpp` –±–µ–∑ –¥–æ—Å—Ç—É–ø—É –¥–æ —Å—Ç–∞–Ω—É –ª–∞–Ω—Ü—é–≥–∞:

1. **–ú–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω POCX OP_RETURN:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –Ω–µ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ –º–∞—Ä–∫–µ—Ä—ñ–≤ POCX/XCOP

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/consensus/tx_check.cpp:63-77`

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∏–π–Ω—è—Ç—Ç—è –≤ mempool (PreChecks)

–í–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ `src/validation.cpp` –∑ –ø–æ–≤–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Å—Ç–∞–Ω—É –ª–∞–Ω—Ü—é–≥–∞ —Ç–∞ mempool:

#### –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

1. **–í–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–ª–æ—Ç–æ–º:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É
2. **–°—Ç–∞–Ω –ø–ª–æ—Ç—É:** –ü–ª–æ—Ç –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ UNASSIGNED (0) –∞–±–æ REVOKED (4)
3. **–ö–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ mempool:** –ù–µ–º–∞—î —ñ–Ω—à–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ –ø–ª–æ—Ç—É –≤ mempool (–≤–∏–≥—Ä–∞—î –ø–µ—Ä—à–∏–π –ø–æ–±–∞—á–µ–Ω–∏–π)

#### –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

1. **–í–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–ª–æ—Ç–æ–º:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É
2. **–ê–∫—Ç–∏–≤–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–ª–æ—Ç –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ª–∏—à–µ –≤ —Å—Ç–∞–Ω—ñ ASSIGNED (2)
3. **–ö–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ mempool:** –ù–µ–º–∞—î —ñ–Ω—à–æ–≥–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ –ø–ª–æ—Ç—É –≤ mempool

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/validation.cpp:898-993`

### –ü–æ—Ç—ñ–∫ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

```
–¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
       ‚Üì
CheckTransaction() [tx_check.cpp]
  ‚úì –ú–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω POCX OP_RETURN
       ‚Üì
MemPoolAccept::PreChecks() [validation.cpp]
  ‚úì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–ª–æ—Ç–æ–º
  ‚úì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
  ‚úì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ mempool
       ‚Üì
   –í–∞–ª—ñ–¥–Ω–æ ‚Üí –ü—Ä–∏–π–Ω—è—Ç—Ç—è –≤ mempool
   –ù–µ–≤–∞–ª—ñ–¥–Ω–æ ‚Üí –í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è (–Ω–µ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É–≤–∞—Ç–∏)
       ‚Üì
–ú–∞–π–Ω—ñ–Ω–≥ –±–ª–æ–∫—É
       ‚Üì
ConnectBlock() [validation.cpp]
  ‚úì –ü–æ–≤—Ç–æ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Å—ñ—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ (–≥–ª–∏–±–∏–Ω–∞ –∑–∞—Ö–∏—Å—Ç—É)
  ‚úì –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —Å—Ç–∞–Ω—É
  ‚úì –ó–∞–ø–∏—Å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
```

### –ì–ª–∏–±–∏–Ω–∞ –∑–∞—Ö–∏—Å—Ç—É

–£—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó mempool –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å `ConnectBlock()` –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥:
- –ê—Ç–∞–∫ –æ–±—Ö–æ–¥—É mempool
- –ù–µ–≤–∞–ª—ñ–¥–Ω–∏—Ö –±–ª–æ–∫—ñ–≤ –≤—ñ–¥ –∑–ª–æ–≤–º–∏—Å–Ω–∏—Ö –º–∞–π–Ω–µ—Ä—ñ–≤
- –ö—Ä–∞–π–Ω—ñ—Ö –≤–∏–ø–∞–¥–∫—ñ–≤ –ø—ñ–¥ —á–∞—Å —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó

–í–∞–ª—ñ–¥–∞—Ü—ñ—è –±–ª–æ–∫—É –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ—é –¥–ª—è –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É.

## –ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –¢—Ä–∏—Ä—ñ–≤–Ω–µ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CCoinsViewCache (–ö–µ—à –ø–∞–º'—è—Ç—ñ)         ‚îÇ  ‚Üê –ó–º—ñ–Ω–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ
‚îÇ   - Coins: cacheCoins                   ‚îÇ
‚îÇ   - Assignments: pendingAssignments     ‚îÇ
‚îÇ   - –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è dirty: dirtyPlots      ‚îÇ
‚îÇ   - –í–∏–¥–∞–ª–µ–Ω–Ω—è: deletedAssignments       ‚îÇ
‚îÇ   - –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ: cachedAssignmentsUsage ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì Flush()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   CCoinsViewDB (–†—ñ–≤–µ–Ω—å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö)      ‚îÇ  ‚Üê –û–¥–∏–Ω –∞—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å
‚îÇ   - BatchWrite(): UTXO + Assignments    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì WriteBatch()
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   LevelDB (–î–∏—Å–∫–æ–≤–µ —Å—Ö–æ–≤–∏—â–µ)             ‚îÇ  ‚Üê ACID –≥–∞—Ä–∞–Ω—Ç—ñ—ó
‚îÇ   - –ê—Ç–æ–º–∞—Ä–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ—Ü–µ—Å Flush

–ö–æ–ª–∏ `view.Flush()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±–ª–æ–∫—É:

```cpp
bool CCoinsViewCache::Flush() {
    // 1. –ó–∞–ø–∏—Å –∑–º—ñ–Ω coins –¥–æ –±–∞–∑–∏
    auto cursor = CoinsViewCacheCursor(/*...*/, /*will_erase=*/true);
    bool fOk = base->BatchWrite(cursor, hashBlock);

    // 2. –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å –∑–º—ñ–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
    if (fOk && !dirtyPlots.empty()) {
        // –ó–±—ñ—Ä dirty –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
        ForgingAssignmentsMap assignmentsToWrite;
        PlotAddressAssignmentMap currentToWrite;  // –ü–æ—Ä–æ–∂–Ω—ñ–π - –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

        for (const auto& plotAddr : dirtyPlots) {
            auto it = pendingAssignments.find(plotAddr);
            if (it != pendingAssignments.end()) {
                for (const auto& assignment : it->second) {
                    assignmentsToWrite[{plotAddr, assignment}] = assignment;
                }
            }
        }

        // –ó–∞–ø–∏—Å –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
        fOk = base->BatchWriteAssignments(assignmentsToWrite, currentToWrite,
                                         deletedAssignments);

        if (fOk) {
            // –û—á–∏—â–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
            dirtyPlots.clear();
            deletedAssignments.clear();
        }
    }

    if (fOk) {
        cacheCoins.clear();  // –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
        pendingAssignments.clear();
        cachedAssignmentsUsage = 0;
    }

    return fOk;
}
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/coins.cpp:278-315`

### –ü–∞–∫–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```cpp
bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) {
    CDBBatch batch(*m_db);  // –û–¥–∏–Ω –ø–∞–∫–µ—Ç LevelDB

    // 1. –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –ø–µ—Ä–µ—Ö–æ–¥—É
    batch.Write(DB_HEAD_BLOCKS, Vector(hashBlock, old_tip));

    // 2. –ó–∞–ø–∏—Å —É—Å—ñ—Ö –∑–º—ñ–Ω coins
    for (auto it = cursor.Begin(); it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {
        if (it->second.coin.IsSpent())
            batch.Erase(CoinKey(it->first));
        else
            batch.Write(CoinKey(it->first), it->second.coin);
    }

    // 3. –ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
    batch.Write(DB_BEST_BLOCK, hashBlock);

    // 4. –ê–¢–û–ú–ê–†–ù–ò–ô –ö–û–ú–Ü–¢
    bool ret = m_db->WriteBatch(batch);

    return ret;
}

// –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ, –∞–ª–µ –≤ —Ç–æ–º—É –∂ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
bool CCoinsViewDB::BatchWriteAssignments(
    const ForgingAssignmentsMap& assignments,
    const PlotAddressAssignmentMap& currentAssignments,  // –ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä (–∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ API)
    const DeletedAssignmentsSet& deletedAssignments)
{
    CDBBatch batch(*m_db);  // –ù–æ–≤–∏–π –ø–∞–∫–µ—Ç, –∞–ª–µ —Ç–∞ —Å–∞–º–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö

    // –ó–∞–ø–∏—Å —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
    for (const auto& [key, assignment] : assignments) {
        const auto& [plot_addr, txid] = key;
        batch.Write(AssignmentHistoryKey(plot_addr, txid), assignment);
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–∏—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –∑ —ñ—Å—Ç–æ—Ä—ñ—ó
    for (const auto& [plot_addr, txid] : deletedAssignments) {
        batch.Erase(AssignmentHistoryKey(plot_addr, txid));
    }

    // –ê–¢–û–ú–ê–†–ù–ò–ô –ö–û–ú–Ü–¢
    return m_db->WriteBatch(batch);
}
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/txdb.cpp:332-348`

### –ì–∞—Ä–∞–Ω—Ç—ñ—ó –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—ñ

‚úÖ **–©–æ –∞—Ç–æ–º–∞—Ä–Ω–µ:**
- –£—Å—ñ –∑–º—ñ–Ω–∏ coins –≤ –º–µ–∂–∞—Ö –±–ª–æ–∫—É –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ
- –£—Å—ñ –∑–º—ñ–Ω–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –≤ –º–µ–∂–∞—Ö –±–ª–æ–∫—É –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ
- –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—é –ø—Ä–∏ –∑–±–æ—è—Ö

‚ö†Ô∏è **–ü–æ—Ç–æ—á–Ω–µ –æ–±–º–µ–∂–µ–Ω–Ω—è:**
- Coins —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ **–æ–∫—Ä–µ–º–∏—Ö** –ø–∞–∫–µ—Ç–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö LevelDB
- –û–±–∏–¥–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å `view.Flush()`, –∞–ª–µ –Ω–µ –≤ –æ–¥–Ω–æ–º—É –∞—Ç–æ–º–∞—Ä–Ω–æ–º—É –∑–∞–ø–∏—Å—ñ
- –ù–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ: –û–±–∏–¥–≤–∞ –ø–∞–∫–µ—Ç–∏ –∑–∞–≤–µ—Ä—à—É—é—Ç—å—Å—è —à–≤–∏–¥–∫–æ –¥–æ fsync –¥–∏—Å–∫–∞
- –†–∏–∑–∏–∫ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π: –û–±–∏–¥–≤–∞ –ø–æ—Ç—Ä–µ–±—É–≤–∞–ª–∏ –± –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ —Ç–æ–≥–æ –∂ –±–ª–æ–∫—É –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–±–æ—é

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏, —è–∫–∏–π –ø–µ—Ä–µ–¥–±–∞—á–∞–≤ –æ–¥–∏–Ω —É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ø–∞–∫–µ—Ç. –ü–æ—Ç–æ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–≤–∞ –ø–∞–∫–µ—Ç–∏, –∞–ª–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ —ñ—Å–Ω—É—é—á—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–±–æ—ó–≤ Bitcoin Core (–º–∞—Ä–∫–µ—Ä DB_HEAD_BLOCKS).

## –û–±—Ä–æ–±–∫–∞ —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

```cpp
struct ForgingUndo {
    enum class UndoType : uint8_t {
        ADDED = 0,      // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ –¥–æ–¥–∞–Ω–æ (–≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ)
        MODIFIED = 1,   // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ (–≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ)
        REVOKED = 2     // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ (—Å–∫–∞—Å—É–≤–∞—Ç–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∏ undo)
    };

    UndoType type;
    ForgingAssignment assignment;  // –ü–æ–≤–Ω–∏–π —Å—Ç–∞–Ω –¥–æ –∑–º—ñ–Ω–∏
};

struct CBlockUndo {
    std::vector<CTxUndo> vtxundo;           // –î–∞–Ω—ñ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è UTXO
    std::vector<ForgingUndo> vforgingundo;  // –î–∞–Ω—ñ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
};
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/undo.h:63-105`

### –ü—Ä–æ—Ü–µ—Å DisconnectBlock

–ö–æ–ª–∏ –±–ª–æ–∫ –≤—ñ–¥'—î–¥–Ω—É—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó:

```cpp
DisconnectResult Chainstate::DisconnectBlock(const CBlock& block,
                                              const CBlockIndex* pindex,
                                              CCoinsViewCache& view)
{
    // ... —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥'—î–¥–Ω–∞–Ω–Ω—è UTXO ...

    // –ß–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑ –¥–∏—Å–∫–∞
    CBlockUndo blockUndo;
    if (!ReadBlockUndo(blockUndo, *pindex))
        return DISCONNECT_FAILED;

    #ifdef ENABLE_POCX
    // –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å (–æ–±—Ä–æ–±–∫–∞ —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É)
    for (auto it = blockUndo.vforgingundo.rbegin();
         it != blockUndo.vforgingundo.rend(); ++it) {

        switch (it->type) {
            case UndoType::ADDED:
                // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ –¥–æ–¥–∞–Ω–æ - –≤–∏–¥–∞–ª–∏—Ç–∏ –π–æ–≥–æ
                view.RemoveForgingAssignment(
                    it->assignment.plotAddress,
                    it->assignment.assignment_txid
                );
                break;

            case UndoType::REVOKED:
                // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ - –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –Ω–µ—Å–∫–∞—Å–æ–≤–∞–Ω–∏–π —Å—Ç–∞–Ω
                view.RestoreForgingAssignment(it->assignment);
                break;

            case UndoType::MODIFIED:
                // –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±—É–ª–æ –∑–º—ñ–Ω–µ–Ω–æ - –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω
                view.UpdateForgingAssignment(it->assignment);
                break;
        }
    }
    #endif

    return DISCONNECT_OK;
}
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/validation.cpp:2381-2415`

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–µ—à–µ–º –ø—ñ–¥ —á–∞—Å —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó

```cpp
class CCoinsViewCache {
private:
    // –ö–µ—à—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
    mutable std::map<std::array<uint8_t, 20>, std::vector<ForgingAssignment>> pendingAssignments;
    mutable std::set<std::array<uint8_t, 20>> dirtyPlots;  // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–∏—Ö –ø–ª–æ—Ç—ñ–≤
    mutable std::set<std::pair<std::array<uint8_t, 20>, uint256>> deletedAssignments;  // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω—å
    mutable size_t cachedAssignmentsUsage{0};  // –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ

public:
    void AddForgingAssignment(const ForgingAssignment& assignment) {
        pendingAssignments[assignment.plotAddress].push_back(assignment);
        dirtyPlots.insert(assignment.plotAddress);
        cachedAssignmentsUsage += sizeof(ForgingAssignment);
    }

    void RemoveForgingAssignment(const std::array<uint8_t, 20>& plotAddress,
                                 const uint256& assignment_txid) {
        auto key = std::make_pair(plotAddress, assignment_txid);
        deletedAssignments.insert(key);
        dirtyPlots.insert(plotAddress);
        if (cachedAssignmentsUsage >= sizeof(ForgingAssignment)) {
            cachedAssignmentsUsage -= sizeof(ForgingAssignment);
        }
    }

    void RestoreForgingAssignment(const ForgingAssignment& assignment) {
        pendingAssignments[assignment.plotAddress].push_back(assignment);
        dirtyPlots.insert(assignment.plotAddress);
        auto key = std::make_pair(assignment.plotAddress, assignment.assignment_txid);
        deletedAssignments.erase(key);
        if (true) {
            cachedAssignmentsUsage += sizeof(ForgingAssignment);
        }
    }
};
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/coins.cpp:494-565`

## –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å RPC

### –ö–æ–º–∞–Ω–¥–∏ –≤—É–∑–ª–∞ (–±–µ–∑ –≥–∞–º–∞–Ω—Ü—è)

#### get_assignment
```bash
bitcoin-cli get_assignment "pocx1qplot..."
```

–ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É:
```json
{
  "plot_address": "pocx1qplot...",
  "has_assignment": true,
  "state": "ASSIGNED",
  "forging_address": "pocx1qforger...",
  "assignment_txid": "abc123...",
  "assignment_height": 100,
  "activation_height": 244,
  "revoked": false
}
```

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/rpc/assignments.cpp:31-126`

### –ö–æ–º–∞–Ω–¥–∏ –≥–∞–º–∞–Ω—Ü—è (–ø–æ—Ç—Ä—ñ–±–µ–Ω –≥–∞–º–∞–Ω–µ—Ü—å)

#### create_assignment
```bash
bitcoin-cli create_assignment "pocx1qplot..." "pocx1qforger..."
```

–°—Ç–≤–æ—Ä—é—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±–∏—Ä–∞—î –Ω–∞–π–±—ñ–ª—å—à–∏–π UTXO –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É –¥–ª—è –¥–æ–≤–µ–¥–µ–Ω–Ω—è –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
- –ë—É–¥—É—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –∑ OP_RETURN + –≤–∏—Ö—ñ–¥ —Ä–µ—à—Ç–∏
- –ü—ñ–¥–ø–∏—Å—É—î –∫–ª—é—á–µ–º –≤–ª–∞—Å–Ω–∏–∫–∞ –ø–ª–æ—Ç—É
- –¢—Ä–∞–Ω—Å–ª—é—î –≤ –º–µ—Ä–µ–∂—É

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/rpc/assignments_wallet.cpp:29-93`

#### revoke_assignment
```bash
bitcoin-cli revoke_assignment "pocx1qplot..."
```

–°—Ç–≤–æ—Ä—é—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±–∏—Ä–∞—î –Ω–∞–π–±—ñ–ª—å—à–∏–π UTXO –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É –¥–ª—è –¥–æ–≤–µ–¥–µ–Ω–Ω—è –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
- –ë—É–¥—É—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –∑ OP_RETURN + –≤–∏—Ö—ñ–¥ —Ä–µ—à—Ç–∏
- –ü—ñ–¥–ø–∏—Å—É—î –∫–ª—é—á–µ–º –≤–ª–∞—Å–Ω–∏–∫–∞ –ø–ª–æ—Ç—É
- –¢—Ä–∞–Ω—Å–ª—é—î –≤ –º–µ—Ä–µ–∂—É

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/rpc/assignments_wallet.cpp:95-154`

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –≥–∞–º–∞–Ω—Ü–µ–º

–ü—Ä–æ—Ü–µ—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≥–∞–º–∞–Ω—Ü–µ–º:

```cpp
1. –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∞–¥—Ä–µ—Å (–ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ P2WPKH bech32)
2. –ü–æ—à—É–∫ –Ω–∞–π–±—ñ–ª—å—à–æ–≥–æ UTXO –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É (–¥–æ–≤–æ–¥–∏—Ç—å –≤–æ–ª–æ–¥—ñ–Ω–Ω—è)
3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑ —Ñ—ñ–∫—Ç–∏–≤–Ω–∏–º –≤–∏—Ö–æ–¥–æ–º
4. –ü—ñ–¥–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ—á–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –∑ –¥–∞–Ω–∏–º–∏ witness)
5. –ó–∞–º—ñ–Ω–∞ —Ñ—ñ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏—Ö–æ–¥—É –Ω–∞ OP_RETURN
6. –ü—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–µ –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –∫–æ–º—ñ—Å—ñ–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É
7. –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –ø—ñ–¥–ø–∏—Å —Ñ—ñ–Ω–∞–ª—å–Ω–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
8. –¢—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –≤ –º–µ—Ä–µ–∂—É
```

**–ö–ª—é—á–æ–≤–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è:** –ì–∞–º–∞–Ω–µ—Ü—å –ø–æ–≤–∏–Ω–µ–Ω –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ –∑ –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É –¥–ª—è –¥–æ–≤–µ–¥–µ–Ω–Ω—è –≤–æ–ª–æ–¥—ñ–Ω–Ω—è, —Ç–æ–º—É –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–º—É—à—É—î –≤–∏–±—ñ—Ä coins –∑ —Ü—ñ—î—ó –∞–¥—Ä–µ—Å–∏.

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** `src/pocx/assignments/transactions.cpp:38-263`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

### –û—Å–Ω–æ–≤–Ω—ñ —Ñ–∞–π–ª–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

```
src/
‚îú‚îÄ‚îÄ coins.h                        # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment, –º–µ—Ç–æ–¥–∏ CCoinsViewCache [710 —Ä—è–¥–∫—ñ–≤]
‚îú‚îÄ‚îÄ coins.cpp                      # –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–µ—à–µ–º, –ø–∞–∫–µ—Ç–Ω—ñ –∑–∞–ø–∏—Å–∏ [603 —Ä—è–¥–∫–∏]
‚îÇ
‚îú‚îÄ‚îÄ txdb.h                         # –ú–µ—Ç–æ–¥–∏ CCoinsViewDB –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å [90 —Ä—è–¥–∫—ñ–≤]
‚îú‚îÄ‚îÄ txdb.cpp                       # –ß–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö [349 —Ä—è–¥–∫—ñ–≤]
‚îÇ
‚îú‚îÄ‚îÄ undo.h                         # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingUndo –¥–ª—è —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π
‚îÇ
‚îú‚îÄ‚îÄ validation.cpp                 # –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è ConnectBlock/DisconnectBlock
‚îÇ
‚îî‚îÄ‚îÄ pocx/
    ‚îú‚îÄ‚îÄ assignments/
    ‚îÇ   ‚îú‚îÄ‚îÄ opcodes.h              # –§–æ—Ä–º–∞—Ç OP_RETURN, –ø–∞—Ä—Å–∏–Ω–≥, –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è
    ‚îÇ   ‚îú‚îÄ‚îÄ opcodes.cpp            # [259 —Ä—è–¥–∫—ñ–≤] –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤, –æ–ø–µ—Ä–∞—Ü—ñ—ó OP_RETURN, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
    ‚îÇ   ‚îú‚îÄ‚îÄ assignment_state.h     # –•–µ–ª–ø–µ—Ä–∏ GetEffectiveSigner, GetAssignmentState
    ‚îÇ   ‚îú‚îÄ‚îÄ assignment_state.cpp   # –§—É–Ω–∫—Ü—ñ—ó –∑–∞–ø–∏—Ç—É —Å—Ç–∞–Ω—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
    ‚îÇ   ‚îú‚îÄ‚îÄ transactions.h         # API —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –≥–∞–º–∞–Ω—Ü—è
    ‚îÇ   ‚îî‚îÄ‚îÄ transactions.cpp       # –§—É–Ω–∫—Ü—ñ—ó –≥–∞–º–∞–Ω—Ü—è create_assignment, revoke_assignment
    ‚îÇ
    ‚îú‚îÄ‚îÄ rpc/
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments.h          # –ö–æ–º–∞–Ω–¥–∏ RPC –≤—É–∑–ª–∞ (–±–µ–∑ –≥–∞–º–∞–Ω—Ü—è)
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments.cpp        # RPC get_assignment, list_assignments
    ‚îÇ   ‚îú‚îÄ‚îÄ assignments_wallet.h   # –ö–æ–º–∞–Ω–¥–∏ RPC –≥–∞–º–∞–Ω—Ü—è
    ‚îÇ   ‚îî‚îÄ‚îÄ assignments_wallet.cpp # RPC create_assignment, revoke_assignment
    ‚îÇ
    ‚îî‚îÄ‚îÄ consensus/
        ‚îî‚îÄ‚îÄ params.h               # nForgingAssignmentDelay, nForgingRevocationDelay
```

## –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### –û–ø–µ—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

- **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** O(n) - —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –¥–ª—è –∞–¥—Ä–µ—Å–∏ –ø–ª–æ—Ç—É –¥–ª—è –ø–æ—à—É–∫—É –Ω–∞–π–Ω–æ–≤—ñ—à–æ–≥–æ
- **–û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å:** O(n) - —ñ—Ç–µ—Ä–∞—Ü—ñ—è –≤—Å—ñ—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –¥–ª—è –ø–ª–æ—Ç—É
- **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** O(1) - –æ–¥–Ω–∞ –≤—Å—Ç–∞–≤–∫–∞
- **–°–∫–∞—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** O(1) - –æ–¥–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- **–†–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è (–Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è):** O(1) - –ø—Ä—è–º–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

–î–µ n = –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –¥–ª—è –ø–ª–æ—Ç—É (–∑–∞–∑–≤–∏—á–∞–π –º–∞–ª–∞, < 10)

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ

- **–ù–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** ~160 –±–∞–π—Ç—ñ–≤ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ForgingAssignment)
- **–ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –∫–µ—à—É:** –ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ —Ö–µ—à-–∫–∞—Ä—Ç–∏ –¥–ª—è dirty –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
- **–¢–∏–ø–æ–≤–∏–π –±–ª–æ–∫:** <10 –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å = <2 KB –ø–∞–º'—è—Ç—ñ

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–∏—Å–∫–∞

- **–ù–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** ~200 –±–∞–π—Ç—ñ–≤ –Ω–∞ –¥–∏—Å–∫—É (–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏–º–∏ –≤–∏—Ç—Ä–∞—Ç–∞–º–∏ LevelDB)
- **10000 –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å:** ~2 MB –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É
- **–ù–µ–∑–Ω–∞—á–Ω–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ –Ω–∞–±–æ—Ä–æ–º UTXO:** <0.001% —Ç–∏–ø–æ–≤–æ–≥–æ chainstate

## –ü–æ—Ç–æ—á–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ç–∞ –º–∞–π–±—É—Ç–Ω—è —Ä–æ–±–æ—Ç–∞

### –û–±–º–µ–∂–µ–Ω–Ω—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—ñ

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:** Coins —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ –æ–∫—Ä–µ–º–∏—Ö –ø–∞–∫–µ—Ç–∞—Ö LevelDB –ø—ñ–¥ —á–∞—Å `view.Flush()`

**–í–ø–ª–∏–≤:** –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π —Ä–∏–∑–∏–∫ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ —è–∫—â–æ –∑–±—ñ–π –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –º—ñ–∂ –ø–∞–∫–µ—Ç–∞–º–∏

**–ü–æ–º'—è–∫—à–µ–Ω–Ω—è:**
- –û–±–∏–¥–≤–∞ –ø–∞–∫–µ—Ç–∏ –∑–∞–≤–µ—Ä—à—É—é—Ç—å—Å—è —à–≤–∏–¥–∫–æ –¥–æ fsync
- –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–±–æ—ó–≤ Bitcoin Core –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–∞—Ä–∫–µ—Ä DB_HEAD_BLOCKS
- –ù–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ: –ù—ñ–∫–æ–ª–∏ –Ω–µ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞–ª–æ—Å—è –≤ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ

**–ú–∞–π–±—É—Ç–Ω—î –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:** –û–±'—î–¥–Ω–∞–Ω–Ω—è –≤ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é –ø–∞–∫–µ—Ç—É LevelDB

### –û–±—Ä—ñ–∑–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:** –£—Å—ñ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–µ–æ–±–º–µ–∂–µ–Ω–æ

**–í–ø–ª–∏–≤:** ~200 –±–∞–π—Ç—ñ–≤ –Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–∑–∞–≤–∂–¥–∏

**–ú–∞–π–±—É—Ç–Ω—î:** –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ –æ–±—Ä—ñ–∑–∞–Ω–Ω—è –ø–æ–≤–Ω—ñ—Å—Ç—é —Å–∫–∞—Å–æ–≤–∞–Ω–∏—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å —Å—Ç–∞—Ä—à–∏—Ö –∑–∞ N –±–ª–æ–∫—ñ–≤

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ú–∞–ª–æ–π–º–æ–≤—ñ—Ä–Ω–æ, —â–æ –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è - –Ω–∞–≤—ñ—Ç—å 1 –º—ñ–ª—å–π–æ–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å = 200 MB

## –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–µ—Å—Ç–∏

‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è OP_RETURN
‚úÖ –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è ConnectBlock
‚úÖ –°–∫–∞—Å—É–≤–∞–Ω–Ω—è ConnectBlock
‚úÖ –û–±—Ä–æ–±–∫–∞ —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó DisconnectBlock
‚úÖ –û–ø–µ—Ä–∞—Ü—ñ—ó —á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
‚úÖ –ü–µ—Ä–µ—Ö–æ–¥–∏ —Å—Ç–∞–Ω—É (UNASSIGNED ‚Üí ASSIGNING ‚Üí ASSIGNED ‚Üí REVOKING ‚Üí REVOKED)
‚úÖ –ö–æ–º–∞–Ω–¥–∏ RPC (get_assignment, create_assignment, revoke_assignment)
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –≥–∞–º–∞–Ω—Ü–µ–º

### –û–±–ª–∞—Å—Ç—ñ –ø–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏

- –ú–æ–¥—É–ª—å–Ω—ñ —Ç–µ—Å—Ç–∏: `src/test/pocx_*_tests.cpp`
- –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —Ç–µ—Å—Ç–∏: `test/functional/feature_pocx_*.py`
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏: –†—É—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ regtest

## –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É

### –ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

1. **–í–æ–ª–æ–¥—ñ–Ω–Ω—è:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É
2. **–°—Ç–∞–Ω:** –ü–ª–æ—Ç –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤ —Å—Ç–∞–Ω—ñ UNASSIGNED –∞–±–æ REVOKED
3. **–§–æ—Ä–º–∞—Ç:** –í–∞–ª—ñ–¥–Ω–∏–π OP_RETURN –∑ –º–∞—Ä–∫–µ—Ä–æ–º POCX + 2x 20-–±–∞–π—Ç–æ–≤—ñ –∞–¥—Ä–µ—Å–∏
4. **–£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å:** –û–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –ø–ª–æ—Ç –∑–∞ —Ä–∞–∑

### –ü—Ä–∞–≤–∏–ª–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

1. **–í–æ–ª–æ–¥—ñ–Ω–Ω—è:** –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –≤–ª–∞—Å–Ω–∏–∫–æ–º –ø–ª–æ—Ç—É
2. **–Ü—Å–Ω—É–≤–∞–Ω–Ω—è:** –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ —ñ—Å–Ω—É–≤–∞—Ç–∏ —ñ —â–µ –Ω–µ –±—É—Ç–∏ —Å–∫–∞—Å–æ–≤–∞–Ω–∏–º
3. **–§–æ—Ä–º–∞—Ç:** –í–∞–ª—ñ–¥–Ω–∏–π OP_RETURN –∑ –º–∞—Ä–∫–µ—Ä–æ–º XCOP + 20-–±–∞–π—Ç–æ–≤–∞ –∞–¥—Ä–µ—Å–∞

### –ü—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó

- **–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** `assignment_height + nForgingAssignmentDelay`
- **–ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:** `revocation_height + nForgingRevocationDelay`
- **–ó–∞—Ç—Ä–∏–º–∫–∏:** –ù–∞—Å—Ç—Ä–æ—é–≤–∞–Ω—ñ –¥–ª—è –∫–æ–∂–Ω–æ—ó –º–µ—Ä–µ–∂—ñ (–Ω–∞–ø—Ä., 30 –±–ª–æ–∫—ñ–≤ = ~1 –≥–æ–¥–∏–Ω–∞ –∑ 2-—Ö–≤–∏–ª–∏–Ω–Ω–∏–º —á–∞—Å–æ–º –±–ª–æ–∫—É)

### –í–∞–ª—ñ–¥–∞—Ü—ñ—è –±–ª–æ–∫—É

- –ù–µ–≤–∞–ª—ñ–¥–Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è/—Å–∫–∞—Å—É–≤–∞–Ω–Ω—è ‚Üí –±–ª–æ–∫ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ (–ø—Ä–æ–≤–∞–ª –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É)
- –í–∏—Ö–æ–¥–∏ OP_RETURN –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª—é—á–∞—é—Ç—å—Å—è –∑ –Ω–∞–±–æ—Ä—É UTXO (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ Bitcoin)
- –û–±—Ä–æ–±–∫–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –¥–æ –æ–Ω–æ–≤–ª–µ–Ω—å UTXO –≤ ConnectBlock

## –í–∏—Å–Ω–æ–≤–æ–∫

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫—É–≤–∞–Ω–Ω—è PoCX —è–∫ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î:

‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó Bitcoin, –±–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö UTXO
‚úÖ **–ï–∫–æ–Ω–æ–º—ñ—á–Ω—ñ—Å—Ç—å:** –ë–µ–∑ –≤–∏–º–æ–≥–∏ dust, —Ç—ñ–ª—å–∫–∏ –∫–æ–º—ñ—Å—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
‚úÖ **–ë–µ–∑–ø–µ–∫–∞ —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ñ –¥–∞–Ω—ñ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª—é—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å—Ç–∞–Ω
‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç–∏ LevelDB
‚úÖ **–ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è:** –ü–æ–≤–Ω–∏–π –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫–∏–π —Å–ª—ñ–¥ —É—Å—ñ—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å –∑ —á–∞—Å–æ–º
‚úÖ **–ß–∏—Å—Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:** –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó Bitcoin Core, —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥ PoCX
‚úÖ **–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ, –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—î

### –Ø–∫—ñ—Å—Ç—å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

- **–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–¥—É:** –í—ñ–¥–º—ñ–Ω–Ω–∞ - —á—ñ—Ç–∫–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –º—ñ–∂ Bitcoin Core —Ç–∞ PoCX
- **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Å–µ–Ω—Å—É—Å—É
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** –ö–æ–¥ –¥–æ–±—Ä–µ –ø—Ä–æ–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π
- **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–∞, —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞

### –í–∞–ª—ñ–¥–æ–≤–∞–Ω—ñ –∫–ª—é—á–æ–≤—ñ –ø—Ä–æ–µ–∫—Ç–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è

1. ‚úÖ –ü—ñ–¥—Ö—ñ–¥ —Ç—ñ–ª—å–∫–∏ –Ω–∞ OP_RETURN (vs –Ω–∞ –æ—Å–Ω–æ–≤—ñ UTXO)
2. ‚úÖ –û–∫—Ä–µ–º–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö (vs Coin extraData)
3. ‚úÖ –ü–æ–≤–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó (vs —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω)
4. ‚úÖ –í–æ–ª–æ–¥—ñ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø—ñ–¥–ø–∏—Å (vs –≤–∏—Ç—Ä–∞—á–∞–Ω–Ω—è UTXO)
5. ‚úÖ –ó–∞—Ç—Ä–∏–º–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó (–∑–∞–ø–æ–±—ñ–≥–∞—é—Ç—å –∞—Ç–∞–∫–∞–º —Ä–µ–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó)

–°–∏—Å—Ç–µ–º–∞ —É—Å–ø—ñ—à–Ω–æ –¥–æ—Å—è–≥–∞—î –≤—Å—ñ—Ö –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏—Ö —Ü—ñ–ª–µ–π –∑ —á–∏—Å—Ç–æ—é, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é.

---

[‚Üê –ù–∞–∑–∞–¥: –ö–æ–Ω—Å–µ–Ω—Å—É—Å —ñ –º–∞–π–Ω—ñ–Ω–≥](3-consensus-and-mining.md) | [üìò –ó–º—ñ—Å—Ç](index.md) | [–î–∞–ª—ñ: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–∞—Å—É ‚Üí](5-timing-security.md)
